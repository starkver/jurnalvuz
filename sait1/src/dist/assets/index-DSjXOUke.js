import{r as y,a as ya,g as wa,c as Ne,R as re,b as Zr}from"./vendor-DmqTMYGc.js";import{A as Ge,C as ct,R as Ws,a as Qr,b as ot,X as Ke,B as Ye,c as dt,I as St,T as Hs,d as ge,U as Me,M as ba,H as en,e as Ss,f as Gs,G as Ks,g as Be,L as lt,h as Na,i as be,S as es,j as tn,k as Ys,l as kt,m as Xs,n as Zs,o as sn,F as rn,Z as nn,p as Ct,q as an,r as on,s as Ht,P as he,t as ks,u as Cs,v as pr,N as vr,D as _a,w as jr,x as ve,y as yr,z as ke,E as Tt,J as Pe,K as ln,O as ts,Q as cn,V as Sa,W as ss,Y as Gt,_ as Es,$ as ka,a0 as Ca,a1 as Ea,a2 as As,a3 as Aa,a4 as Is,a5 as wr,a6 as dn,a7 as Ia}from"./ui-B88RtTAK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var un={exports:{}},rs={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ta=y,Oa=Symbol.for("react.element"),$a=Symbol.for("react.fragment"),Ra=Object.prototype.hasOwnProperty,Pa=Ta.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ua={key:!0,ref:!0,__self:!0,__source:!0};function hn(n,t,s){var r,a={},i=null,o=null;s!==void 0&&(i=""+s),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)Ra.call(t,r)&&!Ua.hasOwnProperty(r)&&(a[r]=t[r]);if(n&&n.defaultProps)for(r in t=n.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:Oa,type:n,key:i,ref:o,props:a,_owner:Pa.current}}rs.Fragment=$a;rs.jsx=hn;rs.jsxs=hn;un.exports=rs;var e=un.exports,mn,br=ya;mn=br.createRoot,br.hydrateRoot;const Da="modulepreload",La=function(n){return"/"+n},Nr={},ht=function(t,s,r){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");a=Promise.allSettled(s.map(c=>{if(c=La(c),c in Nr)return;Nr[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":Da,d||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),d)return new Promise((g,b)=>{m.addEventListener("load",g),m.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},Fa=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...s)=>ht(async()=>{const{default:r}=await Promise.resolve().then(()=>mt);return{default:r}},void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)};class Qs extends Error{constructor(t,s="FunctionsError",r){super(t),this.name=s,this.context=r}}class _r extends Qs{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Sr extends Qs{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class kr extends Qs{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Ts;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Ts||(Ts={}));var Ma=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};class Ba{constructor(t,{headers:s={},customFetch:r,region:a=Ts.Any}={}){this.url=t,this.headers=s,this.region=a,this.fetch=Fa(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,s={}){var r;return Ma(this,void 0,void 0,function*(){try{const{headers:a,method:i,body:o,signal:l}=s;let c={},{region:d}=s;d||(d=this.region);const u=new URL(`${this.url}/${t}`);d&&d!=="any"&&(c["x-region"]=d,u.searchParams.set("forceFunctionRegion",d));let m;o&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",m=o):typeof o=="string"?(c["Content-Type"]="text/plain",m=o):typeof FormData<"u"&&o instanceof FormData?m=o:(c["Content-Type"]="application/json",m=JSON.stringify(o)));const g=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),a),body:m,signal:l}).catch(v=>{throw v.name==="AbortError"?v:new _r(v)}),b=g.headers.get("x-relay-error");if(b&&b==="true")throw new Sr(g);if(!g.ok)throw new kr(g);let x=((r=g.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),h;return x==="application/json"?h=yield g.json():x==="application/octet-stream"?h=yield g.blob():x==="text/event-stream"?h=g:x==="multipart/form-data"?h=yield g.formData():h=yield g.text(),{data:h,error:null,response:g}}catch(a){return a instanceof Error&&a.name==="AbortError"?{data:null,error:new _r(a)}:{data:null,error:a,response:a instanceof kr||a instanceof Sr?a.context:void 0}}})}}var fe={},er={},ns={},Ot={},as={},is={},Ja=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ut=Ja();const qa=ut.fetch,fn=ut.fetch.bind(ut),gn=ut.Headers,za=ut.Request,Va=ut.Response,mt=Object.freeze(Object.defineProperty({__proto__:null,Headers:gn,Request:za,Response:Va,default:fn,fetch:qa},Symbol.toStringTag,{value:"Module"})),Wa=wa(mt);var os={};Object.defineProperty(os,"__esModule",{value:!0});let Ha=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};os.default=Ha;var xn=Ne&&Ne.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(is,"__esModule",{value:!0});const Ga=xn(Wa),Ka=xn(os);let Ya=class{constructor(t){var s,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(s=t.shouldThrowOnError)!==null&&s!==void 0?s:!1,this.signal=t.signal,this.isMaybeSingle=(r=t.isMaybeSingle)!==null&&r!==void 0?r:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=Ga.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,s){return this.headers=new Headers(this.headers),this.headers.set(t,s),this}then(t,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,c,d;let u=null,m=null,g=null,b=i.status,x=i.statusText;if(i.ok){if(this.method!=="HEAD"){const j=await i.text();j===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?m=j:m=JSON.parse(j))}const v=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),p=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");v&&p&&p.length>1&&(g=parseInt(p[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(u={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,g=null,b=406,x="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const v=await i.text();try{u=JSON.parse(v),Array.isArray(u)&&i.status===404&&(m=[],u=null,b=200,x="OK")}catch{i.status===404&&v===""?(b=204,x="No Content"):u={message:v}}if(u&&this.isMaybeSingle&&(!((d=u?.details)===null||d===void 0)&&d.includes("0 rows"))&&(u=null,b=200,x="OK"),u&&this.shouldThrowOnError)throw new Ka.default(u)}return{error:u,data:m,count:g,status:b,statusText:x}});return this.shouldThrowOnError||(a=a.catch(i=>{var o,l,c;return{error:{message:`${(o=i?.name)!==null&&o!==void 0?o:"FetchError"}: ${i?.message}`,details:`${(l=i?.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),a.then(t,s)}returns(){return this}overrideTypes(){return this}};is.default=Ya;var Xa=Ne&&Ne.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(as,"__esModule",{value:!0});const Za=Xa(is);let Qa=class extends Za.default{select(t){let s=!1;const r=(t??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:s=!0,nullsFirst:r,foreignTable:a,referencedTable:i=a}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${t}.${s?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:s,referencedTable:r=s}={}){const a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${t}`),this}range(t,s,{foreignTable:r,referencedTable:a=r}={}){const i=typeof a>"u"?"offset":`${a}.offset`,o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(o,`${s-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:s=!1,settings:r=!1,buffers:a=!1,wal:i=!1,format:o="text"}={}){var l;const c=[t?"analyze":null,s?"verbose":null,r?"settings":null,a?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${d}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};as.default=Qa;var ei=Ne&&Ne.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ot,"__esModule",{value:!0});const ti=ei(as);let si=class extends ti.default{eq(t,s){return this.url.searchParams.append(t,`eq.${s}`),this}neq(t,s){return this.url.searchParams.append(t,`neq.${s}`),this}gt(t,s){return this.url.searchParams.append(t,`gt.${s}`),this}gte(t,s){return this.url.searchParams.append(t,`gte.${s}`),this}lt(t,s){return this.url.searchParams.append(t,`lt.${s}`),this}lte(t,s){return this.url.searchParams.append(t,`lte.${s}`),this}like(t,s){return this.url.searchParams.append(t,`like.${s}`),this}likeAllOf(t,s){return this.url.searchParams.append(t,`like(all).{${s.join(",")}}`),this}likeAnyOf(t,s){return this.url.searchParams.append(t,`like(any).{${s.join(",")}}`),this}ilike(t,s){return this.url.searchParams.append(t,`ilike.${s}`),this}ilikeAllOf(t,s){return this.url.searchParams.append(t,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(t,s){return this.url.searchParams.append(t,`ilike(any).{${s.join(",")}}`),this}is(t,s){return this.url.searchParams.append(t,`is.${s}`),this}in(t,s){const r=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}contains(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cs.{${s.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(s)}`),this}containedBy(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cd.{${s.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(s)}`),this}rangeGt(t,s){return this.url.searchParams.append(t,`sr.${s}`),this}rangeGte(t,s){return this.url.searchParams.append(t,`nxl.${s}`),this}rangeLt(t,s){return this.url.searchParams.append(t,`sl.${s}`),this}rangeLte(t,s){return this.url.searchParams.append(t,`nxr.${s}`),this}rangeAdjacent(t,s){return this.url.searchParams.append(t,`adj.${s}`),this}overlaps(t,s){return typeof s=="string"?this.url.searchParams.append(t,`ov.${s}`):this.url.searchParams.append(t,`ov.{${s.join(",")}}`),this}textSearch(t,s,{config:r,type:a}={}){let i="";a==="plain"?i="pl":a==="phrase"?i="ph":a==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${i}fts${o}.${s}`),this}match(t){return Object.entries(t).forEach(([s,r])=>{this.url.searchParams.append(s,`eq.${r}`)}),this}not(t,s,r){return this.url.searchParams.append(t,`not.${s}.${r}`),this}or(t,{foreignTable:s,referencedTable:r=s}={}){const a=r?`${r}.or`:"or";return this.url.searchParams.append(a,`(${t})`),this}filter(t,s,r){return this.url.searchParams.append(t,`${s}.${r}`),this}};Ot.default=si;var ri=Ne&&Ne.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ns,"__esModule",{value:!0});const vt=ri(Ot);let ni=class{constructor(t,{headers:s={},schema:r,fetch:a}){this.url=t,this.headers=new Headers(s),this.schema=r,this.fetch=a}select(t,{head:s=!1,count:r}={}){const a=s?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new vt.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:s,defaultToNull:r=!0}={}){var a;const i="POST";if(s&&this.headers.append("Prefer",`count=${s}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const o=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new vt.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(t,{onConflict:s,ignoreDuplicates:r=!1,count:a,defaultToNull:i=!0}={}){var o;const l="POST";if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),a&&this.headers.append("Prefer",`count=${a}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new vt.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(t,{count:s}={}){var r;const a="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new vt.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:t}={}){var s;const r="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new vt.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}};ns.default=ni;var pn=Ne&&Ne.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(er,"__esModule",{value:!0});const ai=pn(ns),ii=pn(Ot);let oi=class vn{constructor(t,{headers:s={},schema:r,fetch:a}={}){this.url=t,this.headers=new Headers(s),this.schemaName=r,this.fetch=a}from(t){const s=new URL(`${this.url}/${t}`);return new ai.default(s,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new vn(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:r=!1,get:a=!1,count:i}={}){var o;let l;const c=new URL(`${this.url}/rpc/${t}`);let d;r||a?(l=r?"HEAD":"GET",Object.entries(s).filter(([m,g])=>g!==void 0).map(([m,g])=>[m,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([m,g])=>{c.searchParams.append(m,g)})):(l="POST",d=s);const u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new ii.default({method:l,url:c,headers:u,schema:this.schemaName,body:d,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};er.default=oi;var ft=Ne&&Ne.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(fe,"__esModule",{value:!0});fe.PostgrestError=fe.PostgrestBuilder=fe.PostgrestTransformBuilder=fe.PostgrestFilterBuilder=fe.PostgrestQueryBuilder=fe.PostgrestClient=void 0;const jn=ft(er);fe.PostgrestClient=jn.default;const yn=ft(ns);fe.PostgrestQueryBuilder=yn.default;const wn=ft(Ot);fe.PostgrestFilterBuilder=wn.default;const bn=ft(as);fe.PostgrestTransformBuilder=bn.default;const Nn=ft(is);fe.PostgrestBuilder=Nn.default;const _n=ft(os);fe.PostgrestError=_n.default;var li=fe.default={PostgrestClient:jn.default,PostgrestQueryBuilder:yn.default,PostgrestFilterBuilder:wn.default,PostgrestTransformBuilder:bn.default,PostgrestBuilder:Nn.default,PostgrestError:_n.default};const{PostgrestClient:ci,PostgrestQueryBuilder:gd,PostgrestFilterBuilder:xd,PostgrestTransformBuilder:pd,PostgrestBuilder:vd,PostgrestError:jd}=li;class di{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const s=process.versions;if(s&&s.node){const r=s.node,a=parseInt(r.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const r=this.getWebSocketConstructor();return new r(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const ui="2.15.5",hi=`realtime-js/${ui}`,mi="1.0.0",Os=1e4,fi=1e3,gi=100;var bt;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(bt||(bt={}));var le;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(le||(le={}));var _e;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(_e||(_e={}));var $s;(function(n){n.websocket="websocket"})($s||($s={}));var He;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(He||(He={}));class xi{constructor(){this.HEADER_LENGTH=1}decode(t,s){return t.constructor===ArrayBuffer?s(this._binaryDecode(t)):s(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const s=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,s,r)}_decodeBroadcast(t,s,r){const a=s.getUint8(1),i=s.getUint8(2);let o=this.HEADER_LENGTH+2;const l=r.decode(t.slice(o,o+a));o=o+a;const c=r.decode(t.slice(o,o+i));o=o+i;const d=JSON.parse(r.decode(t.slice(o,t.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class Sn{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var X;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(X||(X={}));const Cr=(n,t,s={})=>{var r;const a=(r=s.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(t).reduce((i,o)=>(i[o]=pi(o,n,t,a),i),{})},pi=(n,t,s,r)=>{const a=t.find(l=>l.name===n),i=a?.type,o=s[n];return i&&!r.includes(i)?kn(i,o):Rs(o)},kn=(n,t)=>{if(n.charAt(0)==="_"){const s=n.slice(1,n.length);return wi(t,s)}switch(n){case X.bool:return vi(t);case X.float4:case X.float8:case X.int2:case X.int4:case X.int8:case X.numeric:case X.oid:return ji(t);case X.json:case X.jsonb:return yi(t);case X.timestamp:return bi(t);case X.abstime:case X.date:case X.daterange:case X.int4range:case X.int8range:case X.money:case X.reltime:case X.text:case X.time:case X.timestamptz:case X.timetz:case X.tsrange:case X.tstzrange:return Rs(t);default:return Rs(t)}},Rs=n=>n,vi=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},ji=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},yi=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(t){return console.log(`JSON parse error: ${t}`),n}return n},wi=(n,t)=>{if(typeof n!="string")return n;const s=n.length-1,r=n[s];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,s);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>kn(t,l))}return n},bi=n=>typeof n=="string"?n.replace(" ","T"):n,Cn=n=>{let t=n;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class hs{constructor(t,s,r={},a=Os){this.channel=t,this.event=s,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var r;return this._hasReceived(t)&&s((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Er;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Er||(Er={}));class Nt{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=s?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Nt.syncState(this.state,a,i,o),this.pendingDiffs.forEach(c=>{this.state=Nt.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Nt.syncDiff(this.state,a,i,o),l())}),this.onJoin((a,i,o)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:o})}),this.onLeave((a,i,o)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,r,a){const i=this.cloneDeep(t),o=this.transformState(s),l={},c={};return this.map(i,(d,u)=>{o[d]||(c[d]=u)}),this.map(o,(d,u)=>{const m=i[d];if(m){const g=u.map(v=>v.presence_ref),b=m.map(v=>v.presence_ref),x=u.filter(v=>b.indexOf(v.presence_ref)<0),h=m.filter(v=>g.indexOf(v.presence_ref)<0);x.length>0&&(l[d]=x),h.length>0&&(c[d]=h)}else l[d]=u}),this.syncDiff(i,{joins:l,leaves:c},r,a)}static syncDiff(t,s,r,a){const{joins:i,leaves:o}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(i,(l,c)=>{var d;const u=(d=t[l])!==null&&d!==void 0?d:[];if(t[l]=this.cloneDeep(c),u.length>0){const m=t[l].map(b=>b.presence_ref),g=u.filter(b=>m.indexOf(b.presence_ref)<0);t[l].unshift(...g)}r(l,u,c)}),this.map(o,(l,c)=>{let d=t[l];if(!d)return;const u=c.map(m=>m.presence_ref);d=d.filter(m=>u.indexOf(m.presence_ref)<0),t[l]=d,a(l,d,c),d.length===0&&delete t[l]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(r=>s(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,r)=>{const a=t[r];return"metas"in a?s[r]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):s[r]=a,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ar;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Ar||(Ar={}));var _t;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(_t||(_t={}));var Re;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Re||(Re={}));class tr{constructor(t,s={config:{}},r){this.topic=t,this.params=s,this.socket=r,this.bindings={},this.state=le.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new hs(this,_e.join,this.params,this.timeout),this.rejoinTimer=new Sn(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=le.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=le.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=le.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=le.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=le.errored,this.rejoinTimer.scheduleTimeout())}),this._on(_e.reply,{},(a,i)=>{this._trigger(this._replyEventName(i),a)}),this.presence=new Nt(this),this.broadcastEndpointURL=Cn(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(t,s=this.timeout){var r,a,i;if(this.socket.isConnected()||this.socket.connect(),this.state==le.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,d=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(b=>b.filter))!==null&&a!==void 0?a:[],u=!!this.bindings[_t.PRESENCE]&&this.bindings[_t.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,m={},g={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(b=>t?.(Re.CHANNEL_ERROR,b)),this._onClose(()=>t?.(Re.CLOSED)),this.updateJoinPayload(Object.assign({config:g},m)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:b})=>{var x;if(this.socket.setAuth(),b===void 0){t?.(Re.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,v=(x=h?.length)!==null&&x!==void 0?x:0,p=[];for(let j=0;j<v;j++){const f=h[j],{filter:{event:w,schema:_,table:N,filter:C}}=f,P=b&&b[j];if(P&&P.event===w&&P.schema===_&&P.table===N&&P.filter===C)p.push(Object.assign(Object.assign({},f),{id:P.id}));else{this.unsubscribe(),this.state=le.errored,t?.(Re.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,t&&t(Re.SUBSCRIBED);return}}).receive("error",b=>{this.state=le.errored,t?.(Re.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(b).join(", ")||"error")))}).receive("timeout",()=>{t?.(Re.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,r){return this.state===le.joined&&t===_t.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,s,r)}async send(t,s={}){var r,a;if(!this._canPush()&&t.type==="broadcast"){const{event:i,payload:o}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=s.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=d.body)===null||a===void 0?void 0:a.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const d=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=le.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(_e.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new hs(this,_e.leave,{},t),r.receive("ok",()=>{s(),a("ok")}).receive("timeout",()=>{s(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=le.closed,this.bindings={}}async _fetchWithTimeout(t,s,r){const a=new AbortController,i=setTimeout(()=>a.abort(),r),o=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:a.signal}));return clearTimeout(i),o}_push(t,s,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new hs(this,t,s,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>gi){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,r){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,r){var a,i;const o=t.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=_e;if(r&&[l,c,d,u].indexOf(o)>=0&&r!==this._joinRef())return;let g=this._onMessage(o,s,r);if(s&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(b=>{var x,h,v;return((x=b.filter)===null||x===void 0?void 0:x.event)==="*"||((v=(h=b.filter)===null||h===void 0?void 0:h.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(b=>b.callback(g,r)):(i=this.bindings[o])===null||i===void 0||i.filter(b=>{var x,h,v,p,j,f;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in b){const w=b.id,_=(x=b.filter)===null||x===void 0?void 0:x.event;return w&&((h=s.ids)===null||h===void 0?void 0:h.includes(w))&&(_==="*"||_?.toLocaleLowerCase()===((v=s.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const w=(j=(p=b?.filter)===null||p===void 0?void 0:p.event)===null||j===void 0?void 0:j.toLocaleLowerCase();return w==="*"||w===((f=s?.event)===null||f===void 0?void 0:f.toLocaleLowerCase())}else return b.type.toLocaleLowerCase()===o}).map(b=>{if(typeof g=="object"&&"ids"in g){const x=g.data,{schema:h,table:v,commit_timestamp:p,type:j,errors:f}=x;g=Object.assign(Object.assign({},{schema:h,table:v,commit_timestamp:p,eventType:j,new:{},old:{},errors:f}),this._getPayloadRecords(x))}b.callback(g,r)})}_isClosed(){return this.state===le.closed}_isJoined(){return this.state===le.joined}_isJoining(){return this.state===le.joining}_isLeaving(){return this.state===le.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,r){const a=t.toLocaleLowerCase(),i={type:a,filter:s,callback:r};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(t,s){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&tr.isEqual(a.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const r in t)if(t[r]!==s[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(_e.close,{},t)}_onError(t){this._on(_e.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=le.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=Cr(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=Cr(t.columns,t.old_record)),s}}const ms=()=>{},Dt={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Ni=[1e3,2e3,5e3,1e4],_i=1e4,Si=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ki{constructor(t,s){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Os,this.transport=null,this.heartbeatIntervalMs=Dt.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ms,this.ref=0,this.reconnectTimer=null,this.logger=ms,this.conn=null,this.sendBuffer=[],this.serializer=new xi,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>{let i;return a?i=a:typeof fetch>"u"?i=(...o)=>ht(async()=>{const{default:l}=await Promise.resolve().then(()=>mt);return{default:l}},void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((r=s?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${$s.websocket}`,this.httpEndpoint=Cn(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=di.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:mi}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},t?this.conn.close(t,s??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,r){this.logger(t,s,r)}connectionState(){switch(this.conn&&this.conn.readyState){case bt.connecting:return He.Connecting;case bt.open:return He.Open;case bt.closing:return He.Closing;default:return He.Closed}}isConnected(){return this.connectionState()===He.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const r=`realtime:${t}`,a=this.getChannels().find(i=>i.topic===r);if(a)return a;{const i=new tr(`realtime:${t}`,s,this);return this.channels.push(i),i}}push(t){const{topic:s,event:r,payload:a,ref:i}=t,o=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${s} ${r} (${i})`,a),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(fi,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},Dt.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:a,payload:i,ref:o}=s,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${a} ${l}`.trim(),i),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(a,i,o)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(_e.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const r=t.match(/\?/)?"&":"?",a=new URLSearchParams(s);return`${t}${r}${a}`}_workerObjectUrl(t){let s;if(t)s=t;else{const r=new Blob([Si],{type:"application/javascript"});s=URL.createObjectURL(r)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s;t?s=t:this.accessToken?s=await this.accessToken():s=this.accessTokenValue,this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(r=>{const a={access_token:s,version:hi};s&&r.updateJoinPayload(a),r.joinedOnce&&r._isJoined()&&r._push(_e.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(s=>{this.log("error",`error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(s)}catch(a){this.log("error",`error in ${t} callback`,a)}})}catch(r){this.log("error",`error triggering ${t} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Sn(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Dt.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,r,a,i,o,l,c,d,u;if(this.transport=(s=t?.transport)!==null&&s!==void 0?s:null,this.timeout=(r=t?.timeout)!==null&&r!==void 0?r:Os,this.heartbeatIntervalMs=(a=t?.heartbeatIntervalMs)!==null&&a!==void 0?a:Dt.HEARTBEAT_INTERVAL,this.worker=(i=t?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=t?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=t?.heartbeatCallback)!==null&&l!==void 0?l:ms,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t?.reconnectAfterMs)!==null&&c!==void 0?c:m=>Ni[m-1]||_i,this.encode=(d=t?.encode)!==null&&d!==void 0?d:(m,g)=>g(JSON.stringify(m)),this.decode=(u=t?.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}class sr extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function ie(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ci extends sr{constructor(t,s,r){super(t),this.name="StorageApiError",this.status=s,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ps extends sr{constructor(t,s){super(t),this.name="StorageUnknownError",this.originalError=s}}var Ei=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};const En=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...s)=>ht(async()=>{const{default:r}=await Promise.resolve().then(()=>mt);return{default:r}},void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)},Ai=()=>Ei(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ht(()=>Promise.resolve().then(()=>mt),void 0)).Response:Response}),Us=n=>{if(Array.isArray(n))return n.map(s=>Us(s));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([s,r])=>{const a=s.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[a]=Us(r)}),t},Ii=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Xe=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};const fs=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ti=(n,t,s)=>Xe(void 0,void 0,void 0,function*(){const r=yield Ai();n instanceof r&&!s?.noResolveJson?n.json().then(a=>{const i=n.status||500,o=a?.statusCode||i+"";t(new Ci(fs(a),i,o))}).catch(a=>{t(new Ps(fs(a),a))}):t(new Ps(fs(n),n))}),Oi=(n,t,s,r)=>{const a={method:n,headers:t?.headers||{}};return n==="GET"||!r?a:(Ii(r)?(a.headers=Object.assign({"Content-Type":"application/json"},t?.headers),a.body=JSON.stringify(r)):a.body=r,t?.duplex&&(a.duplex=t.duplex),Object.assign(Object.assign({},a),s))};function $t(n,t,s,r,a,i){return Xe(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(s,Oi(t,r,a,i)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Ti(c,l,r))})})}function Kt(n,t,s,r){return Xe(this,void 0,void 0,function*(){return $t(n,"GET",t,s,r)})}function Te(n,t,s,r,a){return Xe(this,void 0,void 0,function*(){return $t(n,"POST",t,r,a,s)})}function Ds(n,t,s,r,a){return Xe(this,void 0,void 0,function*(){return $t(n,"PUT",t,r,a,s)})}function $i(n,t,s,r){return Xe(this,void 0,void 0,function*(){return $t(n,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}function An(n,t,s,r,a){return Xe(this,void 0,void 0,function*(){return $t(n,"DELETE",t,r,a,s)})}var Ri=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};class Pi{constructor(t,s){this.downloadFn=t,this.shouldThrowOnError=s}then(t,s){return this.execute().then(t,s)}execute(){return Ri(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ie(t))return{data:null,error:t};throw t}})}}var Ui=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};class Di{constructor(t,s){this.downloadFn=t,this.shouldThrowOnError=s}asStream(){return new Pi(this.downloadFn,this.shouldThrowOnError)}then(t,s){return this.execute().then(t,s)}execute(){return Ui(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ie(t))return{data:null,error:t};throw t}})}}var me=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};const Li={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ir={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Fi{constructor(t,s={},r,a){this.shouldThrowOnError=!1,this.url=t,this.headers=s,this.bucketId=r,this.fetch=En(a)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,s,r,a){return me(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Ir),a);let l=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),a?.headers&&(l=Object.assign(Object.assign({},l),a.headers));const d=this._removeEmptyFolders(s),u=this._getFinalPath(d),m=yield(t=="PUT"?Ds:Te)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:l},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:d,id:m.Id,fullPath:m.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ie(i))return{data:null,error:i};throw i}})}upload(t,s,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,s,r)})}uploadToSignedUrl(t,s,r,a){return me(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(t),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",s);try{let c;const d=Object.assign({upsert:Ir.upsert},a),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const m=yield Ds(this.fetch,l.toString(),c,{headers:u});return{data:{path:i,fullPath:m.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(ie(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,s){return me(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t);const a=Object.assign({},this.headers);s?.upsert&&(a["x-upsert"]="true");const i=yield Te(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:a}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new sr("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:l},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ie(r))return{data:null,error:r};throw r}})}update(t,s,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,s,r)})}move(t,s,r){return me(this,void 0,void 0,function*(){try{return{data:yield Te(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ie(a))return{data:null,error:a};throw a}})}copy(t,s,r){return me(this,void 0,void 0,function*(){try{return{data:{path:(yield Te(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ie(a))return{data:null,error:a};throw a}})}createSignedUrl(t,s,r){return me(this,void 0,void 0,function*(){try{let a=this._getFinalPath(t),i=yield Te(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:s},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ie(a))return{data:null,error:a};throw a}})}createSignedUrls(t,s,r){return me(this,void 0,void 0,function*(){try{const a=yield Te(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:t},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ie(a))return{data:null,error:a};throw a}})}download(t,s){const a=typeof s?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(s?.transform||{}),o=i?`?${i}`:"",l=this._getFinalPath(t),c=()=>Kt(this.fetch,`${this.url}/${a}/${l}${o}`,{headers:this.headers,noResolveJson:!0});return new Di(c,this.shouldThrowOnError)}info(t){return me(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{const r=yield Kt(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:Us(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ie(r))return{data:null,error:r};throw r}})}exists(t){return me(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{return yield $i(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ie(r)&&r instanceof Ps){const a=r.originalError;if([400,404].includes(a?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,s){const r=this._getFinalPath(t),a=[],i=s?.download?`download=${s.download===!0?"":s.download}`:"";i!==""&&a.push(i);const l=typeof s?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(s?.transform||{});c!==""&&a.push(c);let d=a.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${d}`)}}}remove(t){return me(this,void 0,void 0,function*(){try{return{data:yield An(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ie(s))return{data:null,error:s};throw s}})}list(t,s,r){return me(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},Li),s),{prefix:t||""});return{data:yield Te(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ie(a))return{data:null,error:a};throw a}})}listV2(t,s){return me(this,void 0,void 0,function*(){try{const r=Object.assign({},t);return{data:yield Te(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ie(r))return{data:null,error:r};throw r}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const s=[];return t.width&&s.push(`width=${t.width}`),t.height&&s.push(`height=${t.height}`),t.resize&&s.push(`resize=${t.resize}`),t.format&&s.push(`format=${t.format}`),t.quality&&s.push(`quality=${t.quality}`),s.join("&")}}const Mi="2.12.2",Bi={"X-Client-Info":`storage-js/${Mi}`};var Qe=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};class Ji{constructor(t,s={},r,a){this.shouldThrowOnError=!1;const i=new URL(t);a?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},Bi),s),this.fetch=En(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Qe(this,void 0,void 0,function*(){try{return{data:yield Kt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ie(t))return{data:null,error:t};throw t}})}getBucket(t){return Qe(this,void 0,void 0,function*(){try{return{data:yield Kt(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ie(s))return{data:null,error:s};throw s}})}createBucket(t,s={public:!1}){return Qe(this,void 0,void 0,function*(){try{return{data:yield Te(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ie(r))return{data:null,error:r};throw r}})}updateBucket(t,s){return Qe(this,void 0,void 0,function*(){try{return{data:yield Ds(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ie(r))return{data:null,error:r};throw r}})}emptyBucket(t){return Qe(this,void 0,void 0,function*(){try{return{data:yield Te(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ie(s))return{data:null,error:s};throw s}})}deleteBucket(t){return Qe(this,void 0,void 0,function*(){try{return{data:yield An(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ie(s))return{data:null,error:s};throw s}})}}class qi extends Ji{constructor(t,s={},r,a){super(t,s,r,a)}from(t){return new Fi(this.url,this.headers,t,this.fetch)}}const zi="2.58.0";let wt="";typeof Deno<"u"?wt="deno":typeof document<"u"?wt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?wt="react-native":wt="node";const Vi={"X-Client-Info":`supabase-js-${wt}/${zi}`},Wi={headers:Vi},Hi={schema:"public"},Gi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ki={};var Yi=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};const Xi=n=>{let t;return n?t=n:typeof fetch>"u"?t=fn:t=fetch,(...s)=>t(...s)},Zi=()=>typeof Headers>"u"?gn:Headers,Qi=(n,t,s)=>{const r=Xi(s),a=Zi();return(i,o)=>Yi(void 0,void 0,void 0,function*(){var l;const c=(l=yield t())!==null&&l!==void 0?l:n;let d=new a(o?.headers);return d.has("apikey")||d.set("apikey",n),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:d}))})};var eo=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};function to(n){return n.endsWith("/")?n:n+"/"}function so(n,t){var s,r;const{db:a,auth:i,realtime:o,global:l}=n,{db:c,auth:d,realtime:u,global:m}=t,g={db:Object.assign(Object.assign({},c),a),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},m),l),{headers:Object.assign(Object.assign({},(s=m?.headers)!==null&&s!==void 0?s:{}),(r=l?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>eo(this,void 0,void 0,function*(){return""})};return n.accessToken?g.accessToken=n.accessToken:delete g.accessToken,g}function ro(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(to(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const In="2.72.0",nt=30*1e3,Ls=3,gs=Ls*nt,no="http://localhost:9999",ao="supabase.auth.token",io={"X-Client-Info":`gotrue-js/${In}`},Fs="X-Supabase-Api-Version",Tn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},oo=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,lo=10*60*1e3;class rr extends Error{constructor(t,s,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=r}}function M(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class co extends rr{constructor(t,s,r){super(t,s,r),this.name="AuthApiError",this.status=s,this.code=r}}function uo(n){return M(n)&&n.name==="AuthApiError"}class On extends rr{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class Je extends rr{constructor(t,s,r,a){super(t,r,a),this.name=s,this.status=r}}class Le extends Je{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ho(n){return M(n)&&n.name==="AuthSessionMissingError"}class jt extends Je{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Lt extends Je{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Ft extends Je{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function mo(n){return M(n)&&n.name==="AuthImplicitGrantRedirectError"}class Tr extends Je{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ms extends Je{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function xs(n){return M(n)&&n.name==="AuthRetryableFetchError"}class Or extends Je{constructor(t,s,r){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=r}}class Bs extends Je{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Yt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),$r=` 	
\r=`.split(""),fo=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<$r.length;t+=1)n[$r[t].charCodeAt(0)]=-2;for(let t=0;t<Yt.length;t+=1)n[Yt[t].charCodeAt(0)]=t;return n})();function Rr(n,t,s){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;s(Yt[r]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;s(Yt[r]),t.queuedBits-=6}}function $n(n,t,s){const r=fo[n];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Pr(n){const t=[],s=o=>{t.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=o=>{po(o,r,s)};for(let o=0;o<n.length;o+=1)$n(n.charCodeAt(o),a,i);return t.join("")}function go(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function xo(n,t){for(let s=0;s<n.length;s+=1){let r=n.charCodeAt(s);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(n.charCodeAt(s+1)-56320&65535|a)+65536,s+=1}go(r,t)}}function po(n,t,s){if(t.utf8seq===0){if(n<=127){s(n);return}for(let r=1;r<6;r+=1)if(!(n>>7-r&1)){t.utf8seq=r;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function vo(n){const t=[],s={queue:0,queuedBits:0},r=a=>{t.push(a)};for(let a=0;a<n.length;a+=1)$n(n.charCodeAt(a),s,r);return new Uint8Array(t)}function jo(n){const t=[];return xo(n,s=>t.push(s)),new Uint8Array(t)}function yo(n){const t=[],s={queue:0,queuedBits:0},r=a=>{t.push(a)};return n.forEach(a=>Rr(a,s,r)),Rr(null,s,r),t.join("")}function wo(n){return Math.round(Date.now()/1e3)+n}function bo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const t=Math.random()*16|0;return(n=="x"?t:t&3|8).toString(16)})}const ye=()=>typeof window<"u"&&typeof document<"u",ze={tested:!1,writable:!1},Rn=()=>{if(!ye())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ze.tested)return ze.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ze.tested=!0,ze.writable=!0}catch{ze.tested=!0,ze.writable=!1}return ze.writable};function No(n){const t={},s=new URL(n);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((a,i)=>{t[i]=a})}catch{}return s.searchParams.forEach((r,a)=>{t[a]=r}),t}const Pn=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...s)=>ht(async()=>{const{default:r}=await Promise.resolve().then(()=>mt);return{default:r}},void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)},_o=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",at=async(n,t,s)=>{await n.setItem(t,JSON.stringify(s))},Ve=async(n,t)=>{const s=await n.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},De=async(n,t)=>{await n.removeItem(t)};class ls{constructor(){this.promise=new ls.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}ls.promiseConstructor=Promise;function ps(n){const t=n.split(".");if(t.length!==3)throw new Bs("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!oo.test(t[r]))throw new Bs("JWT not in base64url format");return{header:JSON.parse(Pr(t[0])),payload:JSON.parse(Pr(t[1])),signature:vo(t[2]),raw:{header:t[0],payload:t[1]}}}async function So(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function ko(n,t){return new Promise((r,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!t(i,null,o)){r(o);return}}catch(o){if(!t(i,o)){a(o);return}}})()})}function Co(n){return("0"+n.toString(16)).substr(-2)}function Eo(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=s.length;let a="";for(let i=0;i<56;i++)a+=s.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(t),Array.from(t,Co).join("")}async function Ao(n){const s=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",s),a=new Uint8Array(r);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function Io(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const s=await Ao(n);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function et(n,t,s=!1){const r=Eo();let a=r;s&&(a+="/PASSWORD_RECOVERY"),await at(n,`${t}-code-verifier`,a);const i=await Io(r);return[i,r===i?"plain":"s256"]}const To=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Oo(n){const t=n.headers.get(Fs);if(!t||!t.match(To))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function $o(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function Ro(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Po=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function tt(n){if(!Po.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function vs(){const n={};return new Proxy(n,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const r=s.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ur(n){return JSON.parse(JSON.stringify(n))}var Uo=function(n,t){var s={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(s[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(s[r[a]]=n[r[a]]);return s};const We=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Do=[502,503,504];async function Dr(n){var t;if(!_o(n))throw new Ms(We(n),0);if(Do.includes(n.status))throw new Ms(We(n),n.status);let s;try{s=await n.json()}catch(i){throw new On(We(i),i)}let r;const a=Oo(n);if(a&&a.getTime()>=Tn["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?r=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(r=s.error_code),r){if(r==="weak_password")throw new Or(We(s),n.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new Le}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Or(We(s),n.status,s.weak_password.reasons);throw new co(We(s),n.status||500,r)}const Lo=(n,t,s,r)=>{const a={method:n,headers:t?.headers||{}};return n==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),s))};async function z(n,t,s,r){var a;const i=Object.assign({},r?.headers);i[Fs]||(i[Fs]=Tn["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(a=r?.query)!==null&&a!==void 0?a:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Fo(n,t,s+l,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}}async function Fo(n,t,s,r,a,i){const o=Lo(t,r,a,i);let l;try{l=await n(s,Object.assign({},o))}catch(c){throw console.error(c),new Ms(We(c),0)}if(l.ok||await Dr(l),r?.noResolveJson)return l;try{return await l.json()}catch(c){await Dr(c)}}function Ie(n){var t;let s=null;qo(n)&&(s=Object.assign({},n),n.expires_at||(s.expires_at=wo(n.expires_in)));const r=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:s,user:r},error:null}}function Lr(n){const t=Ie(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((s,r)=>s&&typeof r=="string",!0)&&(t.data.weak_password=n.weak_password),t}function Fe(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function Mo(n){return{data:n,error:null}}function Bo(n){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i}=n,o=Uo(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function Jo(n){return n}function qo(n){return n.access_token&&n.refresh_token&&n.expires_in}const js=["global","local","others"];var zo=function(n,t){var s={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(s[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(s[r[a]]=n[r[a]]);return s};class Vo{constructor({url:t="",headers:s={},fetch:r}){this.url=t,this.headers=s,this.fetch=Pn(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,s=js[0]){if(js.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${js.join(", ")}`);try{return await z(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(M(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,s={}){try{return await z(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Fe})}catch(r){if(M(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:s}=t,r=zo(t,["options"]),a=Object.assign(Object.assign({},r),s);return"newEmail"in r&&(a.new_email=r?.newEmail,delete a.newEmail),await z(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:Bo,redirectTo:s?.redirectTo})}catch(s){if(M(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await z(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Fe})}catch(s){if(M(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,r,a,i,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await z(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=t?.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:Jo});if(u.error)throw u.error;const m=await u.json(),g=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,b=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return b.length>0&&(b.forEach(x=>{const h=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(x.split(";")[1].split("=")[1]);d[`${v}Page`]=h}),d.total=parseInt(g)),{data:Object.assign(Object.assign({},m),d),error:null}}catch(d){if(M(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){tt(t);try{return await z(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Fe})}catch(s){if(M(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){tt(t);try{return await z(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:Fe})}catch(r){if(M(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,s=!1){tt(t);try{return await z(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:Fe})}catch(r){if(M(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){tt(t.userId);try{const{data:s,error:r}=await z(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:s,error:r}}catch(s){if(M(s))return{data:null,error:s};throw s}}async _deleteFactor(t){tt(t.userId),tt(t.id);try{return{data:await z(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(M(s))return{data:null,error:s};throw s}}}function Fr(n={}){return{getItem:t=>n[t]||null,setItem:(t,s)=>{n[t]=s},removeItem:t=>{delete n[t]}}}function Wo(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const st={debug:!!(globalThis&&Rn()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Un extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Ho extends Un{}async function Go(n,t,s){st.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),st.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){st.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,a.name);try{return await s()}finally{st.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,a.name)}}else{if(t===0)throw st.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Ho(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(st.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}function Dn(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function Ko(n){return parseInt(n,16)}function Yo(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,r=>r.toString(16).padStart(2,"0")).join("")}function Xo(n){var t;const{chainId:s,domain:r,expirationTime:a,issuedAt:i=new Date,nonce:o,notBefore:l,requestId:c,resources:d,scheme:u,uri:m,version:g}=n;{if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(g!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${g}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const b=Dn(n.address),x=u?`${u}://${r}`:r,h=n.statement?`${n.statement}
`:"",v=`${x} wants you to sign in with your Ethereum account:
${b}

${h}`;let p=`URI: ${m}
Version: ${g}
Chain ID: ${s}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(a&&(p+=`
Expiration Time: ${a.toISOString()}`),l&&(p+=`
Not Before: ${l.toISOString()}`),c&&(p+=`
Request ID: ${c}`),d){let j=`
Resources:`;for(const f of d){if(!f||typeof f!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${f}`);j+=`
- ${f}`}p+=j}return`${v}
${p}`}Wo();const Zo={url:no,storageKey:ao,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:io,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Mr(n,t,s){return await s()}const rt={};class Et{constructor(t){var s,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Et.nextInstanceID,Et.nextInstanceID+=1,this.instanceID>0&&ye()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},Zo),t);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new Vo({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=Pn(a.fetch),this.lock=a.lock||Mr,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:ye()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=Go:this.lock=Mr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:Rn()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Fr(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=Fr(this.memoryStorage)),ye()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var t,s;return(s=(t=rt[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){rt[this.storageKey]=Object.assign(Object.assign({},rt[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=rt[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){rt[this.storageKey]=Object.assign(Object.assign({},rt[this.storageKey]),{cachedAt:t})}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${In}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const s=No(window.location.href);let r="none";if(this._isImplicitGrantCallback(s)?r="implicit":await this._isPKCECallback(s)&&(r="pkce"),ye()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:i}=await this._getSessionFromURL(s,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),mo(i)){const c=(t=i.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=a;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return M(s)?{error:s}:{error:new On("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,r,a;try{const i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(s=t?.options)===null||s===void 0?void 0:s.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=t?.options)===null||a===void 0?void 0:a.captchaToken}},xform:Ie}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(M(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(t){var s,r,a;try{let i;if("email"in t){const{email:u,password:m,options:g}=t;let b=null,x=null;this.flowType==="pkce"&&([b,x]=await et(this.storage,this.storageKey)),i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g?.emailRedirectTo,body:{email:u,password:m,data:(s=g?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:g?.captchaToken},code_challenge:b,code_challenge_method:x},xform:Ie})}else if("phone"in t){const{phone:u,password:m,options:g}=t;i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:m,data:(r=g?.data)!==null&&r!==void 0?r:{},channel:(a=g?.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:g?.captchaToken}},xform:Ie})}else throw new Lt("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(M(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(t){try{let s;if("email"in t){const{email:i,password:o,options:l}=t;s=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:Lr})}else if("phone"in t){const{phone:i,password:o,options:l}=t;s=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:Lr})}else throw new Lt("You must provide either an email or phone number and a password");const{data:r,error:a}=s;return a?{data:{user:null,session:null},error:a}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new jt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(s){if(M(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(t){var s,r,a,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=t.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;switch(s){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}}async signInWithEthereum(t){var s,r,a,i,o,l,c,d,u,m,g;let b,x;if("message"in t)b=t.message,x=t.signature;else{const{chain:h,wallet:v,statement:p,options:j}=t;let f;if(ye())if(typeof v=="object")f=v;else{const D=window;if("ethereum"in D&&typeof D.ethereum=="object"&&"request"in D.ethereum&&typeof D.ethereum.request=="function")f=D.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!j?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");f=v}const w=new URL((s=j?.url)!==null&&s!==void 0?s:window.location.href),_=await f.request({method:"eth_requestAccounts"}).then(D=>D).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!_||_.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const N=Dn(_[0]);let C=(r=j?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!C){const D=await f.request({method:"eth_chainId"});C=Ko(D)}const P={domain:w.host,address:N,statement:p,uri:w.href,version:"1",chainId:C,nonce:(a=j?.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(o=(i=j?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=j?.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=j?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=j?.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=j?.signInWithEthereum)===null||u===void 0?void 0:u.resources};b=Xo(P),x=await f.request({method:"personal_sign",params:[Yo(b),N]})}try{const{data:h,error:v}=await z(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:b,signature:x},!((m=t.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(g=t.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Ie});if(v)throw v;return!h||!h.session||!h.user?{data:{user:null,session:null},error:new jt}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:Object.assign({},h),error:v})}catch(h){if(M(h))return{data:{user:null,session:null},error:h};throw h}}async signInWithSolana(t){var s,r,a,i,o,l,c,d,u,m,g,b;let x,h;if("message"in t)x=t.message,h=t.signature;else{const{chain:v,wallet:p,statement:j,options:f}=t;let w;if(ye())if(typeof p=="object")w=p;else{const N=window;if("solana"in N&&typeof N.solana=="object"&&("signIn"in N.solana&&typeof N.solana.signIn=="function"||"signMessage"in N.solana&&typeof N.solana.signMessage=="function"))w=N.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof p!="object"||!f?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=p}const _=new URL((s=f?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in w&&w.signIn){const N=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},f?.signInWithSolana),{version:"1",domain:_.host,uri:_.href}),j?{statement:j}:null));let C;if(Array.isArray(N)&&N[0]&&typeof N[0]=="object")C=N[0];else if(N&&typeof N=="object"&&"signedMessage"in N&&"signature"in N)C=N;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in C&&"signature"in C&&(typeof C.signedMessage=="string"||C.signedMessage instanceof Uint8Array)&&C.signature instanceof Uint8Array)x=typeof C.signedMessage=="string"?C.signedMessage:new TextDecoder().decode(C.signedMessage),h=C.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${_.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...j?["",j,""]:[""],"Version: 1",`URI: ${_.href}`,`Issued At: ${(a=(r=f?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=f?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${f.signInWithSolana.notBefore}`]:[],...!((o=f?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${f.signInWithSolana.expirationTime}`]:[],...!((l=f?.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${f.signInWithSolana.chainId}`]:[],...!((c=f?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${f.signInWithSolana.nonce}`]:[],...!((d=f?.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${f.signInWithSolana.requestId}`]:[],...!((m=(u=f?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||m===void 0)&&m.length?["Resources",...f.signInWithSolana.resources.map(C=>`- ${C}`)]:[]].join(`
`);const N=await w.signMessage(new TextEncoder().encode(x),"utf8");if(!N||!(N instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");h=N}}try{const{data:v,error:p}=await z(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:yo(h)},!((g=t.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(b=t.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:Ie});if(p)throw p;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new jt}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:p})}catch(v){if(M(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(t){const s=await Ve(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(s??"").split("/");try{const{data:i,error:o}=await z(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:Ie});if(await De(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new jt}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:o})}catch(i){if(M(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(t){try{const{options:s,provider:r,token:a,access_token:i,nonce:o}=t,l=await z(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Ie}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new jt}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(s){if(M(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(t){var s,r,a,i,o;try{if("email"in t){const{email:l,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await et(this.storage,this.storageKey));const{error:m}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(r=c?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in t){const{phone:l,options:c}=t,{data:d,error:u}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(a=c?.data)!==null&&a!==void 0?a:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:d?.message_id},error:u}}throw new Lt("You must provide either an email or phone number.")}catch(l){if(M(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(t){var s,r;try{let a,i;"options"in t&&(a=(s=t.options)===null||s===void 0?void 0:s.redirectTo,i=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await z(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:Ie});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(M(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(t){var s,r,a;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await et(this.storage,this.storageKey)),await z(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=t?.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Mo})}catch(i){if(M(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:r}=t;if(r)throw r;if(!s)throw new Le;const{error:a}=await z(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}})}catch(t){if(M(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:r,type:a,options:i}=t,{error:o}=await z(this.fetch,"POST",s,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in t){const{phone:r,type:a,options:i}=t,{data:o,error:l}=await z(this.fetch,"POST",s,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:l}}throw new Lt("You must provide either an email or phone number and a type")}catch(s){if(M(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await s()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=s();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await Ve(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<gs:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const o=await Ve(this.userStorage,this.storageKey+"-user");o?.user?t.user=o.user:t.user=vs()}if(this.storage.isServer&&t.user){let o=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,d,u)=>(!o&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:t},error:null}}const{session:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Fe}):await this._useSession(async s=>{var r,a,i;const{data:o,error:l}=s;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Le}:await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=o.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:Fe})})}catch(s){if(M(s))return ho(s)&&(await this._removeSession(),await De(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async r=>{const{data:a,error:i}=r;if(i)throw i;if(!a.session)throw new Le;const o=a.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await et(this.storage,this.storageKey));const{data:d,error:u}=await z(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Fe});if(u)throw u;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(M(r))return{data:{user:null},error:r};throw r}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Le;const s=Date.now()/1e3;let r=s,a=!0,i=null;const{payload:o}=ps(t.access_token);if(o.exp&&(r=o.exp,a=r<=s),a){const{session:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;i={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:r-s,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(s){if(M(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var r;if(!t){const{data:o,error:l}=s;if(l)throw l;t=(r=o.session)!==null&&r!==void 0?r:void 0}if(!t?.refresh_token)throw new Le;const{session:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{user:null,session:null},error:i}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(M(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(t,s){try{if(!ye())throw new Ft("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Ft(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new Tr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ft("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Tr("No code detected.");const{data:j,error:f}=await this._exchangeCodeForSession(t.code);if(f)throw f;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:j.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:d}=t;if(!i||!l||!o||!d)throw new Ft("No session defined in URL");const u=Math.round(Date.now()/1e3),m=parseInt(l);let g=u+m;c&&(g=parseInt(c));const b=g-u;b*1e3<=nt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${b}s, should have been closer to ${m}s`);const x=g-m;u-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,g,u):u-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,g,u);const{data:h,error:v}=await this._getUser(i);if(v)throw v;const p={provider_token:r,provider_refresh_token:a,access_token:i,expires_in:m,expires_at:g,refresh_token:o,token_type:d,user:h.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:p,redirectType:t.type},error:null}}catch(r){if(M(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await Ve(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var r;const{data:a,error:i}=s;if(i)return{error:i};const o=(r=a.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,t);if(l&&!(uo(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return t!=="others"&&(await this._removeSession(),await De(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const s=bo(),r={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async s=>{var r,a;try{const{data:{session:i},error:o}=s;if(o)throw o;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,s={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await et(this.storage,this.storageKey,!0));try{return await z(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(i){if(M(i))return{data:null,error:i};throw i}}async getUserIdentities(){var t;try{const{data:s,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(s){if(M(s))return{data:null,error:s};throw s}}async linkIdentity(t){var s;try{const{data:r,error:a}=await this._useSession(async i=>{var o,l,c,d,u;const{data:m,error:g}=i;if(g)throw g;const b=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await z(this.fetch,"GET",b,{headers:this.headers,jwt:(u=(d=m.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(a)throw a;return ye()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:t.provider,url:r?.url},error:null}}catch(r){if(M(r))return{data:{provider:t.provider,url:null},error:r};throw r}}async unlinkIdentity(t){try{return await this._useSession(async s=>{var r,a;const{data:i,error:o}=s;if(o)throw o;return await z(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(a=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(s){if(M(s))return{data:null,error:s};throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const r=Date.now();return await ko(async a=>(a>0&&await So(200*Math.pow(2,a-1)),this._debug(s,"refreshing attempt",a),await z(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Ie})),(a,i)=>{const o=200*Math.pow(2,a);return i&&xs(i)&&Date.now()+o-r<nt})}catch(r){if(this._debug(s,"error",r),M(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",r),ye()&&!s.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t,s;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await Ve(this.storage,this.storageKey);if(a&&this.userStorage){let o=await Ve(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:a.user},await at(this.userStorage,this.storageKey+"-user",o)),a.user=(t=o?.user)!==null&&t!==void 0?t:vs()}else if(a&&!a.user&&!a.user){const o=await Ve(this.storage,this.storageKey+"-user");o&&o?.user?(a.user=o.user,await De(this.storage,this.storageKey+"-user"),await at(this.storage,this.storageKey,a)):a.user=vs()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const i=((s=a.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<gs;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${gs}s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:o}=await this._callRefreshToken(a.refresh_token);o&&(console.error(o),xs(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(a.access_token);!l&&o?.user?(a.user=o.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(t){var s,r;if(!t)throw new Le;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new ls;const{data:i,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!i.session)throw new Le;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(a,"error",i),M(i)){const o={session:null,error:i};return xs(i)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(t,s,r=!0){const a=`#_notifyAllSubscribers(${t})`;this._debug(a,"begin",s,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:s});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,s)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const s=Object.assign({},t),r=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&s.user&&await at(this.userStorage,this.storageKey+"-user",{user:s.user});const a=Object.assign({},s);delete a.user;const i=Ur(a);await at(this.storage,this.storageKey,i)}else{const a=Ur(s);await at(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await De(this.storage,this.storageKey),await De(this.storage,this.storageKey+"-code-verifier"),await De(this.storage,this.storageKey+"-user"),this.userStorage&&await De(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ye()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),nt);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:r}}=s;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-t)/nt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${nt}ms, refresh threshold is ${Ls} ticks`),a<=Ls&&await this._callRefreshToken(r.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Un)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ye()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,r){const a=[`provider=${encodeURIComponent(s)}`];if(r?.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await et(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});a.push(l.toString())}if(r?.queryParams){const i=new URLSearchParams(r.queryParams);a.push(i.toString())}return r?.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${a.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var r;const{data:a,error:i}=s;return i?{data:null,error:i}:await z(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(M(s))return{data:null,error:s};throw s}}async _enroll(t){try{return await this._useSession(async s=>{var r,a;const{data:i,error:o}=s;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:c,error:d}=await z(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(t.factorType==="totp"&&(!((a=c?.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(M(s))return{data:null,error:s};throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:a,error:i}=s;if(i)return{data:null,error:i};const{data:o,error:l}=await z(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(s){if(M(s))return{data:null,error:s};throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:a,error:i}=s;return i?{data:null,error:i}:await z(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(M(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(t){const{data:s,error:r}=await this._challenge({factorId:t.factorId});return r?{data:null,error:r}:await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const r=t?.factors||[],a=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:a,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var s,r;const{data:{session:a},error:i}=t;if(i)return{data:null,error:i};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=ps(a.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((r=(s=a.user.factors)===null||s===void 0?void 0:s.filter(m=>m.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const u=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(t,s={keys:[]}){let r=s.keys.find(l=>l.kid===t);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(l=>l.kid===t),r&&this.jwks_cached_at+lo>a)return r;const{data:i,error:o}=await z(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=a,r=i.keys.find(l=>l.kid===t),!r)?null:r}async getClaims(t,s={}){try{let r=t;if(!r){const{data:b,error:x}=await this.getSession();if(x||!b.session)return{data:null,error:x};r=b.session.access_token}const{header:a,payload:i,signature:o,raw:{header:l,payload:c}}=ps(r);s?.allowExpired||$o(i.exp);const d=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!d){const{error:b}=await this.getUser(r);if(b)throw b;return{data:{claims:i,header:a,signature:o},error:null}}const u=Ro(a.alg),m=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,m,o,jo(`${l}.${c}`)))throw new Bs("Invalid JWT signature");return{data:{claims:i,header:a,signature:o},error:null}}catch(r){if(M(r))return{data:null,error:r};throw r}}}Et.nextInstanceID=0;const Qo=Et;class el extends Qo{constructor(t){super(t)}}var tl=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(m){o(m)}}function c(u){try{d(r.throw(u))}catch(m){o(m)}}function d(u){u.done?i(u.value):a(u.value).then(l,c)}d((r=r.apply(n,t||[])).next())})};class sl{constructor(t,s,r){var a,i,o;this.supabaseUrl=t,this.supabaseKey=s;const l=ro(t);if(!s)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:Hi,realtime:Ki,auth:Object.assign(Object.assign({},Gi),{storageKey:c}),global:Wi},u=so(r??{},d);this.storageKey=(a=u.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(m,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=Qi(s,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new ci(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new qi(this.storageUrl.href,this.headers,this.fetch,r?.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new Ba(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,s={},r={}){return this.rest.rpc(t,s,r)}channel(t,s={config:{}}){return this.realtime.channel(t,s)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,s;return tl(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(s=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&s!==void 0?s:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:s,detectSessionInUrl:r,storage:a,userStorage:i,storageKey:o,flowType:l,lock:c,debug:d},u,m){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new el({url:this.authUrl.href,headers:Object.assign(Object.assign({},g),u),storageKey:o,autoRefreshToken:t,persistSession:s,detectSessionInUrl:r,storage:a,userStorage:i,flowType:l,lock:c,debug:d,fetch:m,hasCustomAuthorizationHeader:Object.keys(this.headers).some(b=>b.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new ki(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,r)=>{this._handleTokenChanged(s,"CLIENT",r?.access_token)})}_handleTokenChanged(t,s,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const rl=(n,t,s)=>new sl(n,t,s);function nl(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}nl()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Vt="https://mmouhbwyxoohimpulkmh.supabase.co",Js="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tb3VoYnd5eG9vaGltcHVsa21oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyNjI3MDAsImV4cCI6MjA3NDgzODcwMH0.V49WajOkxIdWeXKYHTVyuOUw5JAgtGtxkZIx-JU0Mk0",nr=Vt.startsWith("https://")&&Vt.includes(".supabase.co")&&Js.length>50&&Vt!=="your_supabase_project_url"&&Js!=="your_supabase_anon_key";nr?console.info("🚀 Режим работы: Supabase (полная интеграция)"):(console.info("🔧 Режим работы: localStorage (автономный)"),console.info("📝 Для включения Supabase настройте переменные VITE_SUPABASE_URL и VITE_SUPABASE_ANON_KEY"));const J=nr?rl(Vt,Js,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}):null,Rt=()=>J!==null&&nr,ys=n=>{try{for(const[t,s]of Object.entries(n))localStorage.setItem(t,JSON.stringify(s))}catch(t){console.error("Storage set error:",t)}},ws=()=>{try{localStorage.clear()}catch(n){console.error("Storage clear error:",n)}},Br="offline_actions",al="last_sync",bs=()=>navigator.onLine,Jr=n=>{try{const t=JSON.parse(localStorage.getItem(Br)||"[]");t.push(n),localStorage.setItem(Br,JSON.stringify(t))}catch(t){console.error("Error adding offline action:",t)}},Ns=()=>{localStorage.setItem(al,new Date().toISOString())};function il(n){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t.appendChild(s),s.styleSheet?s.styleSheet.cssText=n:s.appendChild(document.createTextNode(n))}Array(12).fill(0);let qs=1;class ol{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{const s=this.subscribers.indexOf(t);this.subscribers.splice(s,1)}),this.publish=t=>{this.subscribers.forEach(s=>s(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var s;const{message:r,...a}=t,i=typeof t?.id=="number"||((s=t.id)==null?void 0:s.length)>0?t.id:qs++,o=this.toasts.find(c=>c.id===i),l=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),o?this.toasts=this.toasts.map(c=>c.id===i?(this.publish({...c,...t,id:i,title:r}),{...c,...t,id:i,dismissible:l,title:r}):c):this.addToast({title:r,...a,dismissible:l,id:i}),i},this.dismiss=t=>(t?(this.dismissedToasts.add(t),requestAnimationFrame(()=>this.subscribers.forEach(s=>s({id:t,dismiss:!0})))):this.toasts.forEach(s=>{this.subscribers.forEach(r=>r({id:s.id,dismiss:!0}))}),t),this.message=(t,s)=>this.create({...s,message:t}),this.error=(t,s)=>this.create({...s,message:t,type:"error"}),this.success=(t,s)=>this.create({...s,type:"success",message:t}),this.info=(t,s)=>this.create({...s,type:"info",message:t}),this.warning=(t,s)=>this.create({...s,type:"warning",message:t}),this.loading=(t,s)=>this.create({...s,type:"loading",message:t}),this.promise=(t,s)=>{if(!s)return;let r;s.loading!==void 0&&(r=this.create({...s,promise:t,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));const a=Promise.resolve(t instanceof Function?t():t);let i=r!==void 0,o;const l=a.then(async d=>{if(o=["resolve",d],re.isValidElement(d))i=!1,this.create({id:r,type:"default",message:d});else if(cl(d)&&!d.ok){i=!1;const m=typeof s.error=="function"?await s.error(`HTTP error! status: ${d.status}`):s.error,g=typeof s.description=="function"?await s.description(`HTTP error! status: ${d.status}`):s.description,x=typeof m=="object"&&!re.isValidElement(m)?m:{message:m};this.create({id:r,type:"error",description:g,...x})}else if(d instanceof Error){i=!1;const m=typeof s.error=="function"?await s.error(d):s.error,g=typeof s.description=="function"?await s.description(d):s.description,x=typeof m=="object"&&!re.isValidElement(m)?m:{message:m};this.create({id:r,type:"error",description:g,...x})}else if(s.success!==void 0){i=!1;const m=typeof s.success=="function"?await s.success(d):s.success,g=typeof s.description=="function"?await s.description(d):s.description,x=typeof m=="object"&&!re.isValidElement(m)?m:{message:m};this.create({id:r,type:"success",description:g,...x})}}).catch(async d=>{if(o=["reject",d],s.error!==void 0){i=!1;const u=typeof s.error=="function"?await s.error(d):s.error,m=typeof s.description=="function"?await s.description(d):s.description,b=typeof u=="object"&&!re.isValidElement(u)?u:{message:u};this.create({id:r,type:"error",description:m,...b})}}).finally(()=>{i&&(this.dismiss(r),r=void 0),s.finally==null||s.finally.call(s)}),c=()=>new Promise((d,u)=>l.then(()=>o[0]==="reject"?u(o[1]):d(o[1])).catch(u));return typeof r!="string"&&typeof r!="number"?{unwrap:c}:Object.assign(r,{unwrap:c})},this.custom=(t,s)=>{const r=s?.id||qs++;return this.create({jsx:t(r),id:r,...s}),r},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const we=new ol,ll=(n,t)=>{const s=t?.id||qs++;return we.addToast({title:n,...t,id:s}),s},cl=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",dl=ll,ul=()=>we.toasts,hl=()=>we.getActiveToasts(),ce=Object.assign(dl,{success:we.success,info:we.info,warning:we.warning,error:we.error,custom:we.custom,message:we.message,promise:we.promise,dismiss:we.dismiss,loading:we.loading},{getHistory:ul,getToasts:hl});il("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");const Ln=y.createContext(void 0),je=()=>{const n=y.useContext(Ln);if(!n)throw new Error("useAuth must be used within AuthProvider");return n},ml=({children:n})=>{const[t,s]=y.useState(null),[r,a]=y.useState(!0),[i,o]=y.useState(0);y.useEffect(()=>{(async()=>{try{const{data:{session:p}}=await J.auth.getSession();p?.user?await l(p.user.id):ws()}catch(p){console.error("Error initializing auth:",p)}finally{a(!1)}})();const{data:{subscription:v}}=J.auth.onAuthStateChange(async(p,j)=>{p==="SIGNED_IN"&&j?.user?await l(j.user.id):p==="SIGNED_OUT"&&(s(null),ws())});return()=>{v.unsubscribe()}},[]),y.useEffect(()=>{const h=async()=>{try{const{count:p}=await J.from("users_profiles").select("*",{count:"exact",head:!0});o(p||0)}catch(p){console.error("Error counting users:",p)}};h();const v=setInterval(h,3e4);return()=>clearInterval(v)},[t]);const l=async h=>{try{const{data:v,error:p}=await J.from("users_profiles").select("*").eq("id",h).single();if(p)throw p;if(v){const j={id:v.id,username:v.username,role:v.role,course:v.course,registrationDate:v.registration_date,lastLogin:v.last_login||void 0,supabase_id:h,profile:{firstName:v.first_name||void 0,lastName:v.last_name||void 0,phone:v.phone||void 0,avatar_url:v.avatar_url||void 0}};s(j),ys({currentUser:j}),await J.from("users_profiles").update({last_login:new Date().toISOString()}).eq("id",h)}}catch(v){console.error("Error loading user profile:",v),ce.error("Ошибка загрузки профиля пользователя")}},x={user:t,loading:r,login:async(h,v)=>{try{if(!v||v.trim()==="")throw new Error("Пароль не может быть пустым");const p=h.includes("@");let j=h;if(!p){const{data:_,error:N}=await J.from("users_profiles").select("id").eq("username",h).single();if(N||!_)throw new Error("Пользователь не найден. Пожалуйста, зарегистрируйтесь.");const{data:{user:C},error:P}=await J.auth.admin.getUserById(_.id);if(P||!C?.email)throw new Error("Не удалось найти email пользователя");j=C.email}const{data:f,error:w}=await J.auth.signInWithPassword({email:j,password:v});if(w)throw w.message.includes("Invalid login credentials")?new Error("Неверное имя пользователя или пароль"):w;f.user&&(await l(f.user.id),ce.success("Вход выполнен успешно!"))}catch(p){throw console.error("Login error:",p),ce.error(p.message||"Ошибка входа"),p}},register:async h=>{try{if(!h.password||h.password.length<6)throw new Error("Пароль должен содержать минимум 6 символов");const{data:v,error:p}=await J.from("users_profiles").select("username").eq("username",h.username).single();if(v)throw new Error("Пользователь с таким именем уже существует");const{data:j,error:f}=await J.auth.signUp({email:h.email,password:h.password,options:{data:{username:h.username,role:h.role}}});if(f)throw f.message.includes("already registered")?new Error("Пользователь с таким email уже зарегистрирован"):f;if(!j.user)throw new Error("Не удалось создать пользователя");const{error:w}=await J.from("users_profiles").insert({id:j.user.id,username:h.username,role:h.role,course:h.course,first_name:h.firstName,last_name:h.lastName,phone:h.phone,registration_date:new Date().toISOString()});if(w)throw await J.auth.admin.deleteUser(j.user.id),w;await l(j.user.id),ce.success("Регистрация выполнена успешно!")}catch(v){throw console.error("Registration error:",v),ce.error(v.message||"Ошибка регистрации"),v}},logout:async()=>{try{await J.auth.signOut(),s(null),ws(),ce.success("Выход выполнен успешно")}catch(h){console.error("Logout error:",h),ce.error("Ошибка при выходе")}},updateProfile:async h=>{if(t)try{if(bs()){const{error:p}=await J.from("users_profiles").update({first_name:h.firstName,last_name:h.lastName,phone:h.phone,avatar_url:h.avatar_url,updated_at:new Date().toISOString()}).eq("id",t.id);if(p)throw p;Ns()}else Jr({type:"update",table:"users_profiles",data:{id:t.id,...h}});const v={...t,profile:{...t.profile,...h}};s(v),ys({currentUser:v}),ce.success("Профиль обновлен")}catch(v){console.error("Profile update error:",v),ce.error("Ошибка обновления профиля")}},updateCourse:async h=>{if(t)try{if(bs()){const{error:p}=await J.from("users_profiles").update({course:h,updated_at:new Date().toISOString()}).eq("id",t.id);if(p)throw p;Ns()}else Jr({type:"update",table:"users_profiles",data:{id:t.id,course:h}});const v={...t,course:h};s(v),ys({currentUser:v}),ce.success("Курс обновлен")}catch(v){console.error("Course update error:",v),ce.error("Ошибка обновления курса")}},syncWithSupabase:async()=>{if(!(!bs()||!t))try{await l(t.id),Ns(),ce.success("Данные синхронизированы")}catch(h){console.error("Sync error:",h),ce.error("Ошибка синхронизации")}},activeUsersCount:i};return e.jsx(Ln.Provider,{value:x,children:n})},fl=(n,t)=>(console.error("Supabase error:",n),{success:!1,error:n?.message||t}),Fn=async n=>{if(!Rt())return{success:!1,error:"Supabase not connected"};try{const{data:t,error:s}=await J.from("users_profiles").select("*").eq("id",n).single();if(s)throw s;return{success:!0,data:t}}catch(t){return fl(t,"Failed to get user profile")}},gl=async()=>{if(!Rt())return{success:!1,error:"Supabase not connected"};try{const{error:n}=await J.auth.signOut();if(n)throw n;return{success:!0}}catch(n){return{success:!1,error:n.message||"Sign out failed"}}},Mn=async()=>{if(!Rt())return{success:!1,error:"Supabase not connected"};try{const{data:{session:n},error:t}=await J.auth.getSession();if(t)throw t;if(n?.user){const s=await Fn(n.user.id);return{success:!0,data:{session:n,user:n.user,profile:s.success?s.data:null}}}return{success:!0,data:null}}catch(n){return{success:!1,error:n.message||"Failed to get session"}}},Bn=n=>Rt()?J.auth.onAuthStateChange(async(t,s)=>{if(s?.user&&t==="SIGNED_IN"){const r=await Fn(s.user.id);n(t,{...s,profile:r.success?r.data:null})}else n(t,s)}):(console.warn("Supabase not connected - auth state changes disabled"),{data:{subscription:{unsubscribe:()=>{}}}}),xl=Object.freeze(Object.defineProperty({__proto__:null,getCurrentSession:Mn,onAuthStateChange:Bn,signOut:gl},Symbol.toStringTag,{value:"Module"})),pl=y.createContext({isConnected:!1,user:null,profile:null,loading:!0,signOut:async()=>{}}),vl=({children:n})=>{const[t,s]=y.useState(null),[r,a]=y.useState(null),[i,o]=y.useState(!0),l=Rt();y.useEffect(()=>{let u=!0;(async()=>{try{if(!l){console.log("Supabase not connected - running in localStorage mode"),o(!1);return}const b=await Mn();u&&(b.success&&b.data&&(s(b.data.user),a(b.data.profile)),o(!1))}catch(b){console.error("Error initializing auth:",b),u&&o(!1)}})();let g=null;return l&&(g=Bn((x,h)=>{u&&(console.log("Auth state changed:",x,h?.user?.email),h?.user?(s(h.user),a(h.profile||null)):(s(null),a(null)),x==="SIGNED_IN"?ce.success("Успешный вход в систему"):x==="SIGNED_OUT"?ce.info("Вы вышли из системы"):x==="TOKEN_REFRESHED"&&console.log("Token refreshed"))}).data.subscription),()=>{u=!1,g?.unsubscribe()}},[l]);const d={isConnected:l,user:t,profile:r,loading:i,signOut:async()=>{if(!l){console.log("Supabase not connected - cannot sign out");return}try{const{signOut:u}=await ht(async()=>{const{signOut:g}=await Promise.resolve().then(()=>xl);return{signOut:g}},void 0),m=await u();m.success?(s(null),a(null),ce.success("Вы успешно вышли из системы")):ce.error(`Ошибка выхода: ${m.error}`)}catch(u){console.error("Error signing out:",u),ce.error("Ошибка при выходе из системы")}}};return e.jsx(pl.Provider,{value:d,children:n})};function q(...n){const t=[];for(const s of n)if(s){if(typeof s=="string")t.push(s);else if(typeof s=="object")if(Array.isArray(s)){const r=q(...s);r&&t.push(r)}else for(const r in s)s[r]&&t.push(r)}return t.join(" ")}const jl=(n="default",t="default")=>{const s="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md font-medium transition-all disabled:pointer-events-none disabled:opacity-50 outline-none",r={default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},a={default:"h-9 px-4 py-2",sm:"h-8 px-3 text-sm",lg:"h-10 px-6",icon:"h-9 w-9"};return`${s} ${r[n]} ${a[t]}`},k=y.forwardRef(({className:n,variant:t="default",size:s="default",...r},a)=>e.jsx("button",{ref:a,className:q(jl(t,s),n),...r}));k.displayName="Button";const U=y.forwardRef(({className:n,type:t,...s},r)=>e.jsx("input",{ref:r,type:t,"data-slot":"input",className:q("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",n),...s}));U.displayName="Input";function A({className:n,...t}){return e.jsx("label",{className:q("flex items-center gap-2 text-sm leading-none font-medium select-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50",n),...t})}function I({className:n,...t}){return e.jsx("div",{"data-slot":"card",className:q("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",n),...t})}function O({className:n,...t}){return e.jsx("div",{"data-slot":"card-header",className:q("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",n),...t})}function $({className:n,...t}){return e.jsx("h4",{"data-slot":"card-title",className:q("leading-none",n),...t})}function de({className:n,...t}){return e.jsx("p",{"data-slot":"card-description",className:q("text-muted-foreground",n),...t})}function T({className:n,...t}){return e.jsx("div",{"data-slot":"card-content",className:q("px-6 [&:last-child]:pb-6",n),...t})}function xe({className:n,variant:t="default",...s}){const r={default:"bg-card text-card-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"};return e.jsx("div",{role:"alert",className:q("relative w-full rounded-lg border px-4 py-3 text-sm",r[t],n),...s})}function pe({className:n,...t}){return e.jsx("div",{className:q("text-sm [&_p]:leading-relaxed",n),...t})}function qr({className:n,...t}){return e.jsx("h5",{className:q("mb-1 font-medium leading-none tracking-tight",n),...t})}let yl=0;const Mt=(n,t,s)=>{const r=`toast-${++yl}`;let a=document.getElementById("toast-container");a||(a=document.createElement("div"),a.id="toast-container",a.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    `,document.body.appendChild(a));const i=document.createElement("div");i.id=r,i.style.cssText=`
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 16px;
    max-width: 320px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--foreground);
    font-size: 14px;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
    pointer-events: auto;
  `;const o={success:"✅",error:"❌",info:"ℹ️",warning:"⚠️"},l={success:"#10b981",error:"#ef4444",info:"#3b82f6",warning:"#f59e0b"};i.innerHTML=`
    <span style="font-size: 16px;">${o[t]}</span>
    <div style="flex: 1;">
      <div style="font-weight: 600;">${n}</div>
      ${s?`<div style="font-size: 12px; opacity: 0.8; margin-top: 2px;">${s}</div>`:""}
    </div>
    <button onclick="this.parentElement.remove()" style="
      background: none; 
      border: none; 
      color: var(--muted-foreground); 
      cursor: pointer;
      padding: 0;
      font-size: 16px;
      line-height: 1;
    ">×</button>
  `,i.style.borderLeft=`4px solid ${l[t]}`,a.appendChild(i),requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateX(0)"}),setTimeout(()=>{document.getElementById(r)&&(i.style.opacity="0",i.style.transform="translateX(100%)",setTimeout(()=>{i.parentElement&&i.parentElement.removeChild(i)},300))},4e3),console.log(`${o[t]} ${n}`)},R={success:(n,t)=>Mt(n,"success",t),error:(n,t)=>Mt(n,"error",t),info:(n,t)=>Mt(n,"info",t),warning:(n,t)=>Mt(n,"warning",t)};function wl({onBack:n}){const[t,s]=y.useState(""),[r,a]=y.useState(""),[i,o]=y.useState(""),[l,c]=y.useState(!1),[d,u]=y.useState({username:!1,password:!1}),{login:m}=je(),g=async x=>{if(x.preventDefault(),c(!0),o(""),u({username:!1,password:!1}),!t.trim()){o("Введите имя пользователя"),u({username:!0,password:!1}),c(!1),R.error("Введите имя пользователя");return}if(!r.trim()){o("Введите пароль"),u({username:!1,password:!0}),c(!1),R.error("Введите пароль");return}console.log("Попытка входа:",{username:t,password:r?"***":"пустой"});try{await m(t,r)?(console.log("Успешный вход для:",t),R.success(`Добро пожаловать, ${t}!`)):(o("Неверное имя пользователя или пароль"),u({username:!0,password:!0}),console.log("Вход не удался для:",t),R.error("Неверное имя пользователя или пароль"))}catch{o("Произошла ошибка при входе в систему"),R.error("Системная ошибка. Попробуйте еще раз")}c(!1)},b=()=>{o(""),s(""),a(""),u({username:!1,password:!1}),console.log("Поля ввода очищены")};return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs(I,{className:"w-full max-w-md",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:n,children:e.jsx(Ge,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx($,{children:"Вход в систему"}),e.jsx(de,{children:"Введите ваши данные для входа"})]})]})}),e.jsxs(T,{children:[e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"username",children:"Имя пользователя"}),e.jsx(U,{id:"username",type:"text",value:t,onChange:x=>{s(x.target.value),d.username&&(u(h=>({...h,username:!1})),o(""))},className:d.username?"form-input-error":"",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"password",children:"Пароль"}),e.jsx(U,{id:"password",type:"password",value:r,onChange:x=>{a(x.target.value),d.password&&(u(h=>({...h,password:!1})),o(""))},className:d.password?"form-input-error":"",required:!0})]}),i&&e.jsxs(xe,{variant:"destructive",className:"space-y-2 alert-animation",children:[e.jsx(ct,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-sm",children:i})]}),e.jsx(k,{type:"submit",className:"w-full",disabled:l,children:l?"Вход...":"Войти"})]}),e.jsx("div",{className:"mt-4 flex justify-between items-center",children:e.jsxs(k,{variant:"outline",size:"sm",onClick:b,className:"text-xs",children:[e.jsx(Ws,{className:"h-3 w-3 mr-1"}),"Удалить поля ввода"]})})]})]})})}const Pt=y.createContext(void 0);function Z({value:n="",onValueChange:t,children:s}){const[r,a]=y.useState(!1);return e.jsx(Pt.Provider,{value:{value:n,onValueChange:t||(()=>{}),open:r,setOpen:a},children:e.jsx("div",{className:"relative",children:s})})}function Q({className:n,children:t,...s}){const r=y.useContext(Pt);if(!r)throw new Error("SelectTrigger must be used within Select");return e.jsxs("button",{type:"button",onClick:()=>r.setOpen(!r.open),className:q("flex h-9 w-full items-center justify-between rounded-md border border-input bg-input-background px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50",n),...s,children:[t,e.jsx(Qr,{className:"h-4 w-4 opacity-50"})]})}function ee({placeholder:n}){const t=y.useContext(Pt);if(!t)throw new Error("SelectValue must be used within Select");return e.jsx("span",{children:t.value||n})}function te({className:n,children:t,...s}){const r=y.useContext(Pt);if(!r)throw new Error("SelectContent must be used within Select");return r.open?e.jsx("div",{className:q("absolute top-full z-50 mt-1 w-full rounded-md border bg-popover text-popover-foreground shadow-md",n),...s,children:e.jsx("div",{className:"p-1",children:t})}):null}function E({value:n,className:t,children:s,...r}){const a=y.useContext(Pt);if(!a)throw new Error("SelectItem must be used within Select");const i=()=>{a.onValueChange(n),a.setOpen(!1)};return e.jsx("div",{onClick:i,className:q("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",a.value===n&&"bg-accent text-accent-foreground",t),...r,children:s})}function bl({onBack:n}){const[t,s]=y.useState(""),[r,a]=y.useState(""),[i,o]=y.useState("student"),[l,c]=y.useState(""),[d,u]=y.useState(""),[m,g]=y.useState(""),[b,x]=y.useState(""),[h,v]=y.useState(""),[p,j]=y.useState(!1),[f,w]=y.useState({username:!1,password:!1,course:!1,group:!1,faculty:!1}),{register:_}=je(),N=async C=>{if(C.preventDefault(),j(!0),x(""),v(""),w({username:!1,password:!1,course:!1,group:!1,faculty:!1}),!t.trim()){x("Введите имя пользователя"),w(D=>({...D,username:!0})),j(!1),R.error("Введите имя пользователя");return}if(!r.trim()){x("Введите пароль"),w(D=>({...D,password:!0})),j(!1),R.error("Введите пароль");return}if(r.length<3){x("Пароль должен содержать минимум 3 символа"),w(D=>({...D,password:!0})),j(!1),R.error("Пароль должен содержать минимум 3 символа");return}if(i==="student"){if(!l){x("Выберите курс"),w(D=>({...D,course:!0})),j(!1),R.error("Пожалуйста, выберите свой курс обучения");return}if(!d.trim()){x("Введите номер группы"),w(D=>({...D,group:!0})),j(!1),R.error('Поле "Группа" не может быть пустым');return}if(!m){x("Выберите факультет"),w(D=>({...D,faculty:!0})),j(!1),R.error("Пожалуйста, выберите свой факультет");return}}const P=i==="student"?{course:l,group:d,faculty:m}:{};try{await _(t,r,i,P)?(v("Регистрация успешна! Теперь вы можете войти в систему."),s(""),a(""),c(""),u(""),g(""),w({username:!1,password:!1,course:!1,group:!1,faculty:!1}),R.success("Регистрация успешна! Теперь вы можете войти в систему.")):(x("Пользователь с таким именем уже существует"),R.error("Пользователь с таким именем уже существует"))}catch{x("Произошла ошибка при регистрации"),R.error("Системная ошибка. Попробуйте еще раз")}j(!1)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs(I,{className:"w-full max-w-md",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:n,children:e.jsx(Ge,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx($,{children:"Регистрация"}),e.jsx(de,{children:"Создайте новый аккаунт"})]})]})}),e.jsx(T,{children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"username",children:"Имя пользователя"}),e.jsx(U,{id:"username",type:"text",value:t,onChange:C=>{s(C.target.value),f.username&&(w(P=>({...P,username:!1})),x(""))},className:f.username?"form-input-error":"",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"password",children:"Пароль"}),e.jsx(U,{id:"password",type:"password",value:r,onChange:C=>{a(C.target.value),f.password&&(w(P=>({...P,password:!1})),x(""))},className:f.password?"form-input-error":"",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"role",children:"Роль"}),e.jsxs(Z,{value:i,onValueChange:C=>o(C),children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"student",children:"Студент"}),e.jsx(E,{value:"teacher",children:"Преподаватель"})]})]})]}),i==="student"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"course",children:"Курс"}),e.jsxs(Z,{value:l,onValueChange:C=>{c(C),f.course&&(w(P=>({...P,course:!1})),x(""))},children:[e.jsx(Q,{className:f.course?"form-input-error":"",children:e.jsx(ee,{placeholder:"Выберите курс"})}),e.jsxs(te,{children:[e.jsx(E,{value:"1",children:"1 курс"}),e.jsx(E,{value:"2",children:"2 курс"}),e.jsx(E,{value:"3",children:"3 курс"}),e.jsx(E,{value:"4",children:"4 курс"}),e.jsx(E,{value:"5",children:"5 курс"}),e.jsx(E,{value:"6",children:"6 курс"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"group",children:"Группа"}),e.jsx(U,{id:"group",type:"text",placeholder:"Номер группы",value:d,onChange:C=>{u(C.target.value),f.group&&(w(P=>({...P,group:!1})),x(""))},className:f.group?"form-input-error":"",required:i==="student"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"faculty",children:"Факультет"}),e.jsxs(Z,{value:m,onValueChange:C=>{g(C),f.faculty&&(w(P=>({...P,faculty:!1})),x(""))},children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Выберите факультет"})}),e.jsxs(te,{children:[e.jsx(E,{value:"pediatrics",children:"Педиатрия"}),e.jsx(E,{value:"therapy",children:"Лечебное дело"}),e.jsx(E,{value:"dentistry",children:"Стоматология"}),e.jsx(E,{value:"pharmacy",children:"Фармация"}),e.jsx(E,{value:"nursing",children:"Сестринское дело"})]})]})]})]}),b&&e.jsxs(xe,{variant:"destructive",className:"space-y-2",children:[e.jsx(ct,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-sm",children:b})]}),h&&e.jsxs(xe,{className:"space-y-2 border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950",children:[e.jsx(ot,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsx(pe,{className:"text-sm text-green-800 dark:text-green-200",children:h})]}),e.jsx(k,{type:"submit",className:"w-full",disabled:p,children:p?"Регистрация...":"Зарегистрироваться"})]})})]})})}const ar=y.createContext(void 0);function Nl({open:n=!1,onOpenChange:t,children:s}){const[r,a]=y.useState(!1),i=n!==void 0?n:r,o=y.useCallback(l=>{n===void 0&&a(l),t?.(l)},[n,t]);return y.useEffect(()=>{const l=c=>{c.key==="Escape"&&i&&o(!1)};return i&&(document.addEventListener("keydown",l),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",l),document.body.style.overflow="unset"}},[i,o]),e.jsx(ar.Provider,{value:{open:i,onOpenChange:o},children:s})}const Jn=y.forwardRef(({onClick:n,asChild:t=!1,children:s,...r},a)=>{const i=y.useContext(ar),o=d=>{i?.onOpenChange(!0),n?.(d)};if(t&&y.isValidElement(s))return y.cloneElement(s,{onClick:o,ref:a,...r});const{asChild:l,...c}=r;return e.jsx("button",{ref:a,onClick:o,...c,children:s})});Jn.displayName="SheetTrigger";const qn=y.forwardRef(({side:n="right",className:t,children:s,...r},a)=>{const i=y.useContext(ar);if(!i?.open)return null;const o={top:"top-0 left-0 right-0 h-auto max-h-[80vh] animate-in slide-in-from-top",right:"top-0 right-0 h-full w-3/4 sm:max-w-sm animate-in slide-in-from-right",bottom:"bottom-0 left-0 right-0 h-auto max-h-[80vh] animate-in slide-in-from-bottom",left:"top-0 left-0 h-full w-3/4 sm:max-w-sm animate-in slide-in-from-left"},l=u=>{u.target===u.currentTarget&&i.onOpenChange(!1)},{side:c,...d}=r;return e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm animate-in fade-in",onClick:l}),e.jsxs("div",{ref:a,className:q("fixed z-50 gap-4 bg-background p-6 shadow-lg border",o[n],t),...d,children:[s,e.jsxs("button",{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",onClick:()=>i.onOpenChange(!1),children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})});qn.displayName="SheetContent";const zn=y.forwardRef(({className:n,...t},s)=>e.jsx("div",{ref:s,className:q("flex flex-col space-y-2 text-center sm:text-left",n),...t}));zn.displayName="SheetHeader";const Vn=y.forwardRef(({className:n,...t},s)=>e.jsx("h2",{ref:s,className:q("text-lg font-semibold text-foreground",n),...t}));Vn.displayName="SheetTitle";const Wn=y.forwardRef(({className:n,...t},s)=>e.jsx("p",{ref:s,className:q("text-sm text-muted-foreground",n),...t}));Wn.displayName="SheetDescription";function _l(){const[n,t]=y.useState("light");y.useEffect(()=>{const a=localStorage.getItem("theme"),i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",o=a||i;t(o),s(o)},[]);const s=a=>{const i=document.documentElement;a==="dark"?i.classList.add("dark"):i.classList.remove("dark")};return{theme:n,toggleTheme:()=>{const a=n==="light"?"dark":"light";t(a),s(a),localStorage.setItem("theme",a)}}}function Hn(){const{theme:n,toggleTheme:t}=_l();return e.jsxs("button",{onClick:t,className:"relative h-9 w-9 p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":n==="dark"?"Переключить на светлую тему":"Переключить на темную тему",children:[e.jsx("svg",{className:"h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0 text-gray-600 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),e.jsx("svg",{className:"absolute top-2 left-2 h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100 text-gray-600 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})]})}const Sl={default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white hover:bg-destructive/90",outline:"text-foreground hover:bg-accent hover:text-accent-foreground"};function L({className:n,variant:t="default",...s}){return e.jsx("span",{className:q("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 gap-1 transition-colors",Sl[t],n),...s})}const ir=y.createContext({open:!1,setOpen:()=>{},triggerRef:y.createRef(),contentRef:y.createRef()});function kl({children:n,open:t,onOpenChange:s}){const[r,a]=y.useState(!1),i=y.useRef(null),o=y.useRef(null),l=t!==void 0?t:r,c=y.useCallback(d=>{s?s(d):a(d)},[s]);return y.useEffect(()=>{const d=u=>{u.key==="Escape"&&l&&c(!1)};if(l)return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[l,c]),y.useEffect(()=>{const d=u=>{l&&o.current&&i.current&&!o.current.contains(u.target)&&!i.current.contains(u.target)&&c(!1)};if(l)return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[l,c]),e.jsx(ir.Provider,{value:{open:l,setOpen:c,triggerRef:i,contentRef:o},children:n})}function Cl({children:n,asChild:t,...s}){const{setOpen:r,triggerRef:a}=y.useContext(ir),i=()=>{r(!0),s.onClick&&s.onClick()};return t&&y.isValidElement(n)?y.cloneElement(n,{ref:a,onClick:i,...s}):e.jsx("button",{ref:a,onClick:i,...s,children:n})}function El({children:n,className:t,align:s="center",side:r="bottom",sideOffset:a=4}){const{open:i,triggerRef:o,contentRef:l}=y.useContext(ir),[c,d]=y.useState({top:0,left:0});return y.useEffect(()=>{if(i&&o.current){const u=o.current.getBoundingClientRect(),m=window.pageXOffset,g=window.pageYOffset;let b=0,x=0;switch(r){case"bottom":b=u.bottom+g+a;break;case"top":b=u.top+g-a;break;case"right":x=u.right+m+a,b=u.top+g;break;case"left":x=u.left+m-a,b=u.top+g;break}if(r==="top"||r==="bottom")switch(s){case"start":x=u.left+m;break;case"center":x=u.left+m+u.width/2;break;case"end":x=u.right+m;break}d({top:b,left:x})}},[i,s,r,a]),i?e.jsx("div",{ref:l,className:q("fixed z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none","animate-in fade-in-0 zoom-in-95",r==="bottom"&&"slide-in-from-top-2",r==="top"&&"slide-in-from-bottom-2",r==="left"&&"slide-in-from-right-2",r==="right"&&"slide-in-from-left-2",t),style:{top:c.top,left:s==="center"?c.left-144:c.left,transform:r==="top"?"translateY(-100%)":void 0},children:n}):null}function Al(){const{user:n}=je(),[t,s]=y.useState([]),[r,a]=y.useState({dismissed:[],lastChecked:new Date().toISOString()}),[i,o]=y.useState(!1);y.useEffect(()=>{if(!n)return;l(),c();const f=setTimeout(()=>{u()},500);return()=>clearTimeout(f)},[n]);const l=()=>{const f=localStorage.getItem("adminNotifications");if(f)try{const w=JSON.parse(f),_=m(w);s(_)}catch(w){console.error("Error loading notifications:",w)}},c=()=>{if(!n)return;const f=localStorage.getItem(`userNotificationState_${n.username}`);if(f)try{const w=JSON.parse(f);a(w)}catch(w){console.error("Error loading user notification state:",w)}},d=f=>{n&&(localStorage.setItem(`userNotificationState_${n.username}`,JSON.stringify(f)),a(f))},u=()=>{const f={...r,lastChecked:new Date().toISOString()};d(f)},m=f=>{if(!n)return[];const w=new Date;return f.filter(_=>!_.isActive||_.expiryDate&&new Date(_.expiryDate)<w?!1:!!(_.targetUsers==="all"||_.targetUsers==="students"&&n.role==="student"||_.targetUsers==="teachers"&&n.role==="teacher"||_.targetUsers==="specific"&&_.specificUsers?.includes(n.username))).sort((_,N)=>new Date(N.createdAt).getTime()-new Date(_.createdAt).getTime())},g=f=>{const w={...r,dismissed:[...r.dismissed,f]};d(w)},b=()=>{const f=t.filter(w=>!r.dismissed.includes(w.id));return i?f:f.slice(0,3)},x=f=>{switch(f){case"info":return e.jsx(St,{className:"h-4 w-4"});case"warning":return e.jsx(Hs,{className:"h-4 w-4"});case"success":return e.jsx(ot,{className:"h-4 w-4"});case"error":return e.jsx(ct,{className:"h-4 w-4"});default:return e.jsx(St,{className:"h-4 w-4"})}},h=f=>{switch(f){case"error":return"destructive";default:return"default"}},v=f=>{switch(f){case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"success":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},p=b(),j=t.filter(f=>!r.dismissed.includes(f.id)).length>3;return p.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),e.jsx("h3",{className:"font-semibold",children:"Уведомления"})]}),e.jsx("div",{className:"flex items-center gap-2",children:j&&e.jsx(k,{size:"sm",variant:"outline",onClick:()=>o(!i),children:i?"Скрыть":`Показать все (${t.filter(f=>!r.dismissed.includes(f.id)).length})`})})]}),e.jsx("div",{className:"space-y-3",children:p.map(f=>e.jsx(xe,{variant:h(f.type),className:"relative",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[x(f.type),e.jsx(L,{className:v(f.type),children:f.type})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h4",{className:"font-semibold text-sm",children:f.title})}),e.jsx(pe,{className:"text-sm",children:f.message}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(dt,{className:"h-3 w-3"}),new Date(f.createdAt).toLocaleString(),f.expiryDate&&e.jsxs("span",{children:["• Действует до ",new Date(f.expiryDate).toLocaleDateString()]})]})]})]}),e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>g(f.id),className:"h-6 w-6 p-0 ml-2",children:e.jsx(Ke,{className:"h-3 w-3"})})]})},f.id))})]})}function Il(){const{user:n}=je(),[t,s]=y.useState(0),[r,a]=y.useState(!1);y.useEffect(()=>{if(!n){s(0);return}i();const c=setInterval(i,3e4);return()=>clearInterval(c)},[n]);const i=()=>{if(n)try{const c=localStorage.getItem("adminNotifications");if(!c){s(0);return}const d=JSON.parse(c),u=JSON.parse(localStorage.getItem(`userNotificationState_${n.username}`)||'{"dismissed": [], "lastChecked": "2020-01-01T00:00:00.000Z"}'),g=o(d).filter(b=>!u.dismissed.includes(b.id)&&new Date(b.createdAt)>new Date(u.lastChecked));s(g.length)}catch(c){console.error("Error updating unread count:",c),s(0)}},o=c=>{if(!n)return[];const d=new Date;return c.filter(u=>!u.isActive||u.expiryDate&&new Date(u.expiryDate)<d?!1:!!(u.targetUsers==="all"||u.targetUsers==="students"&&n.role==="student"||u.targetUsers==="teachers"&&n.role==="teacher"||u.targetUsers==="specific"&&u.specificUsers?.includes(n.username)))},l=c=>{a(c),c?s(0):setTimeout(i,100)};return n?e.jsxs(kl,{open:r,onOpenChange:l,children:[e.jsx(Cl,{asChild:!0,children:e.jsxs(k,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(Ye,{className:"h-5 w-5"}),t>0&&e.jsx(L,{className:"absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center text-xs bg-red-500 text-white border-0",children:t>99?"99+":t})]})}),e.jsx(El,{className:"w-96 max-h-96 overflow-y-auto p-0",children:e.jsx("div",{className:"p-4",children:e.jsx(Al,{})})})]}):null}function Tl({currentSection:n,onSectionChange:t,user:s,onLogout:r}){const[a,i]=y.useState(!1),o=[{id:"main",label:"Главная",icon:en},{id:"campuses",label:"Корпуса",icon:Ss},{id:"faq",label:"Часто задаваемые вопросы",icon:Gs},{id:"benefits",label:"Льготы",icon:Ks}],l=s&&s.role==="student"?[{id:"course",label:`${s.course||"1"} курс`,icon:ge}]:[],c=[],d=s&&s.role!=="admin"?[{id:"journal",label:s.role==="teacher"?"Журнал оценок":"Мои оценки",icon:Me}]:[],u=s?[]:[{id:"course",label:"Материалы курса",icon:ge,locked:!0},{id:"journal",label:"Журнал оценок",icon:Me,locked:!0},{id:"profile",label:"Профиль",icon:Be,locked:!0}],m=g=>{t(g),i(!1)};return e.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex justify-between items-center max-w-7xl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Nl,{open:a,onOpenChange:i,children:[e.jsx(Jn,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",children:e.jsx(ba,{className:"h-5 w-5"})})}),e.jsxs(qn,{side:"left",className:"w-80",children:[e.jsxs(zn,{children:[e.jsx(Vn,{children:"Меню"}),e.jsx(Wn,{children:"Навигация по разделам портала"})]}),e.jsxs("div",{className:"mt-6 space-y-2",children:[o.map(g=>e.jsxs(k,{variant:n===g.id?"default":"ghost",className:"w-full justify-start",onClick:()=>m(g.id),children:[e.jsx(g.icon,{className:"mr-2 h-4 w-4"}),g.label]},g.id)),s&&s.role==="student"&&(l.length>0||c.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 px-3 py-2",children:"Обучение"}),l.map(g=>e.jsxs(k,{variant:n===g.id?"default":"ghost",className:"w-full justify-start",onClick:()=>m(g.id),children:[e.jsx(g.icon,{className:"mr-2 h-4 w-4"}),g.label]},g.id)),c.map(g=>e.jsxs(k,{variant:n===g.id?"default":"ghost",className:"w-full justify-start",onClick:()=>m(g.id),children:[e.jsx(g.icon,{className:"mr-2 h-4 w-4"}),g.label]},g.id))]}),s&&s.role==="teacher"&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-gray-200 dark:border-gray-700"}),l.map(g=>e.jsxs(k,{variant:n===g.id?"default":"ghost",className:"w-full justify-start",onClick:()=>m(g.id),children:[e.jsx(g.icon,{className:"mr-2 h-4 w-4"}),g.label]},g.id))]}),d.length>0&&s?.role==="student"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 px-3 py-2",children:"Успеваемость"}),d.map(g=>e.jsxs(k,{variant:n===g.id?"default":"ghost",className:"w-full justify-start",onClick:()=>m(g.id),children:[e.jsx(g.icon,{className:"mr-2 h-4 w-4"}),g.label]},g.id))]}),d.length>0&&s?.role==="teacher"&&e.jsx(e.Fragment,{children:d.map(g=>e.jsxs(k,{variant:n===g.id?"default":"ghost",className:"w-full justify-start",onClick:()=>m(g.id),children:[e.jsx(g.icon,{className:"mr-2 h-4 w-4"}),g.label]},g.id))}),u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-gray-200 dark:border-gray-700"}),e.jsxs("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 px-3 py-2 flex items-center gap-2",children:[e.jsx(lt,{className:"h-4 w-4"}),"Требуется вход"]}),u.map(g=>e.jsxs(k,{variant:"ghost",className:"w-full justify-start text-gray-500 dark:text-gray-400 cursor-pointer",onClick:()=>m(g.id),children:[e.jsx(g.icon,{className:"mr-2 h-4 w-4"}),g.label,e.jsx(lt,{className:"ml-auto h-3 w-3"})]},g.id))]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 px-3 py-2",children:"Аккаунт"}),e.jsxs(k,{variant:n==="profile"?"default":"ghost",className:"w-full justify-start",onClick:()=>m("profile"),children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Профиль"]})]})]}),s&&e.jsx("div",{className:"absolute bottom-6 left-6 right-6",children:e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:[s.username," (",s.role==="teacher"?"Преподаватель":s.role==="admin"?"Администратор":"Студент",")"]}),e.jsxs(k,{variant:"outline",className:"w-full",onClick:r,children:[e.jsx(Na,{className:"mr-2 h-4 w-4"}),"Выйти"]})]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Образовательный портал"}),s?.role==="admin"&&e.jsx("span",{className:"px-2 py-1 text-xs bg-red-600 text-white rounded-md font-medium",children:"ADMIN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsx(Il,{}),e.jsx(Hn,{})]})]})})}const Se=y.forwardRef(({className:n,...t},s)=>e.jsx("textarea",{ref:s,"data-slot":"textarea",className:q("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),...t}));Se.displayName="Textarea";function Ol({className:n,value:t=0,max:s=100,...r}){const a=Math.min(Math.max(t/s*100,0),100);return e.jsx("div",{"data-slot":"progress",className:q("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",n),...r,children:e.jsx("div",{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all duration-300 ease-in-out",style:{width:`${a}%`,transform:"translateX(0)"}})})}function Xt({className:n,children:t,...s}){return e.jsx("div",{className:q("relative overflow-auto",n),...s,children:t})}const $l=[{value:"Trophy",icon:be},{value:"Star",icon:es},{value:"Medal",icon:Ys},{value:"Award",icon:Zs},{value:"Target",icon:Xs},{value:"Crown",icon:sn},{value:"Flame",icon:rn},{value:"Zap",icon:nn},{value:"BookOpen",icon:ge},{value:"GraduationCap",icon:Ct}],Rl=[{value:"default",class:""},{value:"primary",class:"bg-primary text-primary-foreground"},{value:"secondary",class:"bg-secondary text-secondary-foreground"},{value:"success",class:"bg-green-500 text-white"},{value:"warning",class:"bg-yellow-500 text-white"},{value:"danger",class:"bg-red-500 text-white"},{value:"info",class:"bg-blue-500 text-white"}];function Gn({studentId:n,studentCourse:t,compact:s=!1}){const[r,a]=y.useState([]),[i,o]=y.useState([]);y.useEffect(()=>{l()},[]);const l=()=>{const h=localStorage.getItem("achievements");h&&a(JSON.parse(h));const v=localStorage.getItem("studentAchievements");v&&o(JSON.parse(v))},c=h=>{const v=$l.find(p=>p.value===h);return v?v.icon:be},d=h=>{const v=Rl.find(p=>p.value===h);return v?v.class:""},u=y.useMemo(()=>i.filter(h=>h.studentId===n).map(h=>{const v=r.find(p=>p.id===h.achievementId);return v?{...h,achievement:v}:null}).filter(Boolean).sort((h,v)=>new Date(v.dateEarned).getTime()-new Date(h.dateEarned).getTime()),[i,n,r]),m=y.useMemo(()=>r.filter(h=>h.isActive&&(h.course==="all"||h.course===t)),[r,t]),{totalPoints:g,completionRate:b}=y.useMemo(()=>{const h=u.reduce((p,j)=>p+(j.achievement?.points||0),0),v=m.length>0?u.length/m.length*100:0;return{totalPoints:h,completionRate:v}},[u,m]),x=h=>new Date(h).toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"});return s?e.jsxs(I,{children:[e.jsx(O,{className:"pb-4",children:e.jsxs($,{className:"flex items-center gap-2 text-lg",children:[e.jsx(be,{className:"h-5 w-5"}),"Достижения",u.length>0&&e.jsx(L,{variant:"secondary",className:"ml-auto",children:u.length})]})}),e.jsx(T,{children:u.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(be,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Пока нет достижений"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground mb-2",children:[e.jsxs("span",{children:["Прогресс: ",u.length,"/",m.length]}),e.jsxs("span",{children:[g," баллов"]})]}),e.jsx(Ol,{value:b,className:"h-2 mb-3"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[u.slice(0,6).map(h=>{const v=c(h.achievement.icon);return e.jsxs("div",{className:`flex items-center gap-1 p-2 rounded-lg text-xs ${d(h.achievement.color)} ${d(h.achievement.color)?"":"bg-muted"}`,title:`${h.achievement.title} - ${h.achievement.description}`,children:[e.jsx(v,{className:"h-3 w-3"}),e.jsx("span",{className:"max-w-20 truncate",children:h.achievement.title})]},h.achievementId)}),u.length>6&&e.jsxs("div",{className:"flex items-center justify-center p-2 bg-muted rounded-lg text-xs",children:["+",u.length-6]})]})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary rounded-lg",children:e.jsx(be,{className:"h-5 w-5 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Всего достижений"}),e.jsx("p",{className:"text-2xl font-semibold",children:u.length})]})]})})}),e.jsx(I,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(es,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Общие баллы"}),e.jsx("p",{className:"text-2xl font-semibold",children:g})]})]})})}),e.jsx(I,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500 rounded-lg",children:e.jsx(tn,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Прогресс"}),e.jsxs("p",{className:"text-2xl font-semibold",children:[Math.round(b),"%"]})]})]})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ys,{className:"h-5 w-5"}),"Полученные достижения"]})}),e.jsx(T,{children:u.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(be,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Пока нет достижений"}),e.jsx("p",{className:"text-sm mt-2",children:"Участвуйте в обучении и выполняйте задания, чтобы получить первые достижения!"})]}):e.jsx(Xt,{className:"h-64",children:e.jsx("div",{className:"space-y-3",children:u.map(h=>{const v=c(h.achievement.icon);return e.jsxs("div",{className:"flex items-start gap-4 p-3 border rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-lg ${d(h.achievement.color)} ${d(h.achievement.color)?"":"bg-primary text-primary-foreground"}`,children:e.jsx(v,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium",children:h.achievement.title}),e.jsxs(L,{variant:"outline",children:[h.achievement.points," баллов"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:h.achievement.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(kt,{className:"h-3 w-3"}),e.jsxs("span",{children:["Получено ",x(h.dateEarned)]})]})]})]},h.achievementId)})})})})]}),m.length>u.length&&e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"h-5 w-5"}),"Доступные достижения"]})}),e.jsx(T,{children:e.jsx(Xt,{className:"h-64",children:e.jsx("div",{className:"space-y-3",children:m.filter(h=>!u.some(v=>v.achievementId===h.id)).map(h=>{const v=c(h.icon);return e.jsxs("div",{className:"flex items-start gap-4 p-3 border rounded-lg opacity-60",children:[e.jsx("div",{className:`p-2 rounded-lg ${d(h.color)} ${d(h.color)?"":"bg-muted"}`,children:e.jsx(v,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium",children:h.title}),e.jsxs(L,{variant:"outline",children:[h.points," баллов"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:h.description}),h.criteria&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Критерии: ",h.criteria]})]})]},h.id)})})})})]})]})}function Pl({onClose:n,onSuccess:t}){const[s,r]=y.useState({title:"",message:"",type:"info",targetUsers:"all",specificUsers:"",expiryDate:""}),a=()=>{if(!s.title.trim()||!s.message.trim()){R.error("Заполните все обязательные поля");return}const l={id:Date.now().toString(),title:s.title.trim(),message:s.message.trim(),type:s.type,targetUsers:s.targetUsers,specificUsers:s.specificUsers?s.specificUsers.split(",").map(u=>u.trim()):void 0,expiryDate:s.expiryDate||void 0,createdAt:new Date().toISOString(),createdBy:"admin",isActive:!0},c=JSON.parse(localStorage.getItem("adminNotifications")||"[]"),d=[l,...c];localStorage.setItem("adminNotifications",JSON.stringify(d)),R.success("Уведомление создано успешно"),t(),n()},i=l=>{switch(l){case"info":return"Информационное сообщение";case"warning":return"Предупреждение или важная информация";case"success":return"Успешное завершение или достижение";case"error":return"Ошибка или критическая информация";default:return""}},o=l=>{switch(l){case"all":return"Все пользователи портала";case"students":return"Только студенты";case"teachers":return"Только преподаватели";case"specific":return"Конкретные пользователи";default:return""}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4",children:e.jsxs(I,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),"Быстрое уведомление"]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:n,children:e.jsx(Ke,{className:"h-4 w-4"})})]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"quick-title",children:"Заголовок *"}),e.jsx(U,{id:"quick-title",value:s.title,onChange:l=>r(c=>({...c,title:l.target.value})),placeholder:"Краткий заголовок уведомления",maxLength:100})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"quick-message",children:"Сообщение *"}),e.jsx(Se,{id:"quick-message",value:s.message,onChange:l=>r(c=>({...c,message:l.target.value})),placeholder:"Подробное описание...",rows:3,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[s.message.length,"/500"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"quick-type",children:"Тип уведомления"}),e.jsxs(Z,{value:s.type,onValueChange:l=>r(c=>({...c,type:l})),children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"info",children:"📢 Информация"}),e.jsx(E,{value:"warning",children:"⚠️ Предупреждение"}),e.jsx(E,{value:"success",children:"✅ Успех"}),e.jsx(E,{value:"error",children:"❌ Ошибка"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:i(s.type)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"quick-audience",children:"Аудитория"}),e.jsxs(Z,{value:s.targetUsers,onValueChange:l=>r(c=>({...c,targetUsers:l})),children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"👥 Все пользователи"}),e.jsx(E,{value:"students",children:"🎓 Только студенты"}),e.jsx(E,{value:"teachers",children:"👨‍🏫 Только преподаватели"}),e.jsx(E,{value:"specific",children:"👤 Конкретные пользователи"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:o(s.targetUsers)})]}),s.targetUsers==="specific"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"quick-users",children:"Имена пользователей"}),e.jsx(U,{id:"quick-users",value:s.specificUsers,onChange:l=>r(c=>({...c,specificUsers:l.target.value})),placeholder:"user1, user2, user3"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Введите имена пользователей через запятую"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"quick-expiry",children:"Срок действия (опционально)"}),e.jsx(U,{id:"quick-expiry",type:"datetime-local",value:s.expiryDate,onChange:l=>r(c=>({...c,expiryDate:l.target.value}))}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Оставьте пустым для постоянного уведомления"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(k,{onClick:a,className:"flex-1",children:[e.jsx(an,{className:"h-4 w-4 mr-2"}),"Отправить"]}),e.jsx(k,{variant:"outline",onClick:n,children:"Отмена"})]})]})]})})}function Bt({onLogin:n,onRegister:t,onSectionChange:s}){const{user:r,getUserCount:a}=je(),[i,o]=y.useState(0),[l,c]=y.useState([]),[d,u]=y.useState([]),[m,g]=y.useState(null),[b,x]=y.useState(!1);y.useEffect(()=>{if(o(a()),r){const j=JSON.parse(localStorage.getItem("student_events")||"[]"),f=JSON.parse(localStorage.getItem("student_announcements")||"[]"),w=j.filter(N=>N.targetCourse==="all"||N.targetCourse===r.course||N.targetRole==="all"||N.targetRole===r.role),_=f.filter(N=>!N.expiresAt||new Date(N.expiresAt)>new Date);c(w),u(_)}},[a,r]);const h=()=>{const j=JSON.parse(localStorage.getItem("student_events")||"[]"),f=new Date,w=j.filter(_=>_.endDate?new Date(_.endDate)>f:!0);w.length!==j.length&&(localStorage.setItem("student_events",JSON.stringify(w)),console.log(`Удалено ${j.length-w.length} истекших событий`))},v=j=>{h(),g(j)},p=j=>{s&&s(j)};return r?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Добро пожаловать, ",r.username,"!"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:r.role==="teacher"?"Панель преподавателя":"Панель студента"}),e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Всего участников: "}),e.jsx(L,{variant:"secondary",children:i})]})]}),r?.role==="admin"&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(k,{onClick:()=>x(!0),size:"sm",variant:"outline",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Создать уведомление"]})}),d.length>0&&e.jsxs(I,{className:"border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-950/20",children:[e.jsx(O,{children:e.jsx($,{className:"flex items-center gap-2 text-yellow-800 dark:text-yellow-200",children:"📢 Срочные объявления"})}),e.jsx(T,{children:e.jsx("div",{className:"space-y-3",children:d.map(j=>e.jsxs("div",{className:"border-l-4 border-yellow-500 pl-4",children:[e.jsx("p",{className:"font-medium text-yellow-900 dark:text-yellow-100",children:j.message}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:new Date(j.createdAt).toLocaleString("ru-RU")})]},j.id))})})]}),e.jsxs(I,{"data-section":"events",children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"h-5 w-5 text-blue-600"}),"Актуальные события"]}),r?.role==="admin"&&e.jsx(k,{onClick:()=>v("event"),size:"sm",variant:"outline",className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:e.jsx(he,{className:"h-4 w-4"})})]})}),e.jsx(T,{children:l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(j=>{const f={info:"border-blue-500",exam:"border-red-500",lecture:"border-green-500",event:"border-purple-500",deadline:"border-orange-500"},w={info:"📢",exam:"📝",lecture:"📚",event:"🎉",deadline:"⏰"};return e.jsxs("div",{className:`border-l-4 ${f[j.type]} pl-4`,children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:w[j.type]}),j.title]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[j.date," ",j.time," ",j.location&&`• ${j.location}`]}),j.description&&e.jsx("p",{className:"text-sm mt-1",children:j.description}),j.targetCourse!=="all"&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["🎯 ",j.targetCourse]})]},j.id)})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(kt,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Нет актуальных событий"}),e.jsx("p",{className:"text-sm",children:"События будут отображаться здесь"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[r.role==="student"&&e.jsx(e.Fragment,{children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Мои курсы"})}),e.jsxs(T,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:r.course?`${r.course} курс, ${r.group} группа`:"Не указано"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Факультет: ",r.faculty||"Не указан"]}),e.jsx(k,{className:"w-full",variant:"outline",onClick:()=>p("course"),children:"Перейти к материалам"})]})]})}),r.role==="teacher"&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Журнал оценок"})}),e.jsxs(T,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Управление оценками студентов"}),e.jsx(k,{className:"w-full",variant:"outline",onClick:()=>p("journal"),children:"Открыть журнал"})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Управление группами"})}),e.jsxs(T,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Отправка файлов студентам"}),e.jsx(k,{className:"w-full",variant:"outline",onClick:()=>p("groups"),children:"Управление группами"})]})]}),r.username&&r.course&&e.jsx(Gn,{studentId:r.username,studentCourse:r.course,compact:!0})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(St,{className:"h-5 w-5"}),"Информация"]})}),e.jsxs(T,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Корпуса, FAQ, льготы"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{className:"w-full",variant:"outline",size:"sm",onClick:()=>p("campuses"),children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"Корпуса"]}),e.jsx(k,{className:"w-full",variant:"outline",size:"sm",onClick:()=>p("faq"),children:"Вопросы и ответы"}),e.jsx(k,{className:"w-full",variant:"outline",size:"sm",onClick:()=>p("benefits"),children:"Льготы"})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Файлы"})}),e.jsxs(T,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Загруженные материалы и обмен файлами"}),e.jsx(k,{className:"w-full",variant:"outline",onClick:()=>p("files"),children:"Перейти к файлам"})]})]})]}),m&&e.jsx(Ul,{type:m,onClose:()=>g(null),onSuccess:()=>{if(r){const f=JSON.parse(localStorage.getItem("student_events")||"[]").filter(w=>w.targetCourse==="all"||w.targetCourse===r.course||w.targetRole==="all"||w.targetRole===r.role);c(f)}}}),b&&e.jsx(Pl,{onClose:()=>x(!1),onSuccess:()=>{console.log("Уведомление создано")}})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:"Добро пожаловать в образовательный портал"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400 max-w-3xl mx-auto",children:"Современная платформа для студентов и преподавателей медицинского университета"})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs(k,{size:"lg",onClick:n,children:[e.jsx(on,{className:"mr-2 h-5 w-5"}),"Войти"]}),e.jsxs(k,{variant:"outline",size:"lg",onClick:t,children:[e.jsx(Ht,{className:"mr-2 h-5 w-5"}),"Регистрация"]})]}),e.jsxs("div",{className:"flex justify-center items-center gap-2 text-lg",children:[e.jsx(Me,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Участников: "}),e.jsx(L,{variant:"secondary",className:"text-lg px-3 py-1",children:i})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-blue-600"}),"Обучающие материалы"]})}),e.jsx(T,{children:e.jsx(de,{children:"Доступ к конспектам лекций, презентациям и дополнительным материалам по курсам"})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"h-5 w-5 text-green-600"}),"Электронный журнал"]})}),e.jsx(T,{children:e.jsx(de,{children:"Система оценок и успеваемости для студентов и преподавателей"})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-5 w-5 text-purple-600"}),"Актуальная информация"]})}),e.jsx(T,{children:e.jsx(de,{children:"Информация о корпусах, льготах и ответы на часто задаваемые вопросы"})})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"О портале"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsx("p",{children:"Данный образовательный портал создан для удобства студентов и преподавателей медицинского университета. Здесь вы найдете все необходимые материалы для обучения, сможете отслеживать свою успеваемость и получать актуальную информацию."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Возможности портала:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-gray-600 dark:text-gray-400",children:[e.jsx("li",{children:"Загрузка и просмотр учебных материалов в формате Markdown"}),e.jsx("li",{children:"Обмен файлами между пользователями"}),e.jsx("li",{children:"Электронный журнал с системой оценок"}),e.jsx("li",{children:"Информация о корпусах университета"}),e.jsx("li",{children:"База знаний с ответами на частые вопросы"}),e.jsx("li",{children:"Информация о льготах и стипендиях"})]})]})]})]})]})}function Ul({type:n,onClose:t,onSuccess:s}){const[r,a]=y.useState(""),[i,o]=y.useState(""),[l,c]=y.useState(""),[d,u]=y.useState(""),[m,g]=y.useState("all"),b=()=>{if(!r.trim()){alert("Введите название");return}if(n==="event"){const x=JSON.parse(localStorage.getItem("student_events")||"[]"),h={id:Date.now(),title:r,description:i,date:l,endDate:l,location:d,targetCourse:m,type:"general",created:new Date().toISOString()};x.push(h),localStorage.setItem("student_events",JSON.stringify(x)),console.log("Событие добавлено!")}s(),t()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[90] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-background border rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"📅 Добавить событие"}),e.jsx(k,{variant:"ghost",size:"sm",onClick:t,children:e.jsx(Ke,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Название *"}),e.jsx(U,{value:r,onChange:x=>a(x.target.value),placeholder:"Название события"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Описание"}),e.jsx(Se,{value:i,onChange:x=>o(x.target.value),placeholder:"Подробное описание...",rows:3})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Дата и время"}),e.jsx(U,{type:"datetime-local",value:l,onChange:x=>c(x.target.value)})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Место"}),e.jsx(U,{value:d,onChange:x=>u(x.target.value),placeholder:"Аудитория, корпус"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Целевая аудитория"}),e.jsxs("select",{value:m,onChange:x=>g(x.target.value),className:"w-full p-2 border rounded bg-background text-foreground",children:[e.jsx("option",{value:"all",children:"Все курсы"}),e.jsx("option",{value:"1",children:"1 курс"}),e.jsx("option",{value:"2",children:"2 курс"}),e.jsx("option",{value:"3",children:"3 курс"}),e.jsx("option",{value:"4",children:"4 курс"}),e.jsx("option",{value:"5",children:"5 курс"}),e.jsx("option",{value:"6",children:"6 курс"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsxs(k,{onClick:b,className:"flex-1",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Добавить"]}),e.jsx(k,{variant:"outline",onClick:t,children:"Отмена"})]})]})})}const or=y.createContext(void 0);function Oe({defaultValue:n="",value:t,onValueChange:s,className:r,children:a,...i}){const[o,l]=y.useState(n),c=t!==void 0?t:o,d=s||l;return e.jsx(or.Provider,{value:{value:c,onValueChange:d},children:e.jsx("div",{className:q("w-full",r),...i,children:a})})}function $e({className:n,...t}){return e.jsx("div",{className:q("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",n),...t})}function H({value:n,className:t,children:s,...r}){const a=y.useContext(or);if(!a)throw new Error("TabsTrigger must be used within Tabs");const i=a.value===n;return e.jsx("button",{onClick:()=>a.onValueChange(n),className:q("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",i?"bg-background text-foreground shadow":"hover:bg-muted hover:text-foreground",t),...r,children:s})}function G({value:n,className:t,children:s,...r}){const a=y.useContext(or);if(!a)throw new Error("TabsContent must be used within Tabs");return a.value!==n?null:e.jsx("div",{className:q("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r,children:s})}const Dl="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==";function zr(n){const[t,s]=y.useState(!1),r=()=>{s(!0)},{src:a,alt:i,style:o,className:l,...c}=n;return t?e.jsx("div",{className:`inline-block bg-gray-100 text-center align-middle ${l??""}`,style:o,children:e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx("img",{src:Dl,alt:"Error loading image",...c,"data-original-url":a})})}):e.jsx("img",{src:a,alt:i,className:l,style:o,...c,onError:r})}const Vr=[{id:"main",name:"Главный корпус",address:"ул. Медицинская, 12, Москва",description:"Основной учебный корпус с современными аудиториями, административными помещениями и деканатами всех факультетов.",facilities:["Аудитории","Деканаты","Администрация","Столовая","Кафе","Актовый зал"],workingHours:"8:00 - 20:00",phone:"+7 (495) 123-45-67",imageUrl:"https://images.unsplash.com/photo-1633111158162-a4835dce7d0d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtZWRpY2FsJTIwdW5pdmVyc2l0eSUyMGJ1aWxkaW5nJTIwY2FtcHVzfGVufDF8fHx8MTc1ODczNjU0Nnww&ixlib=rb-4.1.0&q=80&w=1080",coordinates:"55.7558, 37.6173",transportInfo:["Метро: Сокольники (5 мин пешком)","Автобус: 40, 107, 265","Трамвай: 7, 37"]},{id:"lab",name:"Лабораторный корпус",address:"ул. Лабораторная, 8, Москва",description:"Современный корпус с оборудованными лабораториями для практических занятий по всем медицинским дисциплинам.",facilities:["Анатомические лаборатории","Химические лаборатории","Микроскопические залы","Компьютерные классы"],workingHours:"9:00 - 18:00",phone:"+7 (495) 123-45-68",imageUrl:"https://images.unsplash.com/photo-1576669801838-1b1c52121e6a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtZWRpY2FsJTIwbGFib3JhdG9yeSUyMHVuaXZlcnNpdHklMjBlcXVpcG1lbnR8ZW58MXx8fHwxNzU4NzM2NTUyfDA&ixlib=rb-4.1.0&q=80&w=1080",coordinates:"55.7468, 37.6203",transportInfo:["Метро: Красносельская (7 мин пешком)","Автобус: 122, 140","Троллейбус: 14, 41"]},{id:"library",name:"Библиотечный корпус",address:"ул. Научная, 15, Москва",description:"Центральная библиотека университета с обширным фондом медицинской литературы и современными читальными залами.",facilities:["Читальные залы","Компьютерный зал","Архив","Копировальный центр","Зона отдыха"],workingHours:"8:30 - 21:00",phone:"+7 (495) 123-45-69",imageUrl:"https://images.unsplash.com/photo-1660128355371-527b6c5f8b2f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx1bml2ZXJzaXR5JTIwbGlicmFyeSUyMG1lZGljYWwlMjBlZHVjYXRpb258ZW58MXx8fHwxNzU4NzM2NTQ5fDA&ixlib=rb-4.1.0&q=80&w=1080",coordinates:"55.7601, 37.6085",transportInfo:["Метро: Чистые пруды (10 мин пешком)","Автобус: 101, 132","Маршрутка: 406м"]}],Ll={1:{title:"1 курс",buildings:["Главный корпус","Библиотечный корпус"],description:"Первокурсники в основном занимаются в главном корпусе и пользуются библиотекой для самостоятельной работы."},2:{title:"2 курс",buildings:["Главный корпус","Лабораторный корпус","Библиотечный корпус"],description:"Второкурсники начинают практические занятия в лабораторном корпусе, продолжая теоретическое обучение."},3:{title:"3 курс",buildings:["Лабораторный корпус","Главный корпус"],description:"Студенты третьего курса больше времени проводят в лабораториях, изучая клинические дисциплины."}};function Fl(){const n=(t,s)=>{const r=`https://yandex.ru/maps/?text=${encodeURIComponent(s)}&ll=${t}&z=16`;window.open(r,"_blank")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Корпуса университета"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Подробная информация о корпусах, адресах и маршрутах"})]}),e.jsxs(Oe,{defaultValue:"all",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-4",children:[e.jsx(H,{value:"all",children:"Все корпуса"}),e.jsx(H,{value:"1",children:"1 курс"}),e.jsx(H,{value:"2",children:"2 курс"}),e.jsx(H,{value:"3",children:"3 курс"})]}),e.jsx(G,{value:"all",className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:Vr.map(t=>e.jsxs(I,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative h-48 w-full",children:[e.jsx(zr,{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(L,{variant:"secondary",children:t.name})})]}),e.jsxs(O,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-5 w-5"}),t.name]}),e.jsxs(de,{className:"flex items-center gap-1",children:[e.jsx(ks,{className:"h-4 w-4"}),t.address]})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm",children:t.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm",children:["Часы работы: ",t.workingHours]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:t.phone})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Помещения:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.facilities.map((s,r)=>e.jsx(L,{variant:"outline",className:"text-xs",children:s},r))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-1",children:[e.jsx(pr,{className:"h-4 w-4"}),"Транспорт:"]}),e.jsx("ul",{className:"text-sm space-y-1",children:t.transportInfo.map((s,r)=>e.jsxs("li",{className:"text-gray-600 dark:text-gray-400",children:["• ",s]},r))})]}),e.jsxs(k,{variant:"outline",className:"w-full",onClick:()=>n(t.coordinates,t.name),children:[e.jsx(vr,{className:"mr-2 h-4 w-4"}),"Открыть на карте"]})]})]},t.id))})}),Object.entries(Ll).map(([t,s])=>e.jsxs(G,{value:t,className:"space-y-6",children:[e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsx($,{children:s.title}),e.jsx(de,{children:s.description})]}),e.jsx(T,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Основные корпуса для обучения:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.buildings.map((r,a)=>e.jsx(L,{variant:"default",children:r},a))})]})})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:Vr.filter(r=>s.buildings.includes(r.name)).map(r=>e.jsxs(I,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative h-48 w-full",children:[e.jsx(zr,{src:r.imageUrl,alt:r.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(L,{variant:"secondary",children:r.name})})]}),e.jsxs(O,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-5 w-5"}),r.name]}),e.jsxs(de,{className:"flex items-center gap-1",children:[e.jsx(ks,{className:"h-4 w-4"}),r.address]})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm",children:["Часы работы: ",r.workingHours]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:r.phone})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-1",children:[e.jsx(pr,{className:"h-4 w-4"}),"Как добраться:"]}),e.jsx("ul",{className:"text-sm space-y-1",children:r.transportInfo.map((a,i)=>e.jsxs("li",{className:"text-gray-600 dark:text-gray-400",children:["• ",a]},i))})]}),e.jsxs(k,{variant:"outline",className:"w-full",onClick:()=>n(r.coordinates,r.name),children:[e.jsx(vr,{className:"mr-2 h-4 w-4"}),"Открыть на карте"]})]})]},r.id))})]},t))]})]})}function lr(n,t=[]){let s=[];function r(i,o){const l=y.createContext(o),c=s.length;s=[...s,o];const d=m=>{const{scope:g,children:b,...x}=m,h=g?.[n]?.[c]||l,v=y.useMemo(()=>x,Object.values(x));return e.jsx(h.Provider,{value:v,children:b})};d.displayName=i+"Provider";function u(m,g){const b=g?.[n]?.[c]||l,x=y.useContext(b);if(x)return x;if(o!==void 0)return o;throw new Error(`\`${m}\` must be used within \`${i}\``)}return[d,u]}const a=()=>{const i=s.map(o=>y.createContext(o));return function(l){const c=l?.[n]||i;return y.useMemo(()=>({[`__scope${n}`]:{...l,[n]:c}}),[l,c])}};return a.scopeName=n,[r,Ml(a,...t)]}function Ml(...n){const t=n[0];if(n.length===1)return t;const s=()=>{const r=n.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(i){const o=r.reduce((l,{useScope:c,scopeName:d})=>{const m=c(i)[`__scope${d}`];return{...l,...m}},{});return y.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return s.scopeName=t.scopeName,s}function Wr(n,t){if(typeof n=="function")return n(t);n!=null&&(n.current=t)}function Kn(...n){return t=>{let s=!1;const r=n.map(a=>{const i=Wr(a,t);return!s&&typeof i=="function"&&(s=!0),i});if(s)return()=>{for(let a=0;a<r.length;a++){const i=r[a];typeof i=="function"?i():Wr(n[a],null)}}}}function At(...n){return y.useCallback(Kn(...n),n)}function zs(n){const t=Bl(n),s=y.forwardRef((r,a)=>{const{children:i,...o}=r,l=y.Children.toArray(i),c=l.find(ql);if(c){const d=c.props.children,u=l.map(m=>m===c?y.Children.count(d)>1?y.Children.only(null):y.isValidElement(d)?d.props.children:null:m);return e.jsx(t,{...o,ref:a,children:y.isValidElement(d)?y.cloneElement(d,void 0,u):null})}return e.jsx(t,{...o,ref:a,children:i})});return s.displayName=`${n}.Slot`,s}function Bl(n){const t=y.forwardRef((s,r)=>{const{children:a,...i}=s;if(y.isValidElement(a)){const o=Vl(a),l=zl(i,a.props);return a.type!==y.Fragment&&(l.ref=r?Kn(r,o):o),y.cloneElement(a,l)}return y.Children.count(a)>1?y.Children.only(null):null});return t.displayName=`${n}.SlotClone`,t}var Jl=Symbol("radix.slottable");function ql(n){return y.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===Jl}function zl(n,t){const s={...t};for(const r in t){const a=n[r],i=t[r];/^on[A-Z]/.test(r)?a&&i?s[r]=(...l)=>{const c=i(...l);return a(...l),c}:a&&(s[r]=a):r==="style"?s[r]={...a,...i}:r==="className"&&(s[r]=[a,i].filter(Boolean).join(" "))}return{...n,...s}}function Vl(n){let t=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning;return s?n.ref:(t=Object.getOwnPropertyDescriptor(n,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning,s?n.props.ref:n.props.ref||n.ref)}function Wl(n){const t=n+"CollectionProvider",[s,r]=lr(t),[a,i]=s(t,{collectionRef:{current:null},itemMap:new Map}),o=h=>{const{scope:v,children:p}=h,j=re.useRef(null),f=re.useRef(new Map).current;return e.jsx(a,{scope:v,itemMap:f,collectionRef:j,children:p})};o.displayName=t;const l=n+"CollectionSlot",c=zs(l),d=re.forwardRef((h,v)=>{const{scope:p,children:j}=h,f=i(l,p),w=At(v,f.collectionRef);return e.jsx(c,{ref:w,children:j})});d.displayName=l;const u=n+"CollectionItemSlot",m="data-radix-collection-item",g=zs(u),b=re.forwardRef((h,v)=>{const{scope:p,children:j,...f}=h,w=re.useRef(null),_=At(v,w),N=i(u,p);return re.useEffect(()=>(N.itemMap.set(w,{ref:w,...f}),()=>void N.itemMap.delete(w))),e.jsx(g,{[m]:"",ref:_,children:j})});b.displayName=u;function x(h){const v=i(n+"CollectionConsumer",h);return re.useCallback(()=>{const j=v.collectionRef.current;if(!j)return[];const f=Array.from(j.querySelectorAll(`[${m}]`));return Array.from(v.itemMap.values()).sort((N,C)=>f.indexOf(N.ref.current)-f.indexOf(C.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:o,Slot:d,ItemSlot:b},x,r]}function Yn(n,t,{checkForDefaultPrevented:s=!0}={}){return function(a){if(n?.(a),s===!1||!a.defaultPrevented)return t?.(a)}}var It=globalThis?.document?y.useLayoutEffect:()=>{},Hl=Zr[" useInsertionEffect ".trim().toString()]||It;function cr({prop:n,defaultProp:t,onChange:s=()=>{},caller:r}){const[a,i,o]=Gl({defaultProp:t,onChange:s}),l=n!==void 0,c=l?n:a;{const u=y.useRef(n!==void 0);y.useEffect(()=>{const m=u.current;m!==l&&console.warn(`${r} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,r])}const d=y.useCallback(u=>{if(l){const m=Kl(u)?u(n):u;m!==n&&o.current?.(m)}else i(u)},[l,n,i,o]);return[c,d]}function Gl({defaultProp:n,onChange:t}){const[s,r]=y.useState(n),a=y.useRef(s),i=y.useRef(t);return Hl(()=>{i.current=t},[t]),y.useEffect(()=>{a.current!==s&&(i.current?.(s),a.current=s)},[s,a]),[s,r,i]}function Kl(n){return typeof n=="function"}var Yl=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ut=Yl.reduce((n,t)=>{const s=zs(`Primitive.${t}`),r=y.forwardRef((a,i)=>{const{asChild:o,...l}=a,c=o?s:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(c,{...l,ref:i})});return r.displayName=`Primitive.${t}`,{...n,[t]:r}},{});function Xl(n,t){return y.useReducer((s,r)=>t[s][r]??s,n)}var Xn=n=>{const{present:t,children:s}=n,r=Zl(t),a=typeof s=="function"?s({present:r.isPresent}):y.Children.only(s),i=At(r.ref,Ql(a));return typeof s=="function"||r.isPresent?y.cloneElement(a,{ref:i}):null};Xn.displayName="Presence";function Zl(n){const[t,s]=y.useState(),r=y.useRef(null),a=y.useRef(n),i=y.useRef("none"),o=n?"mounted":"unmounted",[l,c]=Xl(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return y.useEffect(()=>{const d=Jt(r.current);i.current=l==="mounted"?d:"none"},[l]),It(()=>{const d=r.current,u=a.current;if(u!==n){const g=i.current,b=Jt(d);n?c("MOUNT"):b==="none"||d?.display==="none"?c("UNMOUNT"):c(u&&g!==b?"ANIMATION_OUT":"UNMOUNT"),a.current=n}},[n,c]),It(()=>{if(t){let d;const u=t.ownerDocument.defaultView??window,m=b=>{const h=Jt(r.current).includes(CSS.escape(b.animationName));if(b.target===t&&h&&(c("ANIMATION_END"),!a.current)){const v=t.style.animationFillMode;t.style.animationFillMode="forwards",d=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=v)})}},g=b=>{b.target===t&&(i.current=Jt(r.current))};return t.addEventListener("animationstart",g),t.addEventListener("animationcancel",m),t.addEventListener("animationend",m),()=>{u.clearTimeout(d),t.removeEventListener("animationstart",g),t.removeEventListener("animationcancel",m),t.removeEventListener("animationend",m)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:y.useCallback(d=>{r.current=d?getComputedStyle(d):null,s(d)},[])}}function Jt(n){return n?.animationName||"none"}function Ql(n){let t=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning;return s?n.ref:(t=Object.getOwnPropertyDescriptor(n,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning,s?n.props.ref:n.props.ref||n.ref)}var ec=Zr[" useId ".trim().toString()]||(()=>{}),tc=0;function Zn(n){const[t,s]=y.useState(ec());return It(()=>{s(r=>r??String(tc++))},[n]),t?`radix-${t}`:""}var cs="Collapsible",[sc,Qn]=lr(cs),[rc,dr]=sc(cs),ea=y.forwardRef((n,t)=>{const{__scopeCollapsible:s,open:r,defaultOpen:a,disabled:i,onOpenChange:o,...l}=n,[c,d]=cr({prop:r,defaultProp:a??!1,onChange:o,caller:cs});return e.jsx(rc,{scope:s,disabled:i,contentId:Zn(),open:c,onOpenToggle:y.useCallback(()=>d(u=>!u),[d]),children:e.jsx(Ut.div,{"data-state":hr(c),"data-disabled":i?"":void 0,...l,ref:t})})});ea.displayName=cs;var ta="CollapsibleTrigger",sa=y.forwardRef((n,t)=>{const{__scopeCollapsible:s,...r}=n,a=dr(ta,s);return e.jsx(Ut.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":hr(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...r,ref:t,onClick:Yn(n.onClick,a.onOpenToggle)})});sa.displayName=ta;var ur="CollapsibleContent",ra=y.forwardRef((n,t)=>{const{forceMount:s,...r}=n,a=dr(ur,n.__scopeCollapsible);return e.jsx(Xn,{present:s||a.open,children:({present:i})=>e.jsx(nc,{...r,ref:t,present:i})})});ra.displayName=ur;var nc=y.forwardRef((n,t)=>{const{__scopeCollapsible:s,present:r,children:a,...i}=n,o=dr(ur,s),[l,c]=y.useState(r),d=y.useRef(null),u=At(t,d),m=y.useRef(0),g=m.current,b=y.useRef(0),x=b.current,h=o.open||l,v=y.useRef(h),p=y.useRef(void 0);return y.useEffect(()=>{const j=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(j)},[]),It(()=>{const j=d.current;if(j){p.current=p.current||{transitionDuration:j.style.transitionDuration,animationName:j.style.animationName},j.style.transitionDuration="0s",j.style.animationName="none";const f=j.getBoundingClientRect();m.current=f.height,b.current=f.width,v.current||(j.style.transitionDuration=p.current.transitionDuration,j.style.animationName=p.current.animationName),c(r)}},[o.open,r]),e.jsx(Ut.div,{"data-state":hr(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!h,...i,ref:u,style:{"--radix-collapsible-content-height":g?`${g}px`:void 0,"--radix-collapsible-content-width":x?`${x}px`:void 0,...n.style},children:h&&a})});function hr(n){return n?"open":"closed"}var ac=ea,ic=sa,oc=ra,lc=y.createContext(void 0);function cc(n){const t=y.useContext(lc);return n||t||"ltr"}var Ce="Accordion",dc=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[mr,uc,hc]=Wl(Ce),[ds]=lr(Ce,[hc,Qn]),fr=Qn(),na=re.forwardRef((n,t)=>{const{type:s,...r}=n,a=r,i=r;return e.jsx(mr.Provider,{scope:n.__scopeAccordion,children:s==="multiple"?e.jsx(xc,{...i,ref:t}):e.jsx(gc,{...a,ref:t})})});na.displayName=Ce;var[aa,mc]=ds(Ce),[ia,fc]=ds(Ce,{collapsible:!1}),gc=re.forwardRef((n,t)=>{const{value:s,defaultValue:r,onValueChange:a=()=>{},collapsible:i=!1,...o}=n,[l,c]=cr({prop:s,defaultProp:r??"",onChange:a,caller:Ce});return e.jsx(aa,{scope:n.__scopeAccordion,value:re.useMemo(()=>l?[l]:[],[l]),onItemOpen:c,onItemClose:re.useCallback(()=>i&&c(""),[i,c]),children:e.jsx(ia,{scope:n.__scopeAccordion,collapsible:i,children:e.jsx(oa,{...o,ref:t})})})}),xc=re.forwardRef((n,t)=>{const{value:s,defaultValue:r,onValueChange:a=()=>{},...i}=n,[o,l]=cr({prop:s,defaultProp:r??[],onChange:a,caller:Ce}),c=re.useCallback(u=>l((m=[])=>[...m,u]),[l]),d=re.useCallback(u=>l((m=[])=>m.filter(g=>g!==u)),[l]);return e.jsx(aa,{scope:n.__scopeAccordion,value:o,onItemOpen:c,onItemClose:d,children:e.jsx(ia,{scope:n.__scopeAccordion,collapsible:!0,children:e.jsx(oa,{...i,ref:t})})})}),[pc,us]=ds(Ce),oa=re.forwardRef((n,t)=>{const{__scopeAccordion:s,disabled:r,dir:a,orientation:i="vertical",...o}=n,l=re.useRef(null),c=At(l,t),d=uc(s),m=cc(a)==="ltr",g=Yn(n.onKeyDown,b=>{if(!dc.includes(b.key))return;const x=b.target,h=d().filter(P=>!P.ref.current?.disabled),v=h.findIndex(P=>P.ref.current===x),p=h.length;if(v===-1)return;b.preventDefault();let j=v;const f=0,w=p-1,_=()=>{j=v+1,j>w&&(j=f)},N=()=>{j=v-1,j<f&&(j=w)};switch(b.key){case"Home":j=f;break;case"End":j=w;break;case"ArrowRight":i==="horizontal"&&(m?_():N());break;case"ArrowDown":i==="vertical"&&_();break;case"ArrowLeft":i==="horizontal"&&(m?N():_());break;case"ArrowUp":i==="vertical"&&N();break}const C=j%p;h[C].ref.current?.focus()});return e.jsx(pc,{scope:s,disabled:r,direction:a,orientation:i,children:e.jsx(mr.Slot,{scope:s,children:e.jsx(Ut.div,{...o,"data-orientation":i,ref:c,onKeyDown:r?void 0:g})})})}),Zt="AccordionItem",[vc,gr]=ds(Zt),la=re.forwardRef((n,t)=>{const{__scopeAccordion:s,value:r,...a}=n,i=us(Zt,s),o=mc(Zt,s),l=fr(s),c=Zn(),d=r&&o.value.includes(r)||!1,u=i.disabled||n.disabled;return e.jsx(vc,{scope:s,open:d,disabled:u,triggerId:c,children:e.jsx(ac,{"data-orientation":i.orientation,"data-state":fa(d),...l,...a,ref:t,disabled:u,open:d,onOpenChange:m=>{m?o.onItemOpen(r):o.onItemClose(r)}})})});la.displayName=Zt;var ca="AccordionHeader",da=re.forwardRef((n,t)=>{const{__scopeAccordion:s,...r}=n,a=us(Ce,s),i=gr(ca,s);return e.jsx(Ut.h3,{"data-orientation":a.orientation,"data-state":fa(i.open),"data-disabled":i.disabled?"":void 0,...r,ref:t})});da.displayName=ca;var Vs="AccordionTrigger",ua=re.forwardRef((n,t)=>{const{__scopeAccordion:s,...r}=n,a=us(Ce,s),i=gr(Vs,s),o=fc(Vs,s),l=fr(s);return e.jsx(mr.ItemSlot,{scope:s,children:e.jsx(ic,{"aria-disabled":i.open&&!o.collapsible||void 0,"data-orientation":a.orientation,id:i.triggerId,...l,...r,ref:t})})});ua.displayName=Vs;var ha="AccordionContent",ma=re.forwardRef((n,t)=>{const{__scopeAccordion:s,...r}=n,a=us(Ce,s),i=gr(ha,s),o=fr(s);return e.jsx(oc,{role:"region","aria-labelledby":i.triggerId,"data-orientation":a.orientation,...o,...r,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...n.style}})});ma.displayName=ha;function fa(n){return n?"open":"closed"}var jc=na,yc=la,wc=da,bc=ua,Nc=ma;function _c({...n}){return e.jsx(jc,{"data-slot":"accordion",...n})}function Sc({className:n,...t}){return e.jsx(yc,{"data-slot":"accordion-item",className:q("border-b last:border-b-0",n),...t})}function kc({className:n,children:t,...s}){return e.jsx(wc,{className:"flex",children:e.jsxs(bc,{"data-slot":"accordion-trigger",className:q("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",n),...s,children:[t,e.jsx(Qr,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function Cc({className:n,children:t,...s}){return e.jsx(Nc,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...s,children:e.jsx("div",{className:q("pt-0 pb-4",n),children:t})})}function Ec(){const n=[{category:"Поступление",badge:"Абитуриентам",questions:[{question:"Какие документы нужны для поступления?",answer:"Для поступления необходимы: аттестат о среднем образовании, паспорт, медицинская справка форма 086-У, 6 фотографий 3x4, заявление о приеме, документы, подтверждающие льготы (при наличии)."},{question:"Когда начинается приемная кампания?",answer:"Приемная кампания обычно начинается в июне. Подача документов - с 20 июня по 25 июля. Вступительные экзамены проводятся в августе. Точные даты уточняйте на официальном сайте университета."},{question:"Какие экзамены нужно сдавать?",answer:"Для большинства специальностей требуются: русский язык, химия, биология. Для некоторых направлений также математика или физика. Конкретный перечень зависит от выбранной специальности."}]},{category:"Учеба",badge:"Студентам",questions:[{question:"Как проходит учебный процесс?",answer:"Учебный год делится на 2 семестра. Занятия проходят в виде лекций, семинаров и практических работ. В конце каждого семестра - экзаменационная сессия. Обязательна практика в медицинских учреждениях."},{question:"Можно ли перевестись с другого факультета/вуза?",answer:"Да, перевод возможен при наличии свободных мест и успешной сдаче академической разности. Документы на перевод подаются в деканат до начала учебного года."},{question:"Что делать, если пропустил занятия по болезни?",answer:"Необходимо предоставить справку из медучреждения в деканат в течение 3 дней после выздоровления. Пропущенные занятия нужно отработать в установленные преподавателем сроки."},{question:"Как получить академический отпуск?",answer:"Для получения академического отпуска нужно подать заявление в деканат с указанием причины. К заявлению прикладываются подтверждающие документы (медицинские справки, повестка в армию и т.д.)."}]},{category:"Стипендии",badge:"Финансы",questions:[{question:"Кто имеет право на стипендию?",answer:"Право на академическую стипендию имеют студенты, обучающиеся на 'хорошо' и 'отлично'. Социальная стипендия назначается студентам из малообеспеченных семей, сиротам, инвалидам."},{question:"Когда выплачивается стипендия?",answer:"Стипендия выплачивается ежемесячно до 25 числа. Первая выплата обычно происходит в октябре (после первой сессии для первокурсников)."},{question:"Можно ли получать несколько видов стипендий одновременно?",answer:"Да, студент может одновременно получать академическую и социальную стипендии. Также возможно получение именных стипендий и стипендий за достижения в науке."}]},{category:"Проживание",badge:"Общежитие",questions:[{question:"Как получить место в общежитии?",answer:"Для получения места в общежитии нужно подать заявление в студенческий отдел. Места предоставляются в первую очередь иногородним студентам, сиротам, студентам из малообеспеченных семей."},{question:"Сколько стоит проживание в общежитии?",answer:"Стоимость проживания составляет около 1500-2500 рублей в месяц в зависимости от типа комнаты. Оплата производится до 10 числа каждого месяца."},{question:"Какие правила проживания в общежитии?",answer:"В общежитии действует пропускной режим, запрещено употребление алкоголя, курение разрешено только в специально отведенных местах. Время тишины с 23:00 до 7:00."}]}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Gs,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Часто задаваемые вопросы"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Ответы на самые популярные вопросы студентов и абитуриентов"})]}),e.jsx("div",{className:"space-y-8",children:n.map((t,s)=>e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[t.category,e.jsx(L,{variant:"outline",children:t.badge})]}),e.jsxs(de,{children:[t.questions.length," вопросов"]})]}),e.jsx(T,{children:e.jsx(_c,{type:"single",collapsible:!0,className:"w-full",children:t.questions.map((r,a)=>e.jsxs(Sc,{value:`${s}-${a}`,children:[e.jsx(kc,{className:"text-left",children:r.question}),e.jsx(Cc,{className:"text-gray-600 dark:text-gray-400",children:r.answer})]},a))})})]},s))}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Не нашли ответ на свой вопрос?"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Если вы не нашли ответ на интересующий вас вопрос, обратитесь:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Учебный отдел"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Телефон: +7 (123) 456-78-90",e.jsx("br",{}),"Email: study@meduni.ru",e.jsx("br",{}),"Кабинет 205, главный корпус"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Студенческий отдел"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Телефон: +7 (123) 456-78-91",e.jsx("br",{}),"Email: students@meduni.ru",e.jsx("br",{}),"Кабинет 102, главный корпус"]})]})]})]})]})]})}function Ac(){const n={categories:[{title:"Сироты и дети, оставшиеся без попечения родителей",documents:["Справка из органов опеки","Документы, подтверждающие статус сироты"],amount:"2 740 рублей"},{title:"Дети-инвалиды и инвалиды I-II групп",documents:["Справка МСЭ","Медицинские документы"],amount:"2 740 рублей"},{title:"Малообеспеченные семьи",documents:["Справка о доходах всех членов семьи","Справка из соцзащиты о назначении государственной социальной помощи"],amount:"2 740 рублей"},{title:"Студенты из многодетных семей",documents:["Удостоверение многодетной семьи","Справка о составе семьи"],amount:"2 740 рублей"}],procedure:["Подать заявление в деканат","Приложить необходимые документы","Дождаться рассмотрения заявления (до 10 рабочих дней)","Получить уведомление о назначении стипендии"]},t={benefits:["Бесплатный проезд на всех видах городского транспорта","Бесплатный проезд на пригородных электричках (в учебное время)","Скидки в музеях и театрах","Льготы при покупке лекарств"],documents:["Паспорт гражданина РФ","Справка с места учебы","Фотография 3x4 см","Заявление установленной формы"],procedure:["Обратиться в МФЦ или центр выдачи социальных карт","Подать заявление с необходимыми документами","Дождаться изготовления карты (5-10 рабочих дней)","Получить карту в указанном месте"],validity:"Карта действительна весь период обучения"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ks,{className:"h-8 w-8 text-green-600"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Льготы и стипендии"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Информация о социальных льготах и стипендиях для студентов"})]}),e.jsxs(Oe,{defaultValue:"stipend",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-2",children:[e.jsxs(H,{value:"stipend",className:"flex items-center gap-2",children:[e.jsx(_a,{className:"h-4 w-4"}),"Социальная стипендия"]}),e.jsxs(H,{value:"transport",className:"flex items-center gap-2",children:[e.jsx(jr,{className:"h-4 w-4"}),"Социальная карта"]})]}),e.jsxs(G,{value:"stipend",className:"space-y-6",children:[e.jsxs(xe,{children:[e.jsx(ct,{className:"h-4 w-4"}),e.jsx(qr,{children:"Важная информация"}),e.jsx(pe,{children:"Социальная стипендия назначается вне зависимости от успеваемости и выплачивается дополнительно к академической стипендии."})]}),e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsx($,{children:"Категории получателей социальной стипендии"}),e.jsx(de,{children:"Право на получение социальной стипендии имеют следующие категории студентов"})]}),e.jsx(T,{children:e.jsx("div",{className:"grid gap-4",children:n.categories.map((s,r)=>e.jsxs(I,{className:"border-l-4 border-l-green-500",children:[e.jsx(O,{className:"pb-3",children:e.jsxs($,{className:"text-lg flex items-center justify-between",children:[s.title,e.jsx(L,{variant:"secondary",children:s.amount})]})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-sm",children:"Необходимые документы:"}),e.jsx("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:s.documents.map((a,i)=>e.jsxs("li",{children:["• ",a]},i))})]})})]},r))})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Порядок оформления"]})}),e.jsxs(T,{children:[e.jsx("div",{className:"space-y-3",children:n.procedure.map((s,r)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{variant:"outline",className:"text-xs",children:r+1}),e.jsx("p",{className:"text-sm",children:s})]},r))}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Контакты для справок:"}),e.jsx("br",{}),"Отдел по социальной работе",e.jsx("br",{}),"Кабинет 150, главный корпус",e.jsx("br",{}),"Телефон: +7 (123) 456-78-95",e.jsx("br",{}),"Email: social@meduni.ru"]})})]})]})]}),e.jsxs(G,{value:"transport",className:"space-y-6",children:[e.jsxs(xe,{children:[e.jsx(ct,{className:"h-4 w-4"}),e.jsx(qr,{children:"Социальная карта студента"}),e.jsx(pe,{children:"Позволяет бесплатно пользоваться общественным транспортом и получать различные льготы."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(jr,{className:"h-5 w-5 text-blue-600"}),"Льготы по карте"]})}),e.jsx(T,{children:e.jsx("ul",{className:"space-y-2",children:t.benefits.map((s,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(L,{variant:"outline",className:"text-xs mt-1",children:"✓"}),e.jsx("span",{className:"text-sm",children:s})]},r))})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Необходимые документы"})}),e.jsx(T,{children:e.jsx("ul",{className:"space-y-2",children:t.documents.map((s,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ve,{className:"h-4 w-4 mt-1 text-gray-600"}),e.jsx("span",{className:"text-sm",children:s})]},r))})})]})]}),e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsx($,{children:"Порядок получения"}),e.jsx(de,{children:"Пошаговая инструкция по оформлению социальной карты"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"space-y-3",children:t.procedure.map((s,r)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{variant:"default",className:"text-xs",children:r+1}),e.jsx("p",{className:"text-sm",children:s})]},r))}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Cs,{className:"h-4 w-4 mt-1 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-blue-900 dark:text-blue-100",children:t.validity}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"При переводе на следующий курс необходимо обновить справку с места учебы"})]})]})})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Центры выдачи социальных карт"})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:'МФЦ "Центральный"'}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ул. Центральная, 25",e.jsx("br",{}),"Режим работы: Пн-Пт 8:00-20:00, Сб 9:00-18:00",e.jsx("br",{}),"Телефон: +7 (123) 456-78-96"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:'МФЦ "Студенческий"'}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ул. Студенческая, 10",e.jsx("br",{}),"Режим работы: Пн-Пт 9:00-18:00",e.jsx("br",{}),"Телефон: +7 (123) 456-78-97"]})]})]})})]})]})]})]})}function Ic({onComplete:n,onCancel:t}){const[s,r]=y.useState(1),[a,i]=y.useState({course:"",group:"",faculty:"",subject:"",students:[],columns:["ФИО"],maxScore:100}),o=()=>e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:["Создание журнала",e.jsx(L,{variant:"outline",children:"Шаг 1 из 3"})]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"course",children:"Курс"}),e.jsxs(Z,{value:a.course,onValueChange:w=>i({...a,course:w}),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Выберите курс"})}),e.jsxs(te,{children:[e.jsx(E,{value:"1",children:"1 курс"}),e.jsx(E,{value:"2",children:"2 курс"}),e.jsx(E,{value:"3",children:"3 курс"}),e.jsx(E,{value:"4",children:"4 курс"}),e.jsx(E,{value:"5",children:"5 курс"}),e.jsx(E,{value:"6",children:"6 курс"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"group",children:"Группа"}),e.jsx(U,{id:"group",placeholder:"Номер группы",value:a.group||"",onChange:w=>i({...a,group:w.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"faculty",children:"Факультет"}),e.jsxs(Z,{value:a.faculty,onValueChange:w=>i({...a,faculty:w}),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Выберите факультет"})}),e.jsxs(te,{children:[e.jsx(E,{value:"pediatrics",children:"Педиатрия"}),e.jsx(E,{value:"therapy",children:"Лечебное дело"}),e.jsx(E,{value:"dentistry",children:"Стоматология"}),e.jsx(E,{value:"pharmacy",children:"Фармация"}),e.jsx(E,{value:"nursing",children:"Сестринское дело"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"subject",children:"Предмет"}),e.jsx(U,{id:"subject",placeholder:"Название предмета",value:a.subject||"",onChange:w=>i({...a,subject:w.target.value})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(k,{variant:"outline",onClick:t,children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Отмена"]}),e.jsxs(k,{onClick:()=>r(2),disabled:!a.course||!a.group||!a.faculty||!a.subject,children:["Далее",e.jsx(yr,{className:"h-4 w-4 ml-2"})]})]})]})]}),[l,c]=y.useState([["ФИО"]]),[d,u]=y.useState(["ФИО"]),m=()=>{c([...l,new Array(d.length).fill("")])},g=()=>{const w=`Колонка ${d.length}`;u([...d,w]),c(l.map(_=>[..._,""]))},b=w=>{l.length>1&&c(l.filter((_,N)=>N!==w))},x=w=>{d.length>1&&(u(d.filter((_,N)=>N!==w)),c(l.map(_=>_.filter((N,C)=>C!==w))))},h=(w,_,N)=>{const C=[...l];C[w][_]=N,c(C)},v=(w,_)=>{const N=[...d];N[w]=_,u(N)},p=()=>e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:["Структура таблицы",e.jsx(L,{variant:"outline",children:"Шаг 2 из 3"})]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:m,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Добавить строку"]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:g,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Добавить столбец"]})]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[d.map((w,_)=>e.jsx("th",{className:"border p-2 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{value:w,onChange:N=>v(_,N.target.value),className:"text-sm"}),d.length>1&&e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>x(_),children:e.jsx(ke,{className:"h-3 w-3"})})]})},_)),e.jsx("th",{className:"border p-2 bg-gray-50 dark:bg-gray-800 w-12",children:"Действия"})]})}),e.jsx("tbody",{children:l.map((w,_)=>e.jsxs("tr",{children:[w.map((N,C)=>e.jsx("td",{className:"border p-2",children:e.jsx(U,{value:N,onChange:P=>h(_,C,P.target.value),className:"text-sm",placeholder:C===0?"ФИО студента":"Данные"})},C)),e.jsx("td",{className:"border p-2 text-center",children:l.length>1&&e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>b(_),children:e.jsx(ke,{className:"h-3 w-3"})})})]},_))})]})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(k,{variant:"outline",onClick:()=>r(1),children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Назад"]}),e.jsxs(k,{onClick:()=>r(3),disabled:l.length===0||l.every(w=>w[0]===""),children:["Далее",e.jsx(yr,{className:"h-4 w-4 ml-2"})]})]})]})]}),j=()=>e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:["Настройки оценивания",e.jsx(L,{variant:"outline",children:"Шаг 3 из 3"})]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"maxScore",children:"Максимальный балл"}),e.jsx(U,{id:"maxScore",type:"number",placeholder:"100",value:a.maxScore||"",onChange:w=>i({...a,maxScore:parseInt(w.target.value)||100})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Максимальное количество баллов, которое студент может получить за семестр"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Предварительный просмотр"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Курс:"})," ",a.course]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Группа:"})," ",a.group]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Факультет:"})," ",a.faculty]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Предмет:"})," ",a.subject]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Студентов:"})," ",l.length]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Столбцов оценок:"})," ",d.length-1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Максимальный балл:"})," ",a.maxScore]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(k,{variant:"outline",onClick:()=>r(2),children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Назад"]}),e.jsx(k,{onClick:f,children:"Создать журнал"})]})]})]}),f=()=>{const w=l.map(N=>({name:N[0]||"Без имени",scores:new Array(d.length-1).fill(0),totalRating:0})),_={course:a.course,group:a.group,faculty:a.faculty,subject:a.subject,students:w,columns:d.slice(1),maxScore:a.maxScore||100};n(_)};return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[s===1&&o(),s===2&&p(),s===3&&j()]})}function Tc(n){const t=[];t.push(`Электронный журнал - ${n.course} курс, ${n.group} группа`),t.push(`Факультет: ${n.faculty}`),t.push(`Предмет: ${n.subject}`),t.push(`Максимальный балл: ${n.maxScore}`),t.push(`Дата создания: ${new Date(n.createdAt).toLocaleDateString("ru-RU")}`),t.push(`Дата экспорта: ${new Date().toLocaleDateString("ru-RU")} ${new Date().toLocaleTimeString("ru-RU")}`),t.push("");const s=["№","ФИО студента",...n.columns,"Сумма баллов","Итоговый рейтинг (%)","Оценка"];return t.push(s.join(";")),n.students.forEach((r,a)=>{const i=r.scores.reduce((c,d)=>c+d,0),o=ga(r.totalRating),l=[(a+1).toString(),r.name,...r.scores.map(c=>c.toString()),i.toString(),r.totalRating.toFixed(2),o];t.push(l.join(";"))}),t.push(""),t.push("СТАТИСТИКА"),t.push(`Всего студентов;${n.students.length}`),t.push(`Отлично (≥80%);${n.students.filter(r=>r.totalRating>=80).length}`),t.push(`Хорошо (60-79%);${n.students.filter(r=>r.totalRating>=60&&r.totalRating<80).length}`),t.push(`Удовлетворительно (40-59%);${n.students.filter(r=>r.totalRating>=40&&r.totalRating<60).length}`),t.push(`Неудовлетворительно (<40%);${n.students.filter(r=>r.totalRating<40).length}`),t.push(`Средний балл;${xa(n.students).toFixed(2)}%`),t.join(`
`)}function ga(n){return n>=80?"Отлично":n>=60?"Хорошо":n>=40?"Удовлетворительно":"Неудовлетворительно"}function xa(n){return n.length===0?0:n.reduce((s,r)=>s+r.totalRating,0)/n.length}function pa(n){try{const r="\uFEFF"+Tc(n),a=new Blob([r],{type:"text/csv;charset=utf-8"}),i=document.createElement("a"),o=URL.createObjectURL(a);i.href=o;const l=n.subject.replace(/[/\\?%*:|"<>]/g,"-"),c=n.group.replace(/[/\\?%*:|"<>]/g,"-"),d=new Date().toLocaleDateString("ru-RU").replace(/\./g,"-"),u=`Журнал_${n.course}_курс_${c}_группа_${l}_${d}.csv`;i.download=u,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i),URL.revokeObjectURL(o)},100)}catch(t){throw console.error("Ошибка при экспорте журнала:",t),new Error("Не удалось экспортировать журнал")}}function va(n){return new Promise((t,s)=>{try{const r=Oc(n),a=new Blob([r],{type:"application/vnd.ms-excel;charset=utf-8"}),i=document.createElement("a"),o=URL.createObjectURL(a);i.href=o;const l=n.subject.replace(/[/\\?%*:|"<>]/g,"-"),c=n.group.replace(/[/\\?%*:|"<>]/g,"-"),d=new Date().toLocaleDateString("ru-RU").replace(/\./g,"-"),u=`Журнал_${n.course}_курс_${c}_группа_${l}_${d}.xls`;i.download=u,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i),URL.revokeObjectURL(o)},100),t()}catch(r){s(r)}})}function Oc(n){return`
<!DOCTYPE html>
<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel">
<head>
  <meta charset="UTF-8">
  <meta name="ProgId" content="Excel.Sheet">
  <meta name="Generator" content="Educational Portal">
  <style>
    body { font-family: Arial, sans-serif; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #000; padding: 5px; text-align: left; }
    th { background-color: #f0f0f0; font-weight: bold; }
    .header-info { margin-bottom: 20px; }
    .stats-table { margin-top: 30px; }
    .number-cell { text-align: center; }
    .rating-cell { text-align: center; font-weight: bold; }
    .excellent { color: #059669; }
    .good { color: #d97706; }
    .satisfactory { color: #0891b2; }
    .unsatisfactory { color: #dc2626; }
  </style>
</head>
<body>
  <div class="header-info">
    <h1>Электронный журнал - ${n.course} курс, ${n.group} группа</h1>
    <p><strong>Факультет:</strong> ${n.faculty}</p>
    <p><strong>Предмет:</strong> ${n.subject}</p>
    <p><strong>Максимальный балл:</strong> ${n.maxScore}</p>
    <p><strong>Дата создания:</strong> ${new Date(n.createdAt).toLocaleDateString("ru-RU")}</p>
    <p><strong>Дата экспорта:</strong> ${new Date().toLocaleDateString("ru-RU")} ${new Date().toLocaleTimeString("ru-RU")}</p>
  </div>

  <table>
    <thead>
      <tr>
        <th class="number-cell">№</th>
        <th>ФИО студента</th>
        ${n.columns.map(s=>`<th class="number-cell">${s}</th>`).join("")}
        <th class="number-cell">Сумма баллов</th>
        <th class="number-cell">Итоговый рейтинг (%)</th>
        <th>Оценка</th>
      </tr>
    </thead>
    <tbody>
      ${n.students.map((s,r)=>{const a=s.scores.reduce((l,c)=>l+c,0),i=ga(s.totalRating),o=$c(s.totalRating);return`
        <tr>
          <td class="number-cell">${r+1}</td>
          <td>${s.name}</td>
          ${s.scores.map(l=>`<td class="number-cell">${l}</td>`).join("")}
          <td class="number-cell">${a}</td>
          <td class="rating-cell ${o}">${s.totalRating.toFixed(2)}</td>
          <td class="${o}">${i}</td>
        </tr>`}).join("")}
    </tbody>
  </table>

  <div class="stats-table">
    <h2>Статистика</h2>
    <table style="width: 400px;">
      <tr><th>Показатель</th><th>Значение</th></tr>
      <tr><td>Всего студентов</td><td class="number-cell">${n.students.length}</td></tr>
      <tr><td>Отлично (≥80%)</td><td class="number-cell excellent">${n.students.filter(s=>s.totalRating>=80).length}</td></tr>
      <tr><td>Хорошо (60-79%)</td><td class="number-cell good">${n.students.filter(s=>s.totalRating>=60&&s.totalRating<80).length}</td></tr>
      <tr><td>Удовлетворительно (40-59%)</td><td class="number-cell satisfactory">${n.students.filter(s=>s.totalRating>=40&&s.totalRating<60).length}</td></tr>
      <tr><td>Неудовлетворительно (&lt;40%)</td><td class="number-cell unsatisfactory">${n.students.filter(s=>s.totalRating<40).length}</td></tr>
      <tr><td>Средний балл</td><td class="number-cell">${xa(n.students).toFixed(2)}%</td></tr>
    </table>
  </div>
</body>
</html>`}function $c(n){return n>=80?"excellent":n>=60?"good":n>=40?"satisfactory":"unsatisfactory"}function Rc({journal:n,onUpdate:t,onBack:s}){const[r,a]=y.useState(!1),[i,o]=y.useState({...n}),l=(f,w)=>{const _=f.reduce((N,C)=>N+C,0);return w>0?_/w*100:0},c=(f,w,_)=>{const N=[...i.students],C=parseFloat(_)||0;N[f].scores[w]=C,N[f].totalRating=l(N[f].scores,i.maxScore),o({...i,students:N})},d=(f,w)=>{const _=[...i.students];_[f].name=w,o({...i,students:_})},u=()=>{const f={name:"Новый студент",scores:new Array(i.columns.length).fill(0),totalRating:0};o({...i,students:[...i.students,f]})},m=f=>{const w=i.students.filter((_,N)=>N!==f);o({...i,students:w})},g=()=>{const f=`Новая колонка ${i.columns.length+1}`,w=[...i.columns,f],_=i.students.map(N=>({...N,scores:[...N.scores,0]}));o({...i,columns:w,students:_})},b=f=>{if(i.columns.length<=1)return;const w=i.columns.filter((N,C)=>C!==f),_=i.students.map(N=>({...N,scores:N.scores.filter((C,P)=>P!==f),totalRating:l(N.scores.filter((C,P)=>P!==f),i.maxScore)}));o({...i,columns:w,students:_})},x=(f,w)=>{const _=[...i.columns];_[f]=w,o({...i,columns:_})},h=f=>{const w=i.students.map(_=>({..._,totalRating:l(_.scores,f)}));o({...i,maxScore:f,students:w})},v=()=>{t(i),a(!1)},p=()=>{o({...n}),a(!1)},j=async()=>{try{await va(i),setTimeout(()=>{R.success("Журнал экспортирован - файл Excel успешно сохранен")},200)}catch{try{pa(i),setTimeout(()=>{R.success("Журнал экспортирован - файл CSV успешно сохранен (откроется в Excel)")},200)}catch(w){console.error("Ошибка экспорта:",w),R.error("Ошибка экспорта - не удалось экспортировать журнал")}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(k,{variant:"outline",onClick:s,children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Назад"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:[i.course," курс, ",i.group," группа"]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[i.faculty," • ",i.subject]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!r&&e.jsxs(k,{variant:"outline",onClick:j,children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Скачать Excel"]}),r?e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"outline",onClick:p,children:"Отмена"}),e.jsxs(k,{onClick:v,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Сохранить"]})]}):e.jsxs(k,{onClick:()=>a(!0),children:[e.jsx(ln,{className:"h-4 w-4 mr-2"}),"Редактировать"]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center justify-between",children:["Настройки журнала",e.jsxs(L,{variant:"secondary",children:["Максимальный балл: ",i.maxScore]})]})}),e.jsx(T,{children:r&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Максимальный балл"}),e.jsx(U,{type:"number",value:i.maxScore,onChange:f=>h(parseInt(f.target.value)||100)})]}),e.jsxs(k,{variant:"outline",onClick:u,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Добавить студента"]}),e.jsxs(k,{variant:"outline",onClick:g,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Добавить колонку"]})]})})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Журнал оценок"})}),e.jsxs(T,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"border p-3 bg-gray-50 dark:bg-gray-800 text-left",children:["ФИО",r&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Студентов: ",i.students.length]})]}),i.columns.map((f,w)=>e.jsx("th",{className:"border p-3 bg-gray-50 dark:bg-gray-800",children:r?e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{value:f,onChange:_=>x(w,_.target.value),className:"text-sm"}),i.columns.length>1&&e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>b(w),className:"w-full text-red-600",children:e.jsx(ke,{className:"h-3 w-3"})})]}):f},w)),e.jsx("th",{className:"border p-3 bg-gray-50 dark:bg-gray-800",children:"Итоговый рейтинг"}),r&&e.jsx("th",{className:"border p-3 bg-gray-50 dark:bg-gray-800 w-16",children:"Действия"})]})}),e.jsx("tbody",{children:i.students.map((f,w)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-3",children:r?e.jsx(U,{value:f.name,onChange:_=>d(w,_.target.value),className:"font-medium"}):e.jsx("span",{className:"font-medium",children:f.name})}),f.scores.map((_,N)=>e.jsx("td",{className:"border p-3 text-center",children:r?e.jsx(U,{type:"number",value:_,onChange:C=>c(w,N,C.target.value),className:"text-center",min:"0"}):_},N)),e.jsx("td",{className:"border p-3 text-center",children:e.jsx(L,{variant:f.totalRating>=80?"default":f.totalRating>=60?"secondary":"destructive",children:(f.totalRating/100).toFixed(2)})}),r&&e.jsx("td",{className:"border p-3 text-center",children:e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>m(w),className:"text-red-600",children:e.jsx(ke,{className:"h-3 w-3"})})})]},w))})]})}),i.students.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"Студенты не добавлены"}),r&&e.jsxs(k,{variant:"outline",onClick:u,className:"mt-2",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Добавить первого студента"]})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Статистика"})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:i.students.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Студентов"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:i.students.filter(f=>f.totalRating>=80).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Отлично (≥0.8)"})]}),e.jsxs("div",{className:"text-center p-4 bg-yellow-50 dark:bg-yellow-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:i.students.filter(f=>f.totalRating>=60&&f.totalRating<80).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Хорошо (0.6-0.79)"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 dark:bg-red-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:i.students.filter(f=>f.totalRating<60).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Неуд. (<0.6)"})]})]})})]})]})}function Pc(){const{user:n}=je(),[t,s]=y.useState([]),[r,a]=y.useState([]),[i,o]=y.useState(""),[l,c]=y.useState([]);if(y.useEffect(()=>{const h=()=>{try{if(!n?.username)return;const v=JSON.parse(localStorage.getItem("users")||"{}"),p=[];Object.values(v).forEach(_=>{if(_.role==="teacher")try{const N=JSON.parse(localStorage.getItem(`journals_${_.id}`)||"[]");Array.isArray(N)&&p.push(...N)}catch(N){console.warn(`Failed to load journals for teacher ${_.id}:`,N)}}),s(p);const j=n.username.toLowerCase(),f=[];for(const _ of p){if(!_.students||!Array.isArray(_.students))continue;const N=_.students.findIndex(C=>C.name&&C.name.toLowerCase().includes(j));if(N!==-1){const C=_.students[N],D=[..._.students].filter(ne=>ne&&typeof ne.totalRating=="number").sort((ne,ue)=>ue.totalRating-ne.totalRating).findIndex(ne=>ne.name===C.name)+1;f.push({journal:_,student:C,position:D||1})}}a(f);const w=[...new Set(f.map(_=>_.journal.course))].sort();c(w),n?.course&&w.includes(n.course)?o(n.course):w.length>1?o("all"):w.length>0&&o(w[0])}catch(v){console.error("Error loading student journals:",v),a([]),s([]),c([]),o("")}};n?.role==="student"&&n?.username?h():(a([]),s([]))},[n?.role,n?.username]),n?.role!=="student")return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400",children:"Доступ запрещен"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"Раздел просмотра оценок доступен только студентам"})]});const d=h=>{const v=h/100;return v>=.9?{grade:5,label:"Отлично"}:v>=.75?{grade:4,label:"Хорошо"}:v>=.6?{grade:3,label:"Удовлетворительно"}:{grade:2,label:"Неудовлетворительно"}},u=(h,v)=>{const p=h/v*100;return p<=20?"default":p<=50?"secondary":"outline"},m=h=>r.filter(v=>v.journal.course===h),g=h=>{const v=m(h);return v.length===0?0:v.reduce((p,j)=>p+j.student.totalRating,0)/v.length},b=h=>{const v=m(h);return v.length===0?0:Math.max(...v.map(p=>p.student.totalRating))},x=()=>{if(!i)return{averageGrade:0,bestResult:0,subjectsCount:0};if(i==="all"){const v=r.length>0?r.reduce((j,f)=>j+f.student.totalRating,0)/r.length:0,p=r.length>0?Math.max(...r.map(j=>j.student.totalRating)):0;return{averageGrade:v,bestResult:p,subjectsCount:r.length}}const h=m(i);return{averageGrade:g(i),bestResult:b(i),subjectsCount:h.length}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Мои оценки"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Просмотр успеваемости и рейтинга по предметам"})]}),r.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Статистика по курсу:"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Z,{value:i,onValueChange:o,children:[e.jsx(Q,{className:"w-32",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"За все время"}),l.map(h=>e.jsxs(E,{value:h,children:[h," курс"]},h))]})]})})]})]}),r.length===0?e.jsx(I,{children:e.jsxs(T,{className:"py-12 text-center",children:[e.jsx(ge,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Оценки не найдены"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"Возможно, преподаватели еще не создали журналы или не добавили ваше имя в списки"})]})}):e.jsxs(Oe,{defaultValue:"overview",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-2",children:[e.jsx(H,{value:"overview",children:"Обзор"}),e.jsx(H,{value:"detailed",children:"Подробно"})]}),e.jsxs(G,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(I,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Предметов"]})}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x().subjectsCount}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:i==="all"?"За все время":`${i} курс`})]})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(tn,{className:"h-4 w-4"}),"Средний балл"]})}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(x().averageGrade/100).toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:i==="all"?`За все время (${x().subjectsCount} предмет${x().subjectsCount===1?"":x().subjectsCount<5?"а":"ов"})`:`${i} курс (${x().subjectsCount} предмет${x().subjectsCount===1?"":x().subjectsCount<5?"а":"ов"})`})]})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Zs,{className:"h-4 w-4"}),"Лучший результат"]})}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(x().bestResult/100).toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:i==="all"?"За все время":`${i} курс`})]})]}),e.jsxs(I,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(kt,{className:"h-4 w-4"}),"Последнее обновление"]})}),e.jsx(T,{children:e.jsx("div",{className:"text-sm font-bold",children:r.length>0?new Date(Math.max(...r.map(h=>new Date(h.journal.createdAt).getTime()))).toLocaleDateString():"Нет данных"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[n?.course&&m(n.course).length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Мой курс (",n.course," курс)"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m(n.course).map((h,v)=>{const p=d(h.student.totalRating);return e.jsxs(I,{className:"border-primary/20",children:[e.jsxs(O,{children:[e.jsxs($,{className:"flex items-center justify-between",children:[h.journal.subject,e.jsxs(L,{variant:u(h.position,h.journal.students.length),children:["#",h.position," из ",h.journal.students.length]})]}),e.jsxs(de,{children:[h.journal.course," курс • ",h.journal.group," группа"]})]}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Успеваемость:"}),e.jsx("span",{className:"font-semibold",children:(h.student.totalRating/100).toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Оценка:"}),e.jsxs(L,{variant:p.grade>=4?"default":"destructive",children:[p.grade," (",p.label,")"]})]})]})})]},`current-${v}`)})})]}),l.filter(h=>h!==n?.course).map(h=>{const v=m(h);return v.length===0?null:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),h," курс"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:v.map((p,j)=>{const f=d(p.student.totalRating);return e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsxs($,{className:"flex items-center justify-between",children:[p.journal.subject,e.jsxs(L,{variant:u(p.position,p.journal.students.length),children:["#",p.position," из ",p.journal.students.length]})]}),e.jsxs(de,{children:[p.journal.course," курс • ",p.journal.group," группа"]})]}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Успеваемость:"}),e.jsx("span",{className:"font-semibold",children:(p.student.totalRating/100).toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Оценка:"}),e.jsxs(L,{variant:f.grade>=4?"default":"destructive",children:[f.grade," (",f.label,")"]})]})]})})]},`other-${h}-${j}`)})})]},h)})]})]}),e.jsx(G,{value:"detailed",className:"space-y-6",children:r.map((h,v)=>e.jsxs(I,{children:[e.jsxs(O,{children:[e.jsxs($,{className:"flex items-center justify-between",children:[h.journal.subject,e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{variant:"outline",children:[h.journal.course," курс"]}),e.jsxs(L,{variant:u(h.position,h.journal.students.length),children:["#",h.position," место"]})]})]}),e.jsxs(de,{children:[h.journal.faculty," • ",h.journal.group," группа"]})]}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Детальные оценки:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[h.journal.columns.map((p,j)=>e.jsx("th",{className:"border p-2 bg-gray-50 dark:bg-gray-800 text-left",children:p},j)),e.jsx("th",{className:"border p-2 bg-gray-50 dark:bg-gray-800 text-left",children:"Итого"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[h.student.scores.map((p,j)=>e.jsx("td",{className:"border p-2",children:e.jsx(L,{variant:p>0?"default":"outline",children:p})},j)),e.jsx("td",{className:"border p-2",children:e.jsx(L,{variant:"default",className:"text-lg",children:(h.student.totalRating/100).toFixed(2)})})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Максимум:"}),e.jsx("p",{className:"font-semibold",children:h.journal.maxScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Набрано:"}),e.jsx("p",{className:"font-semibold",children:h.student.scores.reduce((p,j)=>p+j,0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Успеваемость:"}),e.jsx("p",{className:"font-semibold",children:(h.student.totalRating/100).toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Оценка:"}),e.jsx("p",{className:"font-semibold",children:d(h.student.totalRating).grade})]})]})]})})]},v))})]})]})}function Uc(){const{user:n}=je(),[t,s]=y.useState(!1),[r,a]=y.useState(null),[i,o]=y.useState(()=>{const g=localStorage.getItem(`journals_${n?.id}`);return g?JSON.parse(g):[]}),l=g=>{o(g),localStorage.setItem(`journals_${n?.id}`,JSON.stringify(g))},c=g=>{const b={...g,id:Date.now().toString(),createdAt:new Date().toISOString()},x=[...i,b];l(x),s(!1)},d=g=>{const b=i.map(x=>x.id===g.id?g:x);l(b),a(g)},u=g=>{const b=i.filter(x=>x.id!==g);l(b),r?.id===g&&a(null)},m=async g=>{try{await va(g),setTimeout(()=>{R.success("Журнал экспортирован - файл Excel успешно сохранен")},200)}catch{try{pa(g),setTimeout(()=>{R.success("Журнал экспортирован - файл CSV успешно сохранен (откроется в Excel)")},200)}catch(x){console.error("Ошибка экспорта:",x),R.error("Ошибка экспорта - не удалось экспортировать журнал")}}};return n?.role==="student"?e.jsx(Pc,{}):n?.role!=="teacher"?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400",children:"Доступ запрещен"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"Раздел журнала доступен только преподавателям и студентам"})]}):t?e.jsx(Ic,{onComplete:c,onCancel:()=>s(!1)}):r?e.jsx(Rc,{journal:r,onUpdate:d,onBack:()=>a(null)}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl mb-4",children:"Журнал оценок"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Управляйте успеваемостью студентов, создавайте и редактируйте журналы оценок"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl",children:"Мои журналы"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Всего журналов: ",i.length]})]}),e.jsxs(k,{onClick:()=>s(!0),className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Создать журнал"]})]}),i.length===0?e.jsx(I,{children:e.jsxs(T,{className:"py-12 text-center",children:[e.jsx(ge,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Журналы не созданы"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500 mb-4",children:"Создайте первый журнал для начала работы с оценками студентов"}),e.jsxs(k,{onClick:()=>s(!0),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Создать первый журнал"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(g=>e.jsxs(I,{className:"hover:shadow-md transition-shadow",children:[e.jsxs(O,{children:[e.jsxs($,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[g.course," курс"]}),e.jsxs(L,{variant:"outline",children:[g.group," группа"]})]}),e.jsxs(de,{children:[g.faculty," • ",g.subject]})]}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:["Студентов: ",g.students.length]}),e.jsxs("p",{children:["Максимальный балл: ",g.maxScore]}),e.jsxs("p",{children:["Создан: ",new Date(g.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>a(g),children:[e.jsx(ln,{className:"h-4 w-4 mr-2"}),"Открыть"]}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>m(g),title:"Быстро скачать Excel",children:e.jsx(Tt,{className:"h-4 w-4"})}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>u(g.id),className:"text-red-600 hover:text-red-700",children:e.jsx(ke,{className:"h-4 w-4"})})]})]})})]},g.id))})]})}function Dc({onViewFile:n}){const{user:t}=je();y.useRef(null);const s=t?.course||"1",r=()=>{const d=JSON.parse(localStorage.getItem("groupFiles")||"[]"),u=JSON.parse(localStorage.getItem("fileContents")||"[]"),m=JSON.parse(localStorage.getItem("admin_files")||"[]"),g=d.filter(p=>p.groupId===s).map(p=>{const f=u.find(w=>w.id===p.id)?.content||"";return{id:p.id,name:p.name,content:f,uploadedAt:p.uploadDate,sharedWith:"all",sharedBy:"Преподаватель",type:p.type,description:p.description}}),b=t?.faculty||"medical",x=m.filter(p=>p.course===s&&p.faculty===b).map(p=>({id:p.id,name:p.name,content:p.content,uploadedAt:p.uploadedAt,sharedWith:"all",sharedBy:"Администратор",type:p.type,description:p.description})),h=localStorage.getItem(`course${s}_shared_files`),v=h?JSON.parse(h):[];l([...v,...g,...x])},[a,i]=y.useState(()=>{const d=localStorage.getItem(`course${s}_files_${t?.id}`);return d?JSON.parse(d):[{id:"example-1",name:"Пример урока - Биохимия.md",content:`# Биохимия: Основы метаболизма

## Введение в биохимические процессы

Биохимия изучает химические процессы, происходящие в живых организмах. Одним из ключевых понятий является [[#метаболизм]], который включает в себя множество сложных реакций.

> [!note] Важно помнить
> Метаболизм состоит из двух основных процессов: катаболизма и анаболизма.

## Метаболизм

**Метаболизм** — это совокупность всех химических реакций, происходящих в клетке. Он включает:

- **Катаболизм** — процессы расщепления сложных веществ
- **Анаболизм** — процессы синтеза сложных веществ

### Ферментативные реакции

Большинство биохимических реакций катализируются [[#ферментами]]. Эти белковые молекулы значительно ускоряют химические реакции без изменения их равновесия.

Более подробно о [[#классификации ферментов]] вы можете узнать в следующем разделе.

## Ферменты

Ферменты — это биологические катализаторы, которые состоят из белков. Они обладают следующими свойствами:

1. **Специфичность** — каждый фермент катализирует определенную реакцию
2. **Активность** — зависит от температуры и pH среды
3. **Регуляция** — активность может быть изменена различными факторами

### Классификация ферментов

Ферменты классифицируются на основе типа катализируемых реакций:

| Класс | Название | Функция |
|-------|----------|---------|
| 1 | Оксидоредуктазы | Окислительно-восстановительные реакции |
| 2 | Трансферазы | Перенос функциональных групп |
| 3 | Гидролазы | Гидролитическое расщепление |

### Механизм действия

Фермент связывается с субстратом, образуя фермент-субстратный комплекс. Для понимания этого процесса важно изучить [[#структуру активного центра]].

## Структура активного центра

Активный центр фермента — это специфическая область молекулы, где происходит связывание субстрата и катализ реакции.

> [!tip] Модель "ключ-замок"
> Эмиль Фишер предложил модель, согласно которой субстрат (ключ) точно подходит к активному центру фермента (замку).

## Заключение

Понимание основ [[#метаболизма]] и работы [[#ферментов]] является фундаментальным для изучения биохимии.

---

*Попробуйте кликнуть на выделенные ссылки вида [[#метаболизм]] для навигации по документу!*`,uploadedAt:new Date().toISOString(),sharedWith:"none"}]}),[o,l]=y.useState(()=>{const d=localStorage.getItem(`course${s}_shared_files`),u=JSON.parse(localStorage.getItem("groupFiles")||"[]"),m=JSON.parse(localStorage.getItem("fileContents")||"[]"),g=JSON.parse(localStorage.getItem("admin_files")||"[]"),b=u.filter(p=>p.groupId===s).map(p=>{const f=m.find(w=>w.id===p.id)?.content||"";return(f.includes("<!DOCTYPE")||f.includes("<html>")||f.includes("<script>"))&&console.warn(`Файл ${p.name} содержит HTML/JS код вместо учебного материала`),{id:p.id,name:p.name,content:f,uploadedAt:p.uploadDate,sharedWith:"all",sharedBy:"Преподаватель",type:p.type,description:p.description}}),x=t?.faculty||"medical",h=g.filter(p=>p.course===s&&p.faculty===x).map(p=>({id:p.id,name:p.name,content:p.content,uploadedAt:p.uploadedAt,sharedWith:"all",sharedBy:"Администратор",type:p.type,description:p.description}));return[...d?JSON.parse(d):[],...b,...h]});y.useEffect(()=>{const d=setInterval(()=>{r()},5e3);return()=>clearInterval(d)},[s,t?.faculty]);const c=[...a.map(d=>({...d,isOwn:!0})),...o.filter(d=>!a.some(u=>u.name===d.name)).map(d=>({...d,isOwn:!1}))];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("h1",{className:"text-3xl md:text-4xl mb-4",children:[s," курс - Учебные материалы"]}),e.jsxs("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:["Изучайте предметы ",s," курса и работайте с материалами"]})]}),e.jsxs(Oe,{defaultValue:"materials",className:"w-full",children:[e.jsx($e,{className:"grid w-full grid-cols-1",children:e.jsx(H,{value:"materials",children:"Материалы"})}),e.jsx(G,{value:"materials",className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl",children:"Учебные материалы"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{variant:"outline",onClick:r,title:"Обновить список файлов",children:[e.jsx(Ws,{className:"h-4 w-4 mr-2"}),"Обновить"]})})]}),c.length===0?e.jsx(I,{children:e.jsxs(T,{className:"py-12 text-center",children:[e.jsx(ve,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg text-gray-600 dark:text-gray-400 mb-2",children:"Материалы не найдены"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500 mb-4",children:"Материалы для вашего курса и факультета пока не загружены администратором"})]})}):e.jsx("div",{className:"grid gap-4",children:c.map(d=>e.jsx(I,{children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{children:d.name}),d.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:d.description}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d.sharedBy&&e.jsx(L,{variant:"secondary",className:"text-xs",children:d.sharedBy}),d.type&&e.jsx(L,{variant:"outline",className:"text-xs",children:d.type==="lesson"?"Урок":d.type==="assignment"?"Задание":"Материал"}),d.isOwn&&d.sharedWith==="all"&&e.jsx(L,{variant:"outline",className:"text-xs",children:"Общий доступ"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(d.uploadedAt).toLocaleDateString()})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(k,{size:"sm",variant:"default",onClick:()=>n?.({...d,isOwn:d.isOwn}),children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Просмотр"]})})]})})},d.id))})]})})]})]})}function Lc(){const{user:n}=je(),t=y.useRef(null),[s,r]=y.useState(!1),[a,i]=y.useState(null),[o,l]=y.useState({name:"",content:"",course:"",faculty:"",description:"",type:"lesson",fileType:""}),[c,d]=y.useState(()=>{const p=localStorage.getItem("admin_files");return p?JSON.parse(p):[]}),u=p=>{d(p),localStorage.setItem("admin_files",JSON.stringify(p)),m(p)},m=p=>{p.forEach(j=>{const f=JSON.parse(localStorage.getItem("groupFiles")||"[]"),w=JSON.parse(localStorage.getItem("fileContents")||"[]"),_=f.findIndex(D=>D.id===j.id),N={id:j.id,name:j.name,groupId:j.course,faculty:j.faculty,uploadDate:j.uploadedAt,type:j.type,description:j.description,fileType:j.fileType};_>=0?f[_]=N:f.push(N);const C=w.findIndex(D=>D.id===j.id),P={id:j.id,content:j.content,fileType:j.fileType};C>=0?w[C]=P:w.push(P),localStorage.setItem("groupFiles",JSON.stringify(f)),localStorage.setItem("fileContents",JSON.stringify(w))}),window.dispatchEvent(new CustomEvent("adminFilesUpdated"))},g=p=>{const j=p.target.files?.[0];if(j){const f=new FileReader;f.onload=w=>{const _=w.target?.result;l(N=>({...N,name:j.name,content:_,fileType:j.type||"application/octet-stream"}))},j.name.endsWith(".md")||j.name.endsWith(".txt")?f.readAsText(j):f.readAsDataURL(j)}},b=()=>{if(!o.name||!o.content||!o.course||!o.faculty){alert("Заполните все обязательные поля");return}const p={id:Date.now().toString(),name:o.name,content:o.content,course:o.course,faculty:o.faculty,description:o.description,type:o.type,fileType:o.fileType,uploadedAt:new Date().toISOString()};u([...c,p]),l({name:"",content:"",course:"",faculty:"",description:"",type:"lesson",fileType:""}),r(!1),alert("Файл успешно добавлен и стал доступен студентам!")},x=p=>{if(confirm("Вы уверены, что хотите удалить этот файл?")){const j=c.filter(C=>C.id!==p);u(j);const f=JSON.parse(localStorage.getItem("groupFiles")||"[]"),w=JSON.parse(localStorage.getItem("fileContents")||"[]"),_=f.filter(C=>C.id!==p),N=w.filter(C=>C.id!==p);localStorage.setItem("groupFiles",JSON.stringify(_)),localStorage.setItem("fileContents",JSON.stringify(N)),alert("Файл удален")}},h=p=>{i(p),l({name:p.name,content:p.content,course:p.course,faculty:p.faculty,description:p.description||"",type:p.type,fileType:p.fileType||""}),r(!0)},v=()=>{if(!a||!o.name||!o.content||!o.course||!o.faculty){alert("Заполните все обязательные поля");return}const p={...a,name:o.name,content:o.content,course:o.course,faculty:o.faculty,description:o.description,type:o.type,fileType:o.fileType},j=c.map(f=>f.id===a.id?p:f);u(j),i(null),l({name:"",content:"",course:"",faculty:"",description:"",type:"lesson",fileType:""}),r(!1),alert("Файл успешно обновлен!")};return n?.role!=="admin"?null:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Управление файлами для студентов"}),e.jsxs(k,{onClick:()=>r(!0),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Добавить файл"]})]}),s&&e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:a?"Редактировать файл":"Добавить новый файл"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Название файла *"}),e.jsx(U,{value:o.name,onChange:p=>l(j=>({...j,name:p.target.value})),placeholder:"Введите название файла"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Тип материала *"}),e.jsxs(Z,{value:o.type,onValueChange:p=>l(j=>({...j,type:p})),children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"lesson",children:"Урок"}),e.jsx(E,{value:"assignment",children:"Задание"}),e.jsx(E,{value:"material",children:"Материал"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Курс *"}),e.jsxs(Z,{value:o.course,onValueChange:p=>l(j=>({...j,course:p})),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Выберите курс"})}),e.jsxs(te,{children:[e.jsx(E,{value:"1",children:"1 курс"}),e.jsx(E,{value:"2",children:"2 курс"}),e.jsx(E,{value:"3",children:"3 курс"}),e.jsx(E,{value:"4",children:"4 курс"}),e.jsx(E,{value:"5",children:"5 курс"}),e.jsx(E,{value:"6",children:"6 курс"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Факультет *"}),e.jsxs(Z,{value:o.faculty,onValueChange:p=>l(j=>({...j,faculty:p})),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Выберите факультет"})}),e.jsxs(te,{children:[e.jsx(E,{value:"medical",children:"Лечебный"}),e.jsx(E,{value:"pediatric",children:"Педиатрический"}),e.jsx(E,{value:"dental",children:"Стоматологический"}),e.jsx(E,{value:"pharmacy",children:"Фармацевтический"}),e.jsx(E,{value:"preventive",children:"Медико-профилактический"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Описание"}),e.jsx(U,{value:o.description,onChange:p=>l(j=>({...j,description:p.target.value})),placeholder:"Краткое описание файла"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Содержимое файла *"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"file",ref:t,onChange:g,style:{display:"none"}}),e.jsxs(k,{variant:"outline",onClick:()=>t.current?.click(),children:[e.jsx(cn,{className:"h-4 w-4 mr-2"}),"Загрузить файл"]})]}),e.jsx(Se,{value:o.content,onChange:p=>l(j=>({...j,content:p.target.value})),placeholder:"Введите содержимое в формате Markdown или загрузите файл любого формата",rows:8,className:"font-mono text-sm"})]}),e.jsxs(xe,{children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx(pe,{children:"Файл будет доступен всем студентам выбранного курса и факультета. Поддерживаются любые форматы файлов (PDF, DOCX, XLSX, изображения, видео и т.д.). Для Markdown файлов доступны внутренние ссылки [[#заголовок]]."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:a?v:b,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),a?"Обновить":"Добавить"]}),e.jsx(k,{variant:"outline",onClick:()=>{r(!1),i(null),l({name:"",content:"",course:"",faculty:"",description:"",type:"lesson",fileType:""})},children:"Отмена"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium",children:["Добавленные файлы (",c.length,")"]}),c.length===0?e.jsx(I,{children:e.jsxs(T,{className:"py-12 text-center",children:[e.jsx(ve,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg text-gray-600 dark:text-gray-400 mb-2",children:"Файлы не добавлены"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500 mb-4",children:"Добавьте первый файл для студентов"}),e.jsxs(k,{onClick:()=>r(!0),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Добавить файл"]})]})}):e.jsx("div",{className:"grid gap-4",children:c.map(p=>e.jsx(I,{children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-medium",children:p.name}),p.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:p.description}),e.jsxs("div",{className:"flex items-center space-x-2 flex-wrap gap-1",children:[e.jsxs(L,{variant:"default",className:"text-xs",children:[p.course," курс"]}),e.jsx(L,{variant:"secondary",className:"text-xs",children:p.faculty==="medical"?"Лечебный":p.faculty==="pediatric"?"Педиатрический":p.faculty==="dental"?"Стоматологический":p.faculty==="pharmacy"?"Фармацевтический":p.faculty==="preventive"?"Медико-профилактический":p.faculty}),e.jsx(L,{variant:"outline",className:"text-xs",children:p.type==="lesson"?"Урок":p.type==="assignment"?"Задание":"Материал"}),p.fileType&&e.jsx(L,{variant:"outline",className:"text-xs",children:p.name.split(".").pop()?.toUpperCase()||"Файл"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Добавлен: ",new Date(p.uploadedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>h(p),children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Редактировать"]}),e.jsx(k,{size:"sm",variant:"ghost",onClick:()=>x(p.id),className:"text-red-600 hover:text-red-700",children:e.jsx(ke,{className:"h-4 w-4"})})]})]})})},p.id))})]})]})}function Hr({className:n,...t}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:q("w-full caption-bottom text-sm",n),...t})})}function Gr({className:n,...t}){return e.jsx("thead",{"data-slot":"table-header",className:q("[&_tr]:border-b",n),...t})}function Kr({className:n,...t}){return e.jsx("tbody",{"data-slot":"table-body",className:q("[&_tr:last-child]:border-0",n),...t})}function qt({className:n,...t}){return e.jsx("tr",{"data-slot":"table-row",className:q("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",n),...t})}function Ee({className:n,...t}){return e.jsx("th",{"data-slot":"table-head",className:q("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",n),...t})}function Ae({className:n,...t}){return e.jsx("td",{"data-slot":"table-cell",className:q("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",n),...t})}function Fc({className:n,checked:t=!1,onCheckedChange:s,onChange:r,...a}){const i=!!t,o=l=>{const c=l.target.checked;s?.(c),r?.(l)};return e.jsxs("div",{className:"relative inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:o,className:"sr-only peer",...a}),e.jsx("div",{className:q("peer w-4 h-4 shrink-0 rounded-[4px] border shadow-sm transition-all cursor-pointer","flex items-center justify-center","peer-focus-visible:ring-2 peer-focus-visible:ring-ring peer-focus-visible:ring-offset-2","peer-disabled:cursor-not-allowed peer-disabled:opacity-50",!i&&["border-primary bg-input-background dark:bg-input/30","hover:border-primary/70"],i&&["bg-primary border-primary","hover:bg-primary/90"],n),onClick:l=>{const c=l.currentTarget.previousElementSibling;c&&c.type==="checkbox"&&c.click()},children:e.jsx(Sa,{className:q("w-3 h-3 transition-all duration-200",i?"opacity-100 scale-100 text-primary-foreground":"opacity-0 scale-75",!i&&"text-transparent")})})]})}const Yr=[{value:"Trophy",label:"Трофей",icon:be},{value:"Star",label:"Звезда",icon:es},{value:"Medal",label:"Медаль",icon:Ys},{value:"Award",label:"Награда",icon:Zs},{value:"Target",label:"Цель",icon:Xs},{value:"Crown",label:"Корона",icon:sn},{value:"Flame",label:"Пламя",icon:rn},{value:"Zap",label:"Молния",icon:nn},{value:"BookOpen",label:"Книга",icon:ge},{value:"GraduationCap",label:"Шапочка",icon:Ct}],Xr=[{value:"default",label:"Стандартный",class:""},{value:"primary",label:"Основной",class:"bg-primary text-primary-foreground"},{value:"secondary",label:"Вторичный",class:"bg-secondary text-secondary-foreground"},{value:"success",label:"Успех",class:"bg-green-500 text-white"},{value:"warning",label:"Предупреждение",class:"bg-yellow-500 text-white"},{value:"danger",label:"Опасность",class:"bg-red-500 text-white"},{value:"info",label:"Информация",class:"bg-blue-500 text-white"}];function Mc(){const[n,t]=y.useState([]),[s,r]=y.useState([]),[a,i]=y.useState(null),[o,l]=y.useState(!1),[c,d]=y.useState("achievements"),[u,m]=y.useState("all"),[g,b]=y.useState({}),x=y.useRef(null),[h,v]=y.useState({title:"",description:"",icon:"Trophy",color:"primary",course:"all",criteria:"",points:10,isActive:!0});y.useEffect(()=>{p(),j(),f()},[]),y.useEffect(()=>{if(o&&x.current){const S=setTimeout(()=>{x.current?.focus()},150);return()=>clearTimeout(S)}},[o]);const p=()=>{try{const S=localStorage.getItem("achievements");S&&t(JSON.parse(S))}catch(S){console.error("Error loading achievements:",S)}},j=()=>{try{const S=localStorage.getItem("studentAchievements");S&&r(JSON.parse(S))}catch(S){console.error("Error loading student achievements:",S)}},f=()=>{try{const S=localStorage.getItem("users");S&&b(JSON.parse(S))}catch(S){console.error("Error loading users:",S)}},w=S=>{try{localStorage.setItem("achievements",JSON.stringify(S)),t(S)}catch(F){console.error("Error saving achievements:",F),R.error("Ошибка при сохранении достижений")}},_=S=>{try{localStorage.setItem("studentAchievements",JSON.stringify(S)),r(S)}catch(F){console.error("Error saving student achievements:",F),R.error("Ошибка при сохранении достижений студентов")}},N=()=>h.title?.trim()?h.description?.trim()?h.points<0||h.points>100?(R.error("Баллы должны быть от 0 до 100"),!1):!0:(R.error("Введите описание достижения"),!1):(R.error("Введите название достижения"),!1),C=()=>{try{if(!N())return;const S={id:Date.now().toString(),title:h.title.trim(),description:h.description.trim(),icon:h.icon,color:h.color,course:h.course,criteria:h.criteria.trim(),points:Number(h.points),isActive:h.isActive,dateCreated:new Date().toISOString()},F=[...n,S];w(F),Ue(),R.success("Достижение успешно создано!")}catch(S){console.error("Error creating achievement:",S),R.error("Ошибка при создании достижения")}},P=()=>{try{if(!a||!N())return;const S=n.map(F=>F.id===a.id?{...F,title:h.title.trim(),description:h.description.trim(),icon:h.icon,color:h.color,course:h.course,criteria:h.criteria.trim(),points:Number(h.points),isActive:h.isActive}:F);w(S),Ue(),R.success("Достижение успешно обновлено!")}catch(S){console.error("Error updating achievement:",S),R.error("Ошибка при обновлении достижения")}},D=S=>{if(confirm("Вы уверены, что хотите удалить это достижение? Это действие нельзя отменить."))try{const F=n.filter(K=>K.id!==S);w(F);const B=s.filter(K=>K.achievementId!==S);_(B),R.success("Достижение удалено!")}catch(F){console.error("Error deleting achievement:",F),R.error("Ошибка при удалении достижения")}},ne=()=>{v({title:"",description:"",icon:"Trophy",color:"primary",course:"all",criteria:"",points:10,isActive:!0})},ue=S=>{i(S),v({title:S.title,description:S.description,icon:S.icon,color:S.color,course:S.course,criteria:S.criteria,points:S.points,isActive:S.isActive}),l(!0)},qe=()=>{i(null),ne(),l(!0)},Ue=()=>{l(!1),setTimeout(()=>{i(null),ne()},150)},gt=S=>{const F=Yr.find(B=>B.value===S);return F?F.icon:be},xt=S=>{const F=Xr.find(B=>B.value===S);return F?F.class:""},ae=n.filter(S=>u==="all"||S.course===u||S.course==="all"),Y=()=>Object.values(g).filter(S=>S.role==="student"),se=S=>s.filter(F=>F.studentId===S).map(F=>{const B=n.find(K=>K.id===F.achievementId);return{...F,achievement:B}}).filter(F=>F.achievement),oe=(S,F)=>{try{if(s.find(pt=>pt.studentId===S&&pt.achievementId===F)){R.error("У студента уже есть это достижение");return}const K={studentId:S,achievementId:F,dateEarned:new Date().toISOString()},Ze=[...s,K];_(Ze),R.success("Достижение присвоено студенту!")}catch(B){console.error("Error awarding achievement:",B),R.error("Ошибка при присвоении достижения")}},W=(S,F)=>{try{const B=s.filter(K=>!(K.studentId===S&&K.achievementId===F));_(B),R.success("Достижение отозвано у студента!")}catch(B){console.error("Error removing student achievement:",B),R.error("Ошибка при отзыве достижения")}},V=h.title.trim()&&h.description.trim()&&h.points>=0&&h.points<=100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl mb-2",children:"Управление достижениями"}),e.jsx("p",{className:"text-muted-foreground",children:"Создавайте и управляйте достижениями для студентов"})]}),e.jsxs(Oe,{value:c,onValueChange:d,className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-2",children:[e.jsx(H,{value:"achievements",children:"Достижения"}),e.jsx(H,{value:"students",children:"Студенты"})]}),e.jsx(G,{value:"achievements",className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Список достижений"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsxs(Z,{value:u,onValueChange:m,children:[e.jsx(Q,{className:"w-full sm:w-40",children:e.jsx(ee,{placeholder:"Курс"})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Все курсы"}),e.jsx(E,{value:"1",children:"1 курс"}),e.jsx(E,{value:"2",children:"2 курс"}),e.jsx(E,{value:"3",children:"3 курс"}),e.jsx(E,{value:"4",children:"4 курс"}),e.jsx(E,{value:"5",children:"5 курс"}),e.jsx(E,{value:"6",children:"6 курс"})]})]}),e.jsxs(k,{onClick:qe,className:"w-full sm:w-auto",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Создать достижение"]})]})]})}),e.jsx(T,{children:ae.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(be,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"Нет достижений для отображения"}),e.jsx("p",{className:"text-sm",children:"Создайте первое достижение для студентов"})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx(Xt,{className:"h-[600px]",children:e.jsxs(Hr,{children:[e.jsx(Gr,{children:e.jsxs(qt,{children:[e.jsx(Ee,{className:"min-w-[250px]",children:"Достижение"}),e.jsx(Ee,{className:"min-w-[200px]",children:"Описание"}),e.jsx(Ee,{className:"w-[100px]",children:"Статус"}),e.jsx(Ee,{className:"w-[100px]",children:"Курс"}),e.jsx(Ee,{className:"w-[80px]",children:"Баллы"}),e.jsx(Ee,{className:"w-[120px]",children:"Действия"})]})}),e.jsx(Kr,{children:ae.map(S=>{const F=gt(S.icon);return e.jsxs(qt,{children:[e.jsx(Ae,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${xt(S.color)}`,children:e.jsx(F,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium truncate",children:S.title}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Создано: ",new Date(S.dateCreated).toLocaleDateString("ru-RU")]})]})]})}),e.jsx(Ae,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm line-clamp-2",children:S.description}),S.criteria&&e.jsxs("p",{className:"text-xs text-muted-foreground line-clamp-1",children:["Критерии: ",S.criteria]})]})}),e.jsx(Ae,{children:e.jsx(L,{variant:S.isActive?"default":"secondary",children:S.isActive?"Активно":"Неактивно"})}),e.jsx(Ae,{children:e.jsx(L,{variant:"outline",children:S.course==="all"?"Все":`${S.course} к.`})}),e.jsx(Ae,{children:e.jsx(L,{variant:"outline",className:"font-mono",children:S.points})}),e.jsx(Ae,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>ue(S),title:"Редактировать",children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>D(S.id),title:"Удалить",className:"text-destructive hover:text-destructive",children:e.jsx(ke,{className:"h-4 w-4"})})]})})]},S.id)})})]})})})})]})}),e.jsx(G,{value:"students",className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5"}),"Достижения студентов"]})}),e.jsx(T,{children:e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx(Xt,{className:"h-[600px]",children:e.jsxs(Hr,{children:[e.jsx(Gr,{children:e.jsxs(qt,{children:[e.jsx(Ee,{className:"min-w-[150px]",children:"Студент"}),e.jsx(Ee,{className:"w-[100px]",children:"Курс"}),e.jsx(Ee,{className:"min-w-[300px]",children:"Достижения"}),e.jsx(Ee,{className:"min-w-[200px]",children:"Действия"})]})}),e.jsx(Kr,{children:Y().map(S=>{const F=se(S.username);return e.jsxs(qt,{children:[e.jsx(Ae,{className:"font-medium",children:S.username}),e.jsx(Ae,{children:e.jsxs(L,{variant:"outline",children:[S.course," курс"]})}),e.jsx(Ae,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Получено: ",F.length]}),F.length>0?e.jsx("div",{className:"flex flex-wrap gap-1 max-w-lg",children:F.map(B=>{const K=gt(B.achievement.icon);return e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-muted rounded text-xs group",title:`${B.achievement.title}: ${B.achievement.description}`,children:[e.jsx("div",{className:`p-0.5 rounded ${xt(B.achievement.color)}`,children:e.jsx(K,{className:"h-3 w-3"})}),e.jsx("span",{className:"max-w-20 truncate",children:B.achievement.title}),e.jsx(k,{variant:"ghost",size:"sm",className:"h-auto p-0.5 opacity-0 group-hover:opacity-100 transition-opacity text-destructive hover:text-destructive",onClick:()=>W(S.username,B.achievementId),title:"Удалить достижение",children:e.jsx(Ke,{className:"h-3 w-3"})})]},B.achievementId)})}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Нет достижений"})]})}),e.jsx(Ae,{children:e.jsxs(Z,{onValueChange:B=>oe(S.username,B),children:[e.jsx(Q,{className:"w-full",children:e.jsx(ee,{placeholder:"Присвоить достижение"})}),e.jsx(te,{children:n.filter(B=>B.isActive&&(B.course==="all"||B.course===S.course)&&!F.some(K=>K.achievementId===B.id)).map(B=>{const K=gt(B.icon);return e.jsx(E,{value:B.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:B.title})]})},B.id)})})]})})]},S.username)})})]})})})})]})})]}),o&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"relative z-50 w-full max-w-2xl bg-background p-6 shadow-lg rounded-lg border max-h-[90vh] overflow-y-auto",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a?"Редактировать достижение":"Создать достижение"}),e.jsx(k,{variant:"ghost",size:"sm",onClick:Ue,className:"h-auto p-1",children:e.jsx(Ke,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"title",children:"Название *"}),e.jsx(U,{id:"title",ref:x,value:h.title,onChange:S=>v({...h,title:S.target.value}),placeholder:"Название достижения",autoComplete:"off",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"description",children:"Описание *"}),e.jsx(Se,{id:"description",value:h.description,onChange:S=>v({...h,description:S.target.value}),placeholder:"Описание достижения",rows:3,autoComplete:"off",className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"icon",children:"Иконка"}),e.jsxs(Z,{value:h.icon,onValueChange:S=>v({...h,icon:S}),children:[e.jsx(Q,{id:"icon",className:"mt-1",children:e.jsx(ee,{})}),e.jsx(te,{children:Yr.map(S=>{const F=S.icon;return e.jsx(E,{value:S.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),S.label]})},S.value)})})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"color",children:"Цвет"}),e.jsxs(Z,{value:h.color,onValueChange:S=>v({...h,color:S}),children:[e.jsx(Q,{id:"color",className:"mt-1",children:e.jsx(ee,{})}),e.jsx(te,{children:Xr.map(S=>e.jsx(E,{value:S.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded ${S.class||"bg-gray-300"}`}),S.label]})},S.value))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"course",children:"Курс"}),e.jsxs(Z,{value:h.course,onValueChange:S=>v({...h,course:S}),children:[e.jsx(Q,{id:"course",className:"mt-1",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Все курсы"}),e.jsx(E,{value:"1",children:"1 курс"}),e.jsx(E,{value:"2",children:"2 курс"}),e.jsx(E,{value:"3",children:"3 курс"}),e.jsx(E,{value:"4",children:"4 курс"}),e.jsx(E,{value:"5",children:"5 курс"}),e.jsx(E,{value:"6",children:"6 курс"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"points",children:"Баллы"}),e.jsx(U,{id:"points",type:"number",value:h.points,onChange:S=>v({...h,points:parseInt(S.target.value)||0}),min:"0",max:"100",autoComplete:"off",className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"criteria",children:"Критерии получения"}),e.jsx(Se,{id:"criteria",value:h.criteria,onChange:S=>v({...h,criteria:S.target.value}),placeholder:"Опишите критерии получения достижения",rows:2,autoComplete:"off",className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fc,{id:"isActive",checked:h.isActive,onCheckedChange:S=>v({...h,isActive:!!S})}),e.jsx(A,{htmlFor:"isActive",className:"text-sm",children:"Достижение активно"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-4 border-t",children:[e.jsxs(k,{onClick:()=>a?P():C(),className:"flex-1",disabled:!V,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),a?"Обновить":"Создать"]}),e.jsx(k,{variant:"outline",onClick:Ue,className:"flex-1 sm:flex-none",children:"Отмена"})]})]})]})})]})}function Wt({className:n,orientation:t="horizontal",decorative:s=!0,...r}){return e.jsx("div",{"data-slot":"separator-root",role:s?"none":"separator","aria-orientation":t,className:q("bg-border shrink-0",t==="horizontal"?"h-px w-full":"h-full w-px",n),...r})}function Bc(){const[n,t]=y.useState("main"),[s,r]=y.useState(""),[a,i]=y.useState(""),[o,l]=y.useState(""),c=f=>{const w=localStorage.getItem(f);return w?JSON.parse(w):{}},d=(f,w)=>{localStorage.setItem(f,JSON.stringify(w)),R.success("Изменения сохранены")},u=f=>{const w=c(f);r(JSON.stringify(w,null,2)),t(f)},m=()=>{try{const f=JSON.parse(s);d(n,f)}catch{R.error("Ошибка в JSON формате")}},g=()=>{if(!a.trim()){R.error("Введите название секции");return}const f=`admin_section_${a.toLowerCase().replace(/\s+/g,"_")}`,w=b(o,a);d(f,w),i(""),l(""),u(f)},b=(f,w)=>{const _={page:{title:w,content:`# ${w}

Новая страница с содержимым.`,type:"page",visible:!0,created:new Date().toISOString()},info_block:{title:w,description:"Описание информационного блока",items:[{title:"Пункт 1",content:"Содержимое пункта 1"},{title:"Пункт 2",content:"Содержимое пункта 2"}],type:"info_block",visible:!0,created:new Date().toISOString()},faq:{title:w,questions:[{question:"Вопрос 1?",answer:"Ответ на вопрос 1"},{question:"Вопрос 2?",answer:"Ответ на вопрос 2"}],type:"faq",visible:!0,created:new Date().toISOString()}};return _[f]||_.page},x=()=>{const f=[{key:"main_page",title:"Главная страница",icon:en},{key:"campuses",title:"Корпуса",icon:ka},{key:"faq",title:"FAQ",icon:Gs},{key:"benefits",title:"Льготы",icon:Ks},{key:"announcements",title:"Объявления",icon:ve},{key:"events",title:"События",icon:Gt}];for(let w=0;w<localStorage.length;w++){const _=localStorage.key(w);if(_&&_.startsWith("admin_section_")){const N=c(_);f.push({key:_,title:N.title||_.replace("admin_section_",""),icon:ve})}}return f},h=f=>{confirm("Вы уверены, что хотите удалить эту секцию?")&&(localStorage.removeItem(f),R.success("Секция удалена"),n===f&&(t("main_page"),r("")))},v=()=>{const f={};x().forEach(C=>{f[C.key]=c(C.key)});const w=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),_=URL.createObjectURL(w),N=document.createElement("a");N.href=_,N.download=`site-settings-${new Date().toISOString().split("T")[0]}.json`,N.click(),URL.revokeObjectURL(_),R.success("Настройки экспортированы")},p=f=>{const w=f.target.files?.[0];if(!w)return;const _=new FileReader;_.onload=N=>{try{const C=JSON.parse(N.target?.result);Object.entries(C).forEach(([P,D])=>{localStorage.setItem(P,JSON.stringify(D))}),R.success("Настройки импортированы")}catch{R.error("Ошибка при импорте файла")}},_.readAsText(w)},j=x();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("h2",{className:"text-2xl mb-2",children:"Управление контентом сайта"}),e.jsx("p",{className:"text-muted-foreground",children:"Редактируйте содержимое всех разделов сайта"})]}),e.jsxs(Oe,{defaultValue:"editor",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-3",children:[e.jsx(H,{value:"editor",children:"Редактор контента"}),e.jsx(H,{value:"create",children:"Создать раздел"}),e.jsx(H,{value:"settings",children:"Настройки"})]}),e.jsx(G,{value:"editor",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Разделы сайта"]})}),e.jsx(T,{className:"space-y-2",children:j.map(f=>{const w=f.icon;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-colors ${n===f.key?"border-primary bg-primary/5":"hover:bg-accent"}`,onClick:()=>u(f.key),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:f.title})]}),f.key.startsWith("admin_section_")&&e.jsx(k,{size:"sm",variant:"ghost",onClick:_=>{_.stopPropagation(),h(f.key)},children:e.jsx(ke,{className:"h-3 w-3"})})]},f.key)})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-5 w-5"}),"Редактор: ",j.find(f=>f.key===n)?.title||"Выберите раздел"]})}),e.jsx(T,{className:"space-y-4",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(A,{children:"JSON данные раздела:"}),e.jsx(Se,{value:s,onChange:f=>r(f.target.value),rows:20,className:"font-mono text-sm",placeholder:"Выберите раздел для редактирования..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:m,className:"flex-1",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Сохранить изменения"]}),e.jsx(k,{variant:"outline",onClick:()=>u(n),children:"Сбросить"})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Выберите раздел для редактирования из списка слева"})})]})})]})}),e.jsx(G,{value:"create",className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Создать новый раздел"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Название раздела:"}),e.jsx(U,{value:a,onChange:f=>i(f.target.value),placeholder:"Например: Дополнительная информация"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Шаблон:"}),e.jsxs(Z,{value:o,onValueChange:l,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Выберите шаблон"})}),e.jsxs(te,{children:[e.jsx(E,{value:"page",children:"Обычная страница"}),e.jsx(E,{value:"info_block",children:"Информационный блок"}),e.jsx(E,{value:"faq",children:"FAQ раздел"})]})]})]}),e.jsxs(k,{onClick:g,className:"w-full",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Создать раздел"]})]})]})}),e.jsx(G,{value:"settings",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Gt,{className:"h-5 w-5"}),"Экспорт/Импорт настроек"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Экспорт всех настроек сайта:"}),e.jsx(k,{onClick:v,variant:"outline",className:"w-full mt-2",children:"Скачать backup.json"})]}),e.jsx(Wt,{}),e.jsxs("div",{children:[e.jsx(A,{children:"Импорт настроек:"}),e.jsx("input",{type:"file",accept:".json",onChange:p,className:`mt-2 block w-full text-sm text-foreground
                      file:mr-4 file:py-2 file:px-4
                      file:rounded-lg file:border-0
                      file:text-sm file:font-medium
                      file:bg-primary file:text-primary-foreground
                      hover:file:bg-primary/90`})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5"}),"Дополнительные инструменты"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs(k,{variant:"outline",className:"w-full",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Предпросмотр сайта"]}),e.jsxs(k,{variant:"outline",className:"w-full",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Генерация отчета"]}),e.jsxs(xe,{children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx(pe,{children:"Все изменения сохраняются в localStorage браузера. Регулярно создавайте резервные копии."})]})]})]})]})})]})]})}function Jc(){const[n,t]=y.useState({}),[s,r]=y.useState([]),[a,i]=y.useState(""),[o,l]=y.useState("all"),[c,d]=y.useState("all"),[u,m]=y.useState(null),[g,b]=y.useState({username:"",password:"",role:"student",course:"",email:""});y.useEffect(()=>{x()},[]),y.useEffect(()=>{let N=Object.entries(n);a&&(N=N.filter(([,C])=>C.username.toLowerCase().includes(a.toLowerCase())||C.email?.toLowerCase().includes(a.toLowerCase()))),o!=="all"&&(N=N.filter(([,C])=>C.role===o)),c!=="all"&&(N=N.filter(([,C])=>C.course===c)),r(N)},[n,a,o,c]);const x=()=>{const N=localStorage.getItem("users");if(N){const C=JSON.parse(N),P={};Object.entries(C).forEach(([D,ne])=>{const[ue]=D.split("_");P[ue]||(P[ue]={username:ue,role:ne.role,course:ne.course,created:ne.created||new Date().toISOString(),lastLogin:ne.lastLogin,email:ne.email})}),t(P)}},h=()=>{if(!g.username||!g.password){R.error("Заполните имя пользователя и пароль");return}const N=JSON.parse(localStorage.getItem("users")||"{}"),C=`${g.username}_${g.password}`;if(N[C]){R.error("Пользователь с таким именем уже существует");return}const P={role:g.role,course:g.course,email:g.email,created:new Date().toISOString()};N[C]=P,localStorage.setItem("users",JSON.stringify(N)),b({username:"",password:"",role:"student",course:"",email:""}),x(),R.success("Пользователь создан")},v=N=>{if(N==="Starkver"){R.error("Нельзя удалить главного администратора");return}if(!confirm(`Вы уверены, что хотите удалить пользователя ${N}?`))return;const C=JSON.parse(localStorage.getItem("users")||"{}");Object.keys(C).forEach(P=>{P.startsWith(`${N}_`)&&delete C[P]}),localStorage.setItem("users",JSON.stringify(C)),x(),R.success("Пользователь удален")},p=(N,C)=>{if(N==="Starkver"&&C!=="admin"){R.error("Нельзя изменить роль главного администратора");return}const P=JSON.parse(localStorage.getItem("users")||"{}");Object.keys(P).forEach(D=>{D.startsWith(`${N}_`)&&(P[D].role=C)}),localStorage.setItem("users",JSON.stringify(P)),x(),R.success("Роль пользователя изменена")},j=(N,C)=>{if(!C){R.error("Введите новый пароль");return}const P=JSON.parse(localStorage.getItem("users")||"{}");let D=null,ne=null;if(Object.entries(P).forEach(([qe,Ue])=>{qe.startsWith(`${N}_`)&&(D=Ue,ne=qe)}),!D||!ne){R.error("Пользователь не найден");return}delete P[ne];const ue=`${N}_${C}`;P[ue]=D,localStorage.setItem("users",JSON.stringify(P)),R.success("Пароль изменен")},f=()=>{const N=Object.entries(n).map(([ne,ue])=>({username:ne,role:ue.role,course:ue.course,created:ue.created,email:ue.email})),C=new Blob([JSON.stringify(N,null,2)],{type:"application/json"}),P=URL.createObjectURL(C),D=document.createElement("a");D.href=P,D.download=`users-${new Date().toISOString().split("T")[0]}.json`,D.click(),URL.revokeObjectURL(P),R.success("Список пользователей экспортирован")},w=N=>{switch(N){case"admin":return As;case"teacher":return Ct;default:return Be}},_=N=>{switch(N){case"admin":return"destructive";case"teacher":return"default";default:return"secondary"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("h2",{className:"text-2xl mb-2",children:"Управление пользователями"}),e.jsx("p",{className:"text-muted-foreground",children:"Создавайте, редактируйте и управляйте пользователями системы"})]}),e.jsxs(Oe,{defaultValue:"users",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-3",children:[e.jsx(H,{value:"users",children:"Список пользователей"}),e.jsx(H,{value:"create",children:"Создать пользователя"}),e.jsx(H,{value:"stats",children:"Статистика"})]}),e.jsxs(G,{value:"users",className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5"}),"Фильтры и поиск"]})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Поиск:"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ea,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(U,{value:a,onChange:N=>i(N.target.value),placeholder:"Имя или email...",className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Роль:"}),e.jsxs(Z,{value:o,onValueChange:l,children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Все роли"}),e.jsx(E,{value:"student",children:"Студенты"}),e.jsx(E,{value:"teacher",children:"Преподаватели"}),e.jsx(E,{value:"admin",children:"Администраторы"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Курс:"}),e.jsxs(Z,{value:c,onValueChange:d,children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Все курсы"}),e.jsx(E,{value:"1",children:"1 курс"}),e.jsx(E,{value:"2",children:"2 курс"}),e.jsx(E,{value:"3",children:"3 курс"}),e.jsx(E,{value:"4",children:"4 курс"}),e.jsx(E,{value:"5",children:"5 курс"}),e.jsx(E,{value:"6",children:"6 курс"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(k,{onClick:f,variant:"outline",className:"w-full",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Экспорт"]})})]})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5"}),"Пользователи (",s.length,")"]})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[s.map(([N,C])=>{const P=w(C.role);return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:N}),C.email&&e.jsx("div",{className:"text-sm text-muted-foreground",children:C.email})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:_(C.role),children:C.role==="admin"?"Админ":C.role==="teacher"?"Преподаватель":"Студент"}),C.course&&e.jsxs(L,{variant:"outline",children:[C.course," курс"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Z,{value:C.role,onValueChange:D=>p(N,D),disabled:N==="Starkver",children:[e.jsx(Q,{className:"w-32",children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"student",children:"Студент"}),e.jsx(E,{value:"teacher",children:"Преподаватель"}),e.jsx(E,{value:"admin",children:"Админ"})]})]}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>{const D=prompt("Введите новый пароль:");D&&j(N,D)},children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx(k,{size:"sm",variant:"destructive",onClick:()=>v(N),disabled:N==="Starkver",children:e.jsx(ke,{className:"h-4 w-4"})})]})]},N)}),s.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Пользователи не найдены"})]})})]})]}),e.jsx(G,{value:"create",className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"h-5 w-5"}),"Создать нового пользователя"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Имя пользователя:"}),e.jsx(U,{value:g.username,onChange:N=>b({...g,username:N.target.value}),placeholder:"username"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Пароль:"}),e.jsx(U,{type:"password",value:g.password,onChange:N=>b({...g,password:N.target.value}),placeholder:"Пароль"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Роль:"}),e.jsxs(Z,{value:g.role,onValueChange:N=>b({...g,role:N}),children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"student",children:"Студент"}),e.jsx(E,{value:"teacher",children:"Преподаватель"}),e.jsx(E,{value:"admin",children:"Администратор"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Курс (для студентов):"}),e.jsxs(Z,{value:g.course,onValueChange:N=>b({...g,course:N}),children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Выберите курс"})}),e.jsxs(te,{children:[e.jsx(E,{value:"",children:"Не указан"}),e.jsx(E,{value:"1",children:"1 курс"}),e.jsx(E,{value:"2",children:"2 курс"}),e.jsx(E,{value:"3",children:"3 курс"}),e.jsx(E,{value:"4",children:"4 курс"}),e.jsx(E,{value:"5",children:"5 курс"}),e.jsx(E,{value:"6",children:"6 курс"})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(A,{children:"Email (опционально):"}),e.jsx(U,{type:"email",value:g.email,onChange:N=>b({...g,email:N.target.value}),placeholder:"email@example.com"})]})]}),e.jsxs(k,{onClick:h,className:"w-full",children:[e.jsx(Ht,{className:"h-4 w-4 mr-2"}),"Создать пользователя"]})]})]})}),e.jsxs(G,{value:"stats",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5"}),"Всего пользователей"]})}),e.jsx(T,{children:e.jsx("div",{className:"text-3xl font-bold",children:Object.keys(n).length})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5"}),"Студенты"]})}),e.jsx(T,{children:e.jsx("div",{className:"text-3xl font-bold",children:Object.values(n).filter(N=>N.role==="student").length})})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"h-5 w-5"}),"Преподаватели"]})}),e.jsx(T,{children:e.jsx("div",{className:"text-3xl font-bold",children:Object.values(n).filter(N=>N.role==="teacher").length})})]})]}),e.jsxs(xe,{children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(pe,{children:"Статистика обновляется автоматически при изменении пользователей. Данные хранятся в localStorage браузера."})]})]})]})]})}const it=y.forwardRef(({className:n="",checked:t=!1,onCheckedChange:s,disabled:r=!1,id:a,...i},o)=>{const l=()=>{!r&&s&&s(!t)};return e.jsx("button",{type:"button",role:"switch","aria-checked":t,"data-state":t?"checked":"unchecked","data-disabled":r?"":void 0,disabled:r,className:`
          peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent 
          transition-colors duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring 
          focus-visible:ring-offset-2 focus-visible:ring-offset-background 
          disabled:cursor-not-allowed disabled:opacity-50 
          ${t?"bg-primary":"bg-muted"} 
          ${n}
        `,id:a,ref:o,onClick:l,...i,children:e.jsx("span",{className:`
            pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 
            transition-transform duration-200 ease-in-out
            ${t?"translate-x-5":"translate-x-0"}
          `,style:{boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)"}})})});it.displayName="Switch";function qc(){const[n,t]=y.useState({siteName:"Образовательный портал",siteDescription:"Портал для студентов и преподавателей",maintenanceMode:!1,registrationEnabled:!0,defaultCourse:"1",maxFileSize:10,allowedFileTypes:["pdf","doc","docx","txt","md"],notifications:{achievements:!0,announcements:!0,reminders:!0},theme:{defaultTheme:"system",allowThemeSwitch:!0},backup:{autoBackup:!1,backupInterval:7}}),[s,r]=y.useState(""),[a,i]=y.useState("");y.useEffect(()=>{o()},[]);const o=()=>{const h=localStorage.getItem("system_settings");h&&t(JSON.parse(h));const v=localStorage.getItem("custom_css");v&&r(v);const p=localStorage.getItem("custom_js");p&&i(p)},l=()=>{localStorage.setItem("system_settings",JSON.stringify(n)),R.success("Настройки сохранены")},c=()=>{localStorage.setItem("custom_css",s);let h=document.getElementById("custom-admin-css");if(h&&h.remove(),s.trim()){const v=document.createElement("style");v.id="custom-admin-css",v.textContent=s,document.head.appendChild(v)}R.success("Пользовательские стили применены")},d=()=>{if(localStorage.setItem("custom_js",a),a.trim())try{new Function(a)(),R.success("Пользовательский JavaScript выполнен")}catch(h){R.error("Ошибка в JavaScript коде"),console.error(h)}},u=()=>{const h={timestamp:new Date().toISOString(),users:localStorage.getItem("users"),system_settings:localStorage.getItem("system_settings"),achievements:localStorage.getItem("achievements"),custom_css:localStorage.getItem("custom_css"),custom_js:localStorage.getItem("custom_js"),courses:localStorage.getItem("courses"),files:localStorage.getItem("files"),custom_sections:{}};for(let f=0;f<localStorage.length;f++){const w=localStorage.key(f);w&&w.startsWith("admin_section_")&&(h.custom_sections[w]=localStorage.getItem(w))}const v=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),p=URL.createObjectURL(v),j=document.createElement("a");j.href=p,j.download=`full-backup-${new Date().toISOString().slice(0,10)}.json`,j.click(),URL.revokeObjectURL(p),R.success("Полная резервная копия создана")},m=h=>{const v=h.target.files?.[0];if(!v)return;const p=new FileReader;p.onload=j=>{try{const f=JSON.parse(j.target?.result);confirm("Это действие перезапишет все текущие данные. Продолжить?")&&(f.users&&localStorage.setItem("users",f.users),f.system_settings&&localStorage.setItem("system_settings",f.system_settings),f.achievements&&localStorage.setItem("achievements",f.achievements),f.custom_css&&localStorage.setItem("custom_css",f.custom_css),f.custom_js&&localStorage.setItem("custom_js",f.custom_js),f.courses&&localStorage.setItem("courses",f.courses),f.files&&localStorage.setItem("files",f.files),f.custom_sections&&Object.entries(f.custom_sections).forEach(([w,_])=>{typeof _=="string"&&localStorage.setItem(w,_)}),R.success("Данные восстановлены. Страница будет перезагружена."),setTimeout(()=>window.location.reload(),2e3))}catch{R.error("Ошибка при восстановлении данных")}},p.readAsText(v)},g=()=>{if(confirm("ВНИМАНИЕ! Это действие удалит ВСЕ данные системы. Продолжить?")&&confirm("Последнее предупреждение! Все пользователи, файлы и настройки будут удалены.")){const h=localStorage.getItem("currentUser"),v="Starkver_123",p={role:"admin",username:"Starkver",created:new Date().toISOString()};localStorage.clear(),localStorage.setItem("users",JSON.stringify({[v]:p})),h&&localStorage.setItem("currentUser",h),R.success("Все данные очищены. Страница будет перезагружена."),setTimeout(()=>window.location.reload(),2e3)}},b=()=>{let h=0;for(let v in localStorage)localStorage.hasOwnProperty(v)&&(h+=localStorage[v].length);return(h/1024).toFixed(2)},x=(h,v)=>{const p=h.split("."),j={...n};let f=j;for(let w=0;w<p.length-1;w++)f=f[p[w]];f[p[p.length-1]]=v,t(j)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("h2",{className:"text-2xl mb-2",children:"Системные настройки"}),e.jsx("p",{className:"text-muted-foreground",children:"Управление глобальными настройками портала"})]}),e.jsxs(Oe,{defaultValue:"general",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-5",children:[e.jsx(H,{value:"general",children:"Основные"}),e.jsx(H,{value:"features",children:"Функции"}),e.jsx(H,{value:"theme",children:"Внешний вид"}),e.jsx(H,{value:"backup",children:"Резервные копии"}),e.jsx(H,{value:"advanced",children:"Расширенные"})]}),e.jsx(G,{value:"general",className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Aa,{className:"h-5 w-5"}),"Основная информация"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Название сайта:"}),e.jsx(U,{value:n.siteName,onChange:h=>x("siteName",h.target.value),placeholder:"Образовательный портал"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Описание сайта:"}),e.jsx(Se,{value:n.siteDescription,onChange:h=>x("siteDescription",h.target.value),placeholder:"Описание вашего образовательного портала",rows:3})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Курс по умолчанию для новых пользователей:"}),e.jsx(U,{value:n.defaultCourse,onChange:h=>x("defaultCourse",h.target.value),placeholder:"1"})]}),e.jsxs(k,{onClick:l,children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),"Сохранить основные настройки"]})]})]})}),e.jsxs(G,{value:"features",className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(As,{className:"h-5 w-5"}),"Управление функциями"]})}),e.jsxs(T,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Режим обслуживания"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Закрыть доступ к сайту для всех кроме администраторов"})]}),e.jsx(it,{checked:n.maintenanceMode,onCheckedChange:h=>x("maintenanceMode",h)})]}),e.jsx(Wt,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Регистрация новых пользователей"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Разрешить самостоятельную регистрацию"})]}),e.jsx(it,{checked:n.registrationEnabled,onCheckedChange:h=>x("registrationEnabled",h)})]}),e.jsx(Wt,{}),e.jsxs("div",{children:[e.jsx(A,{children:"Максимальный размер файла (MB):"}),e.jsx(U,{type:"number",value:n.maxFileSize,onChange:h=>x("maxFileSize",parseInt(h.target.value)),min:"1",max:"100"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Разрешенные типы файлов (через запятую):"}),e.jsx(U,{value:n.allowedFileTypes.join(", "),onChange:h=>x("allowedFileTypes",h.target.value.split(",").map(v=>v.trim())),placeholder:"pdf, doc, docx, txt, md"})]}),e.jsxs(k,{onClick:l,children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),"Сохранить настройки функций"]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),"Уведомления"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"Уведомления о достижениях"}),e.jsx(it,{checked:n.notifications.achievements,onCheckedChange:h=>x("notifications.achievements",h)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"Уведомления об объявлениях"}),e.jsx(it,{checked:n.notifications.announcements,onCheckedChange:h=>x("notifications.announcements",h)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"Напоминания"}),e.jsx(it,{checked:n.notifications.reminders,onCheckedChange:h=>x("notifications.reminders",h)})]})]})]})]}),e.jsx(G,{value:"theme",className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5"}),"Пользовательские стили"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Пользовательский CSS:"}),e.jsx(Se,{value:s,onChange:h=>r(h.target.value),rows:10,className:"font-mono text-sm",placeholder:`/* Ваши пользовательские стили */
.custom-button {
  background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
  border: none;
  color: white;
}`})]}),e.jsxs(k,{onClick:c,children:[e.jsx(Es,{className:"h-4 w-4 mr-2"}),"Применить стили"]})]})]})}),e.jsx(G,{value:"backup",className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(wr,{className:"h-5 w-5"}),"Управление данными"]})}),e.jsxs(T,{className:"space-y-6",children:[e.jsxs(xe,{children:[e.jsx(wr,{className:"h-4 w-4"}),e.jsxs(pe,{children:["Размер данных в localStorage: ",b()," KB"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(k,{onClick:u,className:"w-full",children:[e.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Создать полную резервную копию"]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".json",onChange:m,className:"hidden",id:"restore-backup"}),e.jsxs(k,{onClick:()=>document.getElementById("restore-backup")?.click(),variant:"outline",className:"w-full",children:[e.jsx(cn,{className:"h-4 w-4 mr-2"}),"Восстановить из копии"]})]})]}),e.jsx(Wt,{}),e.jsxs("div",{children:[e.jsx(A,{className:"text-destructive",children:"Опасная зона"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Действия в этой зоне необратимы"}),e.jsxs(k,{onClick:g,variant:"destructive",className:"w-full",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Очистить все данные системы"]})]})]})]})}),e.jsxs(G,{value:"advanced",className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Gt,{className:"h-5 w-5"}),"Пользовательский JavaScript"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs(xe,{children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx(pe,{children:"Осторожно! Неправильный JavaScript может нарушить работу сайта."})]}),e.jsxs("div",{children:[e.jsx(A,{children:"JavaScript код:"}),e.jsx(Se,{value:a,onChange:h=>i(h.target.value),rows:10,className:"font-mono text-sm",placeholder:`// Ваш пользовательский JavaScript
console.log('Пользовательский скрипт загружен');

// Например, добавление кастомного поведения
document.addEventListener('DOMContentLoaded', function() {
  // Ваш код здесь
});`})]}),e.jsxs(k,{onClick:d,variant:"outline",children:[e.jsx(Gt,{className:"h-4 w-4 mr-2"}),"Выполнить JavaScript"]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsx($,{children:"Информация о системе"})}),e.jsxs(T,{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Версия:"})," 1.0.0"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Последнее обновление:"})," ",new Date().toLocaleDateString()]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Браузер:"})," ",navigator.userAgent.includes("Chrome")?"Chrome":navigator.userAgent.includes("Firefox")?"Firefox":"Другой"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Поддержка localStorage:"})," ",typeof Storage<"u"?"Да":"Нет"]})]})]})]})]})]})}function zc(){const[n,t]=y.useState([]),[s,r]=y.useState(!1),[a,i]=y.useState({title:"",message:"",type:"info",targetUsers:"all",specificUsers:"",expiryDate:""});y.useEffect(()=>{o()},[]);const o=()=>{const x=localStorage.getItem("adminNotifications");if(x)try{const h=JSON.parse(x);t(h)}catch(h){console.error("Error loading notifications:",h),t([])}},l=x=>{localStorage.setItem("adminNotifications",JSON.stringify(x)),t(x)},c=()=>{if(!a.title.trim()||!a.message.trim()){R.error("Заполните все обязательные поля");return}const h=[{id:Date.now().toString(),title:a.title.trim(),message:a.message.trim(),type:a.type,targetUsers:a.targetUsers,specificUsers:a.specificUsers?a.specificUsers.split(",").map(v=>v.trim()):void 0,expiryDate:a.expiryDate||void 0,createdAt:new Date().toISOString(),createdBy:"admin",isActive:!0},...n];l(h),i({title:"",message:"",type:"info",targetUsers:"all",specificUsers:"",expiryDate:""}),r(!1),R.success("Уведомление создано успешно")},d=x=>{if(confirm("Вы уверены, что хотите удалить это уведомление?")){const h=n.filter(v=>v.id!==x);l(h),R.success("Уведомление удалено")}},u=x=>{const h=n.map(v=>v.id===x?{...v,isActive:!v.isActive}:v);l(h),R.success("Статус уведомления изменен")},m=x=>{switch(x){case"info":return e.jsx(St,{className:"h-4 w-4"});case"warning":return e.jsx(Hs,{className:"h-4 w-4"});case"success":return e.jsx(ot,{className:"h-4 w-4"});case"error":return e.jsx(ct,{className:"h-4 w-4"});default:return e.jsx(St,{className:"h-4 w-4"})}},g=x=>{switch(x){case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"success":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},b=x=>{switch(x.targetUsers){case"all":return"Все пользователи";case"students":return"Студенты";case"teachers":return"Преподаватели";case"specific":return`Конкретные пользователи: ${x.specificUsers?.join(", ")}`;default:return"Неизвестно"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Центр уведомлений"}),e.jsx("p",{className:"text-muted-foreground",children:"Создавайте и управляйте уведомлениями для пользователей портала"})]}),e.jsxs(k,{onClick:()=>r(!s),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Создать уведомление"]})]}),s&&e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),"Создать новое уведомление"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"title",children:"Заголовок *"}),e.jsx(U,{id:"title",value:a.title,onChange:x=>i(h=>({...h,title:x.target.value})),placeholder:"Введите заголовок уведомления"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"type",children:"Тип уведомления"}),e.jsxs(Z,{value:a.type,onValueChange:x=>i(h=>({...h,type:x})),children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"info",children:"Информация"}),e.jsx(E,{value:"warning",children:"Предупреждение"}),e.jsx(E,{value:"success",children:"Успех"}),e.jsx(E,{value:"error",children:"Ошибка"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"message",children:"Сообщение *"}),e.jsx(Se,{id:"message",value:a.message,onChange:x=>i(h=>({...h,message:x.target.value})),placeholder:"Введите текст уведомления",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"targetUsers",children:"Целевая аудитория"}),e.jsxs(Z,{value:a.targetUsers,onValueChange:x=>i(h=>({...h,targetUsers:x})),children:[e.jsx(Q,{children:e.jsx(ee,{})}),e.jsxs(te,{children:[e.jsx(E,{value:"all",children:"Все пользователи"}),e.jsx(E,{value:"students",children:"Только студенты"}),e.jsx(E,{value:"teachers",children:"Только преподаватели"}),e.jsx(E,{value:"specific",children:"Конкретные пользователи"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"expiryDate",children:"Дата истечения (опционально)"}),e.jsx(U,{id:"expiryDate",type:"datetime-local",value:a.expiryDate,onChange:x=>i(h=>({...h,expiryDate:x.target.value}))})]})]}),a.targetUsers==="specific"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"specificUsers",children:"Имена пользователей (через запятую)"}),e.jsx(U,{id:"specificUsers",value:a.specificUsers,onChange:x=>i(h=>({...h,specificUsers:x.target.value})),placeholder:"user1, user2, user3"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:c,children:[e.jsx(an,{className:"h-4 w-4 mr-2"}),"Создать уведомление"]}),e.jsx(k,{variant:"outline",onClick:()=>r(!1),children:"Отмена"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Активные уведомления (",n.length,")"]}),n.length===0?e.jsx(I,{children:e.jsxs(T,{className:"text-center py-8",children:[e.jsx(Ye,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Уведомлений пока нет. Создайте первое уведомление для пользователей."})]})}):n.map(x=>e.jsx(I,{className:x.isActive?"":"opacity-60",children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{className:g(x.type),children:[m(x.type),e.jsx("span",{className:"ml-1 capitalize",children:x.type})]}),!x.isActive&&e.jsx(L,{variant:"secondary",children:"Неактивно"}),x.expiryDate&&e.jsxs(L,{variant:"outline",children:[e.jsx(dt,{className:"h-3 w-3 mr-1"}),"До ",new Date(x.expiryDate).toLocaleDateString()]})]}),e.jsx("h4",{className:"font-semibold",children:x.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.message}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(kt,{className:"h-3 w-3"}),new Date(x.createdAt).toLocaleString()]}),e.jsxs("span",{children:["Аудитория: ",b(x)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{size:"sm",variant:"outline",onClick:()=>u(x.id),children:x.isActive?"Деактивировать":"Активировать"}),e.jsx(k,{size:"sm",variant:"destructive",onClick:()=>d(x.id),children:e.jsx(ke,{className:"h-4 w-4"})})]})]})})},x.id))]})]})}function Vc(){const{user:n,logout:t}=je(),[s,r]=y.useState(""),[a,i]=y.useState(""),[o,l]=y.useState(""),[c,d]=y.useState(n?.course||""),[u,m]=y.useState(!1),g=()=>{if(!s||!a||!o){alert("Все поля должны быть заполнены");return}if(a!==o){alert("Новые пароли не совпадают");return}if(a.length<6){alert("Новый пароль должен содержать минимум 6 символов");return}const x=JSON.parse(localStorage.getItem("users")||"{}"),h=`${n?.username}_${s}`;if(!x[h]){alert("Неверный текущий пароль");return}const v=x[h];delete x[h];const p=`${n?.username}_${a}`;x[p]={...v,course:c},localStorage.setItem("users",JSON.stringify(x));const j={...v,course:c};localStorage.setItem("currentUser",JSON.stringify(j)),alert("Пароль успешно изменен! Войдите с новым паролем"),setTimeout(()=>{t()},1500)},b=()=>{if(!c){alert("Выберите курс");return}if(!s){alert("Введите текущий пароль для изменения курса");return}const x=JSON.parse(localStorage.getItem("users")||"{}"),h=`${n?.username}_${s}`;if(!x[h]){alert("Неверный пароль");return}x[h]={...x[h],course:c},localStorage.setItem("users",JSON.stringify(x));const v={...x[h]};localStorage.setItem("currentUser",JSON.stringify(v)),alert("Курс успешно изменен!"),setTimeout(()=>{window.location.reload()},1e3)};return n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl mb-4",children:"Профиль пользователя"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:n?.role==="admin"?"Управляйте настройками аккаунта и всеми функциями портала":"Управляйте настройками вашего аккаунта"})]}),n?.role==="admin"?e.jsxs(Oe,{defaultValue:"profile",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-7",children:[e.jsx(H,{value:"profile",children:"Профиль"}),e.jsx(H,{value:"files",children:"Файлы"}),e.jsx(H,{value:"achievements",children:"Достижения"}),e.jsx(H,{value:"content",children:"Контент"}),e.jsx(H,{value:"users",children:"Пользователи"}),e.jsx(H,{value:"notifications",children:"Уведомления"}),e.jsx(H,{value:"system",children:"Система"})]}),e.jsx(G,{value:"profile",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 max-w-2xl mx-auto",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5"}),"Информация о пользователе"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Имя пользователя"}),e.jsx(U,{value:n.username,disabled:!0})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Роль"}),e.jsx(U,{value:n.role==="admin"?"Администратор":n.role==="teacher"?"Преподаватель":"Студент",disabled:!0})]})]}),n.course&&e.jsxs("div",{children:[e.jsx(A,{children:"Текущий курс"}),e.jsx(U,{value:n.course,disabled:!0})]})]})]}),n.role!=="admin"&&e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Изменить курс"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Выберите курс"}),e.jsxs(Z,{value:c,onValueChange:d,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Выберите курс"})}),e.jsxs(te,{children:[e.jsx(E,{value:"1",children:"1 курс"}),e.jsx(E,{value:"2",children:"2 курс"}),e.jsx(E,{value:"3",children:"3 курс"}),e.jsx(E,{value:"4",children:"4 курс"}),e.jsx(E,{value:"5",children:"5 курс"}),e.jsx(E,{value:"6",children:"6 курс"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Текущий пароль"}),e.jsx(U,{type:"password",value:s,onChange:x=>r(x.target.value),placeholder:"Введите текущий пароль"})]}),e.jsxs(k,{onClick:b,className:"w-full",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Сохранить курс"]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"h-5 w-5"}),"Изменить пароль"]})}),e.jsx(T,{className:"space-y-4",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(A,{children:"Текущий пароль"}),e.jsx(U,{type:"password",value:s,onChange:x=>r(x.target.value),placeholder:"Введите текущий пароль"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Новый пароль"}),e.jsx(U,{type:"password",value:a,onChange:x=>i(x.target.value),placeholder:"Введите новый пароль"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Подтвердите новый пароль"}),e.jsx(U,{type:"password",value:o,onChange:x=>l(x.target.value),placeholder:"Подтвердите новый пароль"})]}),e.jsxs(xe,{children:[e.jsx(ot,{className:"h-4 w-4"}),e.jsx(pe,{children:"После смены пароля вы будете автоматически выведены из системы. Войдите заново с новым паролем."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:g,className:"flex-1",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Сменить пароль"]}),e.jsx(k,{variant:"outline",onClick:()=>{m(!1),r(""),i(""),l("")},children:"Отмена"})]})]}):e.jsx(k,{onClick:()=>m(!0),variant:"outline",className:"w-full",children:"Изменить пароль"})})]})]})}),e.jsx(G,{value:"files",className:"space-y-6",children:e.jsx(Lc,{})}),e.jsx(G,{value:"achievements",className:"space-y-6",children:e.jsx(Mc,{})}),e.jsx(G,{value:"content",className:"space-y-6",children:e.jsx(Bc,{})}),e.jsx(G,{value:"users",className:"space-y-6",children:e.jsx(Jc,{})}),e.jsx(G,{value:"notifications",className:"space-y-6",children:e.jsx(zc,{})}),e.jsx(G,{value:"system",className:"space-y-6",children:e.jsx(qc,{})})]}):n?.role==="student"?e.jsxs(Oe,{defaultValue:"profile",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-2",children:[e.jsx(H,{value:"profile",children:"Настройки профиля"}),e.jsx(H,{value:"achievements",children:"Мои достижения"})]}),e.jsx(G,{value:"profile",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 max-w-2xl mx-auto",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5"}),"Информация о пользователе"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Имя пользователя"}),e.jsx(U,{value:n?.username||"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Роль"}),e.jsx(U,{value:n?.role==="admin"?"Администратор":n?.role==="teacher"?"Преподаватель":"Студент",disabled:!0})]})]}),n?.course&&e.jsxs("div",{children:[e.jsx(A,{children:"Текущий курс"}),e.jsx(U,{value:n.course,disabled:!0})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Изменить курс"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Выберите курс"}),e.jsxs(Z,{value:c,onValueChange:d,children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Выберите курс"})}),e.jsxs(te,{children:[e.jsx(E,{value:"1",children:"1 курс"}),e.jsx(E,{value:"2",children:"2 курс"}),e.jsx(E,{value:"3",children:"3 курс"}),e.jsx(E,{value:"4",children:"4 курс"}),e.jsx(E,{value:"5",children:"5 курс"}),e.jsx(E,{value:"6",children:"6 курс"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Текущий пароль"}),e.jsx(U,{type:"password",value:s,onChange:x=>r(x.target.value),placeholder:"Введите текущий пароль"})]}),e.jsxs(k,{onClick:b,className:"w-full",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Сохранить курс"]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"h-5 w-5"}),"Изменить пароль"]})}),e.jsx(T,{className:"space-y-4",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(A,{children:"Текущий пароль"}),e.jsx(U,{type:"password",value:s,onChange:x=>r(x.target.value),placeholder:"Введите текущий пароль"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Новый пароль"}),e.jsx(U,{type:"password",value:a,onChange:x=>i(x.target.value),placeholder:"Введите новый пароль"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Подтвердите новый пароль"}),e.jsx(U,{type:"password",value:o,onChange:x=>l(x.target.value),placeholder:"Подтвердите новый пароль"})]}),e.jsxs(xe,{children:[e.jsx(ot,{className:"h-4 w-4"}),e.jsx(pe,{children:"После смены пароля вы будете автоматически выведены из системы. Войдите заново с новым паролем."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:g,className:"flex-1",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Сменить пароль"]}),e.jsx(k,{variant:"outline",onClick:()=>{m(!1),r(""),i(""),l("")},children:"Отмена"})]})]}):e.jsx(k,{onClick:()=>m(!0),variant:"outline",className:"w-full",children:"Изменить пароль"})})]})]})}),e.jsx(G,{value:"achievements",className:"space-y-6",children:n?.username&&n?.course&&e.jsx(Gn,{studentId:n.username,studentCourse:n.course})})]}):e.jsxs("div",{className:"grid gap-6 max-w-2xl mx-auto",children:[e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5"}),"Информация о пользователе"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Имя пользователя"}),e.jsx(U,{value:n?.username||"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Роль"}),e.jsx(U,{value:n?.role==="admin"?"Администратор":n?.role==="teacher"?"Преподаватель":"Студент",disabled:!0})]})]}),n?.course&&e.jsxs("div",{children:[e.jsx(A,{children:"Текущий курс"}),e.jsx(U,{value:n.course,disabled:!0})]})]})]}),e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"h-5 w-5"}),"Изменить пароль"]})}),e.jsx(T,{className:"space-y-4",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(A,{children:"Текущий пароль"}),e.jsx(U,{type:"password",value:s,onChange:x=>r(x.target.value),placeholder:"Введите текущий пароль"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Новый пароль"}),e.jsx(U,{type:"password",value:a,onChange:x=>i(x.target.value),placeholder:"Введите новый пароль"})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Подтвердите новый пароль"}),e.jsx(U,{type:"password",value:o,onChange:x=>l(x.target.value),placeholder:"Подтвердите новый пароль"})]}),e.jsxs(xe,{children:[e.jsx(ot,{className:"h-4 w-4"}),e.jsx(pe,{children:"После смены пароля вы будете автоматически выведены из системы. Войдите заново с новым паролем."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:g,className:"flex-1",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Сменить пароль"]}),e.jsx(k,{variant:"outline",onClick:()=>{m(!1),r(""),i(""),l("")},children:"Отмена"})]})]}):e.jsx(k,{onClick:()=>m(!0),variant:"outline",className:"w-full",children:"Изменить пароль"})})]})]})]}):e.jsx("div",{children:"Пользователь не найден"})}class Wc{currentSessionId=null;currentUserId=null;sessionStartTime=null;activityCount=0;pagesVisited=new Set;batchActivities=[];BATCH_SIZE=10;CACHE_FLUSH_INTERVAL=6e4;IMPORTANT_ACTIVITIES=["login","logout","achievement_earned","journal_access"];flushTimer=null;async startSession(t){try{this.currentUserId=t,this.sessionStartTime=new Date,this.currentSessionId=`session_${t}_${Date.now()}`,this.activityCount=0,this.pagesVisited.clear(),await this.trackActivity("login",{session_id:this.currentSessionId,user_agent:navigator.userAgent,timestamp:this.sessionStartTime.toISOString()}),await this.updateUserLastLogin(t),J&&await J.from("user_sessions").insert({user_id:t,session_start:this.sessionStartTime.toISOString(),pages_visited:0,activities_count:0,last_activity:this.sessionStartTime.toISOString()}),console.log("🎯 Session started for user:",t)}catch(s){console.error("Error starting session:",s)}}async endSession(){if(!(!this.currentSessionId||!this.currentUserId||!this.sessionStartTime))try{await this.flushActivities();const t=new Date,s=Math.round((t.getTime()-this.sessionStartTime.getTime())/(1e3*60));await this.trackActivity("logout",{session_id:this.currentSessionId,session_duration_minutes:s,pages_visited:this.pagesVisited.size,activities_count:this.activityCount}),J&&(await J.from("user_sessions").update({session_end:t.toISOString(),duration_minutes:s,pages_visited:this.pagesVisited.size,activities_count:this.activityCount}).eq("user_id",this.currentUserId).eq("session_start",this.sessionStartTime.toISOString()),await J.rpc("update_user_session_stats",{user_id:this.currentUserId,additional_minutes:s,additional_login:1})),console.log("🔚 Session ended. Duration:",s,"minutes"),this.resetSession()}catch(t){console.error("Error ending session:",t)}}async trackActivity(t,s={}){if(this.currentUserId&&this.shouldLogActivity(t))try{this.activityCount++;const r={user_id:this.currentUserId,activity_type:t,details:{...s,session_id:this.currentSessionId,user_agent:navigator.userAgent},timestamp:new Date().toISOString()};this.batchActivities.push(r),this.batchActivities.length>=this.BATCH_SIZE||this.IMPORTANT_ACTIVITIES.includes(t)?await this.flushActivities():this.scheduleFlush();const a=JSON.parse(localStorage.getItem("user_activities")||"[]");a.push(r),a.length>50&&a.splice(0,a.length-50),localStorage.setItem("user_activities",JSON.stringify(a)),await this.updateUserLastActivity(),console.log("📊 Activity tracked:",t,s)}catch(r){console.error("Error tracking activity:",r)}}shouldLogActivity(t){return this.IMPORTANT_ACTIVITIES.includes(t)?!0:Math.random()<.1}async flushActivities(){if(this.batchActivities.length!==0)try{J&&await J.from("user_activities").insert(this.batchActivities),this.batchActivities=[],this.flushTimer&&(clearTimeout(this.flushTimer),this.flushTimer=null)}catch(t){console.error("Error flushing activities:",t)}}scheduleFlush(){this.flushTimer||(this.flushTimer=setTimeout(async()=>{await this.flushActivities()},this.CACHE_FLUSH_INTERVAL))}async trackPageVisit(t){this.pagesVisited.add(t),await this.trackActivity("page_visit",{page:t})}async trackFileView(t,s){await this.trackActivity("file_view",{file_name:t,file_type:s})}async trackJournalAccess(t){await this.trackActivity("journal_access",{journal_id:t})}async trackProfileEdit(t){await this.trackActivity("profile_edit",{changed_fields:t})}async trackAchievementEarned(t){await this.trackActivity("achievement_earned",{achievement_id:t})}async trackCourseMaterialAccess(t,s){await this.trackActivity("course_material_access",{material_id:t,material_type:s})}async updateUserLastLogin(t){try{J&&await J.from("users_profiles").update({last_login:new Date().toISOString(),total_login_count:J.sql`total_login_count + 1`}).eq("id",t);const s=localStorage.getItem("users")||"{}";let r;try{r=JSON.parse(s)}catch(a){console.warn("Failed to parse users from localStorage:",a),r={}}if(typeof r=="object"&&!Array.isArray(r)){for(const[a,i]of Object.entries(r))if(i.id===t){i.last_login=new Date().toISOString(),i.total_login_count=(i.total_login_count||0)+1,r[a]=i,localStorage.setItem("users",JSON.stringify(r));break}}else if(Array.isArray(r)){const a=r.findIndex(i=>i.id===t);a!==-1&&(r[a].last_login=new Date().toISOString(),r[a].total_login_count=(r[a].total_login_count||0)+1,localStorage.setItem("users",JSON.stringify(r)))}}catch(s){console.error("Error updating last login:",s)}}async updateUserLastActivity(){if(this.currentUserId)try{const t=new Date().toISOString();J&&await J.from("users_profiles").update({last_activity:t}).eq("id",this.currentUserId);const s=localStorage.getItem("users")||"{}";let r;try{r=JSON.parse(s)}catch(a){console.warn("Failed to parse users from localStorage:",a),r={}}if(typeof r=="object"&&!Array.isArray(r)){for(const[a,i]of Object.entries(r))if(i.id===this.currentUserId){i.last_activity=t,r[a]=i,localStorage.setItem("users",JSON.stringify(r));break}}else if(Array.isArray(r)){const a=r.findIndex(i=>i.id===this.currentUserId);a!==-1&&(r[a].last_activity=t,localStorage.setItem("users",JSON.stringify(r)))}}catch(t){console.error("Error updating last activity:",t)}}async getUserActivities(t,s=50){try{if(J){const{data:a,error:i}=await J.from("user_activities").select("*").eq("user_id",t).order("timestamp",{ascending:!1}).limit(s);if(i)throw i;return a||[]}return JSON.parse(localStorage.getItem("user_activities")||"[]").filter(a=>a.user_id===t).sort((a,i)=>new Date(i.timestamp).getTime()-new Date(a.timestamp).getTime()).slice(0,s)}catch(r){return console.error("Error getting user activities:",r),[]}}async getUserSessions(t,s=10){try{if(J){const{data:r,error:a}=await J.from("user_sessions").select("*").eq("user_id",t).order("session_start",{ascending:!1}).limit(s);if(a)throw a;return r||[]}return[]}catch(r){return console.error("Error getting user sessions:",r),[]}}async getDetailedUserProfile(t){try{if(J){const{data:i,error:o}=await J.from("users_profiles").select("*").eq("id",t).single();if(o)throw o;return i}const s=localStorage.getItem("users")||"{}";let r,a=null;try{r=JSON.parse(s)}catch(i){console.warn("Failed to parse users from localStorage:",i),r={}}return typeof r=="object"&&!Array.isArray(r)?a=Object.values(r).find(i=>i.id===t):Array.isArray(r)&&(a=r.find(i=>i.id===t)),a?{...a,total_login_count:a.total_login_count||0,total_session_time_minutes:a.total_session_time_minutes||0,journal_entries_count:a.journal_entries_count||0,profile_completion_percentage:a.profile_completion_percentage||0,is_active:a.is_active!==!1}:null}catch(s){return console.error("Error getting detailed user profile:",s),null}}resetSession(){this.currentSessionId=null,this.currentUserId=null,this.sessionStartTime=null,this.activityCount=0,this.pagesVisited.clear(),this.flushTimer&&(clearTimeout(this.flushTimer),this.flushTimer=null),this.batchActivities=[]}async getActivitySummary(t,s=7){try{const r=new Date,a=new Date(r.getTime()-s*24*60*60*1e3);if(J){const{data:i,error:o}=await J.from("user_activities").select("activity_type, timestamp").eq("user_id",t).gte("timestamp",a.toISOString()).lte("timestamp",r.toISOString());if(o)throw o;const l={total_activities:i?.length||0,activity_types:{},daily_breakdown:{},most_active_day:"",avg_daily_activities:0};i?.forEach(d=>{l.activity_types[d.activity_type]=(l.activity_types[d.activity_type]||0)+1;const u=new Date(d.timestamp).toDateString();l.daily_breakdown[u]=(l.daily_breakdown[u]||0)+1});let c=0;return Object.entries(l.daily_breakdown).forEach(([d,u])=>{u>c&&(c=u,l.most_active_day=d)}),l.avg_daily_activities=Math.round(l.total_activities/s),l}return{total_activities:0,activity_types:{},daily_breakdown:{},most_active_day:"",avg_daily_activities:0}}catch(r){return console.error("Error getting activity summary:",r),null}}getCurrentSession(){return{sessionId:this.currentSessionId,userId:this.currentUserId,startTime:this.sessionStartTime,activityCount:this.activityCount,pagesVisited:Array.from(this.pagesVisited)}}}const Qt=new Wc;window.addEventListener("beforeunload",()=>{Qt.endSession()});document.addEventListener("visibilitychange",()=>{document.hidden?Qt.trackActivity("page_hidden",{timestamp:new Date().toISOString()}):Qt.trackActivity("page_visible",{timestamp:new Date().toISOString()})});function Hc({content:n,className:t=""}){const s=y.useRef(null),[r,a]=y.useState("");return y.useEffect(()=>{let i=0;const o=u=>{const m=/```mermaid\n([\s\S]*?)\n```/g;return u.replace(m,(g,b)=>{const x=`mermaid-${++i}`,h=v=>{const p=v.split(`
`).filter(ae=>ae.trim()),j={},f=[];p.forEach(ae=>{const Y=ae.trim();if(Y.includes("flowchart")||Y.includes("graph"))return;const se=Y.match(/(\w+)\[([^\]]+)\]\s*-->\s*(\w+)\[([^\]]+)\]/);if(se){j[se[1]]=se[2],j[se[3]]=se[4],f.push({from:se[1],to:se[3]});return}const oe=Y.match(/(\w+)\[([^\]]+)\]/);oe&&(j[oe[1]]=oe[2]);const W=Y.match(/(\w+)\(([^)]+)\)/);W&&(j[W[1]]=W[2]);const V=Y.match(/(\w+)\s*-->\s*(\w+)/);V&&(f.push({from:V[1],to:V[2]}),j[V[1]]||(j[V[1]]=V[1]),j[V[2]]||(j[V[2]]=V[2]));const S=Y.match(/(\w+)\s*-->\|([^|]+)\|\s*(\w+)/);S&&(f.push({from:S[1],to:S[3],label:S[2]}),j[S[1]]||(j[S[1]]=S[1]),j[S[3]]||(j[S[3]]=S[3]))});const w=Object.keys(j);if(w.length===0)return"";const _={};if(w.length<=5){const ae=w.filter(W=>!f.some(V=>V.to===W)),Y=w.filter(W=>!f.some(V=>V.from===W));let se=60;const oe=new Set;ae.forEach((W,V)=>{_[W]={x:200+V*160,y:se},oe.add(W)}),se+=100,w.forEach((W,V)=>{!oe.has(W)&&!Y.includes(W)&&(_[W]={x:200+V%3*160,y:se},oe.add(W))}),se+=100,Y.forEach((W,V)=>{oe.has(W)||(_[W]={x:150+V*160,y:se},oe.add(W))})}else w.forEach((ae,Y)=>{const se=Math.ceil(Math.sqrt(w.length)),oe=Math.floor(Y/se),W=Y%se;_[ae]={x:100+W*180,y:80+oe*100}});const N=w.map(ae=>{const Y=_[ae],oe=j[ae].split(" "),W=[];let V="";oe.forEach(K=>{(V+" "+K).length<=15?V=V?V+" "+K:K:(V&&W.push(V),V=K)}),V&&W.push(V);const S=W.map((K,Ze)=>`<text x="${Y.x}" y="${Y.y+(Ze-W.length/2+.5)*14}" text-anchor="middle" 
                     class="text-sm font-medium" fill="white">${K}</text>`).join(""),F=Math.max(40,W.length*16+16),B=Math.max(120,Math.max(...W.map(K=>K.length))*8+20);return`
              <g class="node">
                <rect x="${Y.x-B/2}" y="${Y.y-F/2}" 
                      width="${B}" height="${F}" rx="8" 
                      fill="#2563eb" stroke="#1d4ed8" stroke-width="2"/>
                ${S}
              </g>
            `}).join(""),C=f.map(ae=>{const Y=_[ae.from],se=_[ae.to];if(!Y||!se)return"";const oe=se.x-Y.x,W=se.y-Y.y,V=Math.sqrt(oe*oe+W*W);if(V===0)return"";const S=oe/V,F=W/V,B=60,K=Y.x+S*B,Ze=Y.y+F*20,pt=se.x-S*B,xr=se.y-F*20;return`
              <g class="edge">
                <line x1="${K}" y1="${Ze}" x2="${pt}" y2="${xr}" 
                      stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>
                ${ae.label?`<text x="${(K+pt)/2}" y="${(Ze+xr)/2-8}" 
                  text-anchor="middle" class="text-xs" fill="#64748b">${ae.label}</text>`:""}
              </g>
            `}).join(""),P=w.map(ae=>_[ae].x),D=w.map(ae=>_[ae].y),ne=Math.min(...P)-100,ue=Math.max(...P)+100,qe=Math.min(...D)-50,Ue=Math.max(...D)+50,gt=ue-ne,xt=Ue-qe;return`
            <div class="mermaid-diagram bg-background border border-border rounded-lg my-6 p-4">
              <svg viewBox="${ne} ${qe} ${gt} ${xt}" class="w-full" style="height: ${Math.max(200,xt)}px;">
                <defs>
                  <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                          refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#64748b" />
                  </marker>
                </defs>
                ${C}
                ${N}
              </svg>
              <details class="mt-4 border-t border-border pt-4">
                <summary class="cursor-pointer text-sm text-muted-foreground hover:text-foreground transition-colors">
                  Показать исходный код
                </summary>
                <pre class="mt-2 p-3 bg-muted rounded text-xs overflow-x-auto font-mono"><code>${b}</code></pre>
              </details>
            </div>
          `};return b.includes("flowchart")?h(b):`
          <div id="${x}" class="mermaid-fallback bg-muted/50 border border-border rounded-lg p-6 my-6">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-2xl">📊</span>
              <h4 class="font-semibold text-foreground">Диаграмма Mermaid</h4>
            </div>
            <p class="text-muted-foreground text-sm mb-4">
              Для полного отображения диаграмм Mermaid рекомендуется использовать специализированные редакторы.
            </p>
            <details>
              <summary class="cursor-pointer text-sm text-primary hover:underline font-medium">
                Показать код диаграммы
              </summary>
              <pre class="mt-3 p-4 bg-muted rounded text-sm overflow-x-auto"><code class="text-foreground">${b}</code></pre>
            </details>
          </div>
        `})},l=u=>(u=u.replace(/\[\[#([^\]]+)\]\]/g,(m,g)=>`<a href="#${g.toLowerCase().replace(/[^а-яё\w\s-]/gi,"").replace(/\s+/g,"-").trim()}" class="obsidian-link internal-link text-primary hover:text-primary/80 hover:underline font-medium" data-header="${g}">${g}</a>`),u=u.replace(/\[\[([^\]#]+)\]\]/g,(m,g)=>`<a href="#${g.toLowerCase().replace(/[^а-яё\w\s-]/gi,"").replace(/\s+/g,"-").trim()}" class="obsidian-link internal-link text-primary hover:text-primary/80 hover:underline font-medium" data-header="${g}">${g}</a>`),u),c=u=>{let m=u;m=l(m),m=m.replace(/^(#{4,6}) (.*$)/gim,(x,h,v)=>{const p=h.length,j=v.toLowerCase().replace(/[^а-яё\w\s-]/gi,"").replace(/\s+/g,"-").trim(),f=`h${Math.min(p,6)}`;return`<${f} id="${j}" class="obsidian-header mb-3 mt-6 text-foreground scroll-mt-20 flex items-baseline gap-2">
          <span class="hash-symbols text-muted-foreground">${h}</span>
          <span class="text-base font-medium">${v}</span>
        </${f}>`}),m=m.replace(/^### (.*$)/gim,(x,h)=>`<h3 id="${h.toLowerCase().replace(/[^а-яё\w\s-]/gi,"").replace(/\s+/g,"-").trim()}" class="obsidian-header mb-3 mt-6 text-foreground scroll-mt-20 flex items-baseline gap-2">
          <span class="hash-symbols text-muted-foreground">###</span>
          <span class="text-lg font-semibold">${h}</span>
        </h3>`),m=m.replace(/^## (.*$)/gim,(x,h)=>`<h2 id="${h.toLowerCase().replace(/[^а-яё\w\s-]/gi,"").replace(/\s+/g,"-").trim()}" class="obsidian-header mb-4 mt-8 text-foreground scroll-mt-20 flex items-baseline gap-2">
          <span class="hash-symbols text-muted-foreground">##</span>
          <span class="text-xl font-semibold">${h}</span>
        </h2>`),m=m.replace(/^# (.*$)/gim,(x,h)=>`<h1 id="${h.toLowerCase().replace(/[^а-яё\w\s-]/gi,"").replace(/\s+/g,"-").trim()}" class="obsidian-header mb-6 mt-8 text-foreground scroll-mt-20 flex items-baseline gap-2">
          <span class="hash-symbols text-muted-foreground">#</span>
          <span class="text-2xl font-bold">${h}</span>
        </h1>`),m=m.replace(/\*\*(.*?)\*\*/g,'<strong class="font-semibold text-foreground">$1</strong>'),m=m.replace(/\*(.*?)\*/g,'<em class="italic text-muted-foreground">$1</em>'),m=m.replace(/`([^`]+)`/g,'<code class="bg-muted px-2 py-1 rounded text-sm font-mono text-foreground border">$1</code>'),m=m.replace(/```(?!mermaid)([\s\S]*?)```/g,'<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 border"><code class="text-sm text-foreground">$1</code></pre>'),m=m.replace(/^> \[!(note|info|tip|warning|danger)\] (.*$)/gim,(x,h,v)=>`<div class="callout ${{note:"border-l-blue-500 bg-blue-50 dark:bg-blue-950/20",info:"border-l-cyan-500 bg-cyan-50 dark:bg-cyan-950/20",tip:"border-l-green-500 bg-green-50 dark:bg-green-950/20",warning:"border-l-yellow-500 bg-yellow-50 dark:bg-yellow-950/20",danger:"border-l-red-500 bg-red-50 dark:bg-red-950/20"}[h]} border-l-4 p-4 my-4 rounded-r-lg"><div class="font-semibold text-foreground mb-2">${v}</div>`),m=m.replace(/^> (.+)$/gm,'<blockquote class="border-l-4 border-muted-foreground pl-4 my-4 text-muted-foreground italic">$1</blockquote>'),m=m.replace(/^- (.+)$/gm,'<li class="ml-4 list-disc text-foreground marker:text-muted-foreground">$1</li>'),m=m.replace(/^\* (.+)$/gm,'<li class="ml-4 list-disc text-foreground marker:text-muted-foreground">$1</li>'),m=m.replace(/^\d+\. (.+)$/gm,'<li class="ml-4 list-decimal text-foreground marker:text-muted-foreground">$1</li>'),m=m.replace(/(<li[^>]*>.*?<\/li>\s*)+/g,'<ul class="space-y-1 my-4 pl-4">$&</ul>'),m=m.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" class="text-primary hover:text-primary/80 hover:underline" target="_blank" rel="noopener noreferrer">$1</a>'),m=m.replace(/^---$/gm,'<hr class="my-6 border-border">');const g=/\|(.+)\|\n\|[\s\-\|]+\|\n((?:\|.+\|\n?)+)/g;return m=m.replace(g,(x,h,v)=>{const p=h.split("|").filter(f=>f.trim()).map(f=>`<th class="px-6 py-3 text-left font-semibold text-foreground bg-muted/80 border-b-2 border-border">${f.trim()}</th>`).join(""),j=v.trim().split(`
`).map(f=>`<tr class="hover:bg-muted/20 transition-colors">${f.split("|").filter(_=>_.trim()).map(_=>`<td class="px-6 py-4 text-foreground border-b border-border/30">${_.trim()}</td>`).join("")}</tr>`).join("");return`<div class="overflow-x-auto my-6 rounded-lg border border-border bg-card shadow-sm">
          <table class="min-w-full table-auto">
            <thead>
              <tr>${p}</tr>
            </thead>
            <tbody class="divide-y divide-border/30">
              ${j}
            </tbody>
          </table>
        </div>`}),m=m.split(/\n\s*\n/).map(x=>{const h=x.trim();return h?h.match(/^<(h[1-6]|ul|ol|li|pre|div|hr|table)/)?h:`<p class="mb-4 text-foreground leading-relaxed">${h}</p>`:""}).join(`
`),m};let d=o(n);d=c(d),a(d)},[n]),y.useEffect(()=>{const i=l=>{const c=l.target;if(c.classList.contains("internal-link")){l.preventDefault();const d=c.getAttribute("href");if(d&&d.startsWith("#")){const u=d.substring(1),m=document.getElementById(u);m&&(m.scrollIntoView({behavior:"smooth",block:"start"}),m.classList.add("target-highlight"),setTimeout(()=>{m.classList.remove("target-highlight")},2e3))}}},o=s.current;if(o)return o.addEventListener("click",i),()=>o.removeEventListener("click",i)},[r]),e.jsx("div",{ref:s,className:`markdown-content prose prose-gray dark:prose-invert max-w-none ${t}`,dangerouslySetInnerHTML:{__html:r}})}const zt=[{id:"welcome",title:"Добро пожаловать!",description:"Первый вход в образовательный портал",icon:"Star",color:"primary",course:"all",dateCreated:"2024-01-01T00:00:00.000Z",criteria:"Зарегистрироваться и войти в систему",points:5,isActive:!0},{id:"profile_complete",title:"Заполненный профиль",description:"Полностью заполнен профиль пользователя",icon:"Award",color:"success",course:"all",dateCreated:"2024-01-01T00:00:00.000Z",criteria:"Заполнить все поля в профиле",points:10,isActive:!0},{id:"first_file_view",title:"Первое изучение",description:"Просмотрен первый учебный файл",icon:"BookOpen",color:"info",course:"all",dateCreated:"2024-01-01T00:00:00.000Z",criteria:"Открыть любой учебный материал",points:5,isActive:!0},{id:"course_1_expert",title:"Эксперт 1 курса",description:"Изучены все материалы 1 курса",icon:"Crown",color:"warning",course:"1",dateCreated:"2024-01-01T00:00:00.000Z",criteria:"Просмотреть все доступные материалы 1 курса",points:25,isActive:!0},{id:"course_2_expert",title:"Эксперт 2 курса",description:"Изучены все материалы 2 курса",icon:"Crown",color:"warning",course:"2",dateCreated:"2024-01-01T00:00:00.000Z",criteria:"Просмотреть все доступные материалы 2 курса",points:25,isActive:!0},{id:"dedicated_student",title:"Усердный студент",description:"Посещал портал 7 дней подряд",icon:"Flame",color:"danger",course:"all",dateCreated:"2024-01-01T00:00:00.000Z",criteria:"Заходить в портал каждый день в течение недели",points:20,isActive:!0},{id:"knowledge_seeker",title:"Искатель знаний",description:"Просмотрено 10 различных материалов",icon:"Target",color:"secondary",course:"all",dateCreated:"2024-01-01T00:00:00.000Z",criteria:"Открыть 10 разных учебных файлов",points:15,isActive:!0},{id:"quick_learner",title:"Быстрый ученик",description:"Изучил 5 материалов за один день",icon:"Zap",color:"primary",course:"all",dateCreated:"2024-01-01T00:00:00.000Z",criteria:"Просмотреть 5 материалов в течение одного дня",points:15,isActive:!0}];function Gc(){y.useEffect(()=>{const t=setTimeout(()=>{try{n()}catch(s){console.error("Failed to initialize achievements:",s)}},100);return()=>clearTimeout(t)},[]);const n=()=>{try{const t=localStorage.getItem("achievements");if(!t)localStorage.setItem("achievements",JSON.stringify(zt)),console.log("Базовые достижения инициализированы");else{let s;try{if(s=JSON.parse(t),!Array.isArray(s))throw new Error("Invalid achievements format")}catch(i){console.warn("Invalid achievements data, reinitializing:",i),localStorage.setItem("achievements",JSON.stringify(zt));return}const r=s.map(i=>i.id).filter(Boolean),a=zt.filter(i=>i.id&&!r.includes(i.id));if(a.length>0){const i=[...s,...a];localStorage.setItem("achievements",JSON.stringify(i)),console.log(`Добавлено ${a.length} новых достижений`)}}}catch(t){console.error("Error initializing achievements:",t);try{localStorage.setItem("achievements",JSON.stringify(zt))}catch(s){console.error("Failed to set default achievements:",s)}}};return null}const Kc={welcome:n=>{yt(n,"welcome")},firstFileView:n=>{try{if(!n)return;yt(n,"first_file_view");let t;try{t=JSON.parse(localStorage.getItem("userFileViews")||"{}")}catch(i){console.warn("Invalid userFileViews data:",i),t={}}const s=Array.isArray(t[n])?t[n]:[];s.length>=10&&yt(n,"knowledge_seeker");const r=new Date().toDateString();s.filter(i=>{try{return i&&i.date&&new Date(i.date).toDateString()===r}catch{return!1}}).length>=5&&yt(n,"quick_learner")}catch(t){console.error("Error in firstFileView achievement check:",t)}},courseExpert:(n,t)=>{const s=`course_${t}_expert`;yt(n,s)}},yt=(n,t)=>{try{if(!n||!t)return;let s;try{s=JSON.parse(localStorage.getItem("studentAchievements")||"[]"),Array.isArray(s)||(s=[])}catch(a){console.warn("Invalid studentAchievements data:",a),s=[]}if(!s.find(a=>a&&a.studentId===n&&a.achievementId===t)){const a={studentId:n,achievementId:t,dateEarned:new Date().toISOString()},i=[...s,a];localStorage.setItem("studentAchievements",JSON.stringify(i));let o;try{o=JSON.parse(localStorage.getItem("achievements")||"[]"),Array.isArray(o)||(o=[])}catch(c){console.warn("Invalid achievements data:",c),o=[]}const l=o.find(c=>c&&c.id===t);if(l){console.log(`Получено достижение: ${l.title}`);const c=setTimeout(()=>{try{window.dispatchEvent(new CustomEvent("achievementEarned",{detail:{achievement:l,studentId:n}}))}catch(d){console.error("Error dispatching achievement event:",d)}},500);setTimeout(()=>clearTimeout(c),5e3)}}}catch(s){console.error("Error awarding achievement:",s)}};function Yc({file:n,onBack:t}){const[s,r]=y.useState(!1),{user:a}=je(),i=n.content.split(/\s+/).filter(m=>m.length>0).length,o=Math.ceil(i/200),l=n.content.length;y.useEffect(()=>{a?.role==="student"&&(c(a.username,n.id,n.name),Kc.firstFileView(a.username))},[a,n.id]);const c=(m,g,b)=>{const x=JSON.parse(localStorage.getItem("userFileViews")||"{}"),h=x[m]||[],v=new Date().toDateString();h.some(j=>j.fileId===g&&new Date(j.date).toDateString()===v)||(h.push({fileId:g,fileName:b,date:new Date().toISOString()}),x[m]=h,localStorage.setItem("userFileViews",JSON.stringify(x)))},d=()=>{navigator.clipboard.writeText(n.content),R.success("Содержимое скопировано в буфер обмена")},u=()=>{const m=new Blob([n.content],{type:"text/markdown"}),g=URL.createObjectURL(m),b=document.createElement("a");b.href=g,b.download=n.name,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(g),R.success("Файл загружен")};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-background/80 backdrop-blur-sm border-b border-border",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:t,children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Назад"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-muted-foreground"}),e.jsx("h1",{className:"text-lg font-semibold truncate max-w-md",children:n.name.replace(".md","")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>r(!s),children:[s?e.jsx(dn,{className:"h-4 w-4"}):e.jsx(ts,{className:"h-4 w-4"}),s?"Скрыть код":"Показать код"]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:d,children:[e.jsx(Ia,{className:"h-4 w-4"}),"Копировать"]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:u,children:[e.jsx(Tt,{className:"h-4 w-4"}),"Скачать"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.sharedBy&&e.jsxs(L,{variant:"secondary",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),n.sharedBy]}),e.jsxs(L,{variant:"outline",className:"text-xs",children:[e.jsx(dt,{className:"h-3 w-3 mr-1"}),new Date(n.uploadedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("span",{children:[l," символов"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[i," слов"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["~",o," мин. чтения"]})]})]})]})}),e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:s?e.jsxs("div",{className:"bg-muted/50 rounded-lg border",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsx("h3",{className:"font-medium text-sm",children:"Исходный Markdown код"})}),e.jsx("pre",{className:"p-6 text-sm overflow-auto max-h-[70vh] font-mono",children:e.jsx("code",{className:"text-foreground",children:n.content})})]}):e.jsx("div",{className:"prose prose-gray dark:prose-invert max-w-none",children:e.jsx("div",{className:"bg-card border border-border rounded-lg overflow-hidden",children:e.jsx("div",{className:"p-8",children:e.jsx(Hc,{content:n.content})})})})}),e.jsx("div",{className:"sticky bottom-0 bg-background/80 backdrop-blur-sm border-t border-border",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{children:"Документ загружен"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:"Markdown формат"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[(new Blob([n.content]).size/1024).toFixed(1)," KB"]})]})]})})})]})}function Xc({isActive:n,onToggle:t}){return y.useEffect(()=>{n||document.querySelectorAll(".admin-edit-icon").forEach(s=>s.remove())},[n]),n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed top-4 right-4 z-[60] flex gap-2 items-center",children:[e.jsx("div",{className:"bg-background/95 backdrop-blur-sm border rounded-lg shadow-lg flex items-center justify-center w-10 h-10",children:e.jsx(Hn,{})}),e.jsxs(k,{onClick:t,variant:"outline",className:"bg-background/95 backdrop-blur-sm border shadow-lg hover:bg-accent",size:"sm",children:[e.jsx(dn,{className:"w-4 h-4 mr-1"}),"Скрыть"]})]}),e.jsxs("div",{className:"fixed bottom-4 right-4 z-[60] bg-card/95 backdrop-blur-sm border text-foreground text-sm p-4 rounded-lg max-w-sm shadow-lg",children:[e.jsx("p",{className:"font-medium mb-2",children:"🛠️ Админ-панель активна"}),e.jsxs("p",{className:"text-muted-foreground mb-3",children:["Для редактирования контента перейдите в раздел ",e.jsx("strong",{children:"Профиль"})," → ",e.jsx("strong",{children:"Контент"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(k,{size:"sm",onClick:()=>{R.success("Перейдите в раздел Профиль для редактирования")},className:"flex-1",children:[e.jsx(ss,{className:"w-3 h-3 mr-1"}),"Профиль"]})})]})]}):e.jsx("div",{className:"fixed top-4 right-4 z-[60]",children:e.jsxs(k,{onClick:t,className:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 text-white shadow-lg",size:"sm",children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),"Быстрый доступ"]})})}const Zc=({position:n="bottom-right",richColors:t=!1,closeButton:s=!1,...r})=>null;function Qc(){return e.jsx(Zc,{position:"bottom-right",richColors:!0,closeButton:!0})}const ed={Trophy:be,Star:es};function td({achievement:n,onClose:t}){const[s,r]=y.useState(!1);y.useEffect(()=>{const o=setTimeout(()=>{r(!0)},100),l=setTimeout(()=>{a()},5e3);return()=>{clearTimeout(o),clearTimeout(l)}},[]);const a=()=>{r(!1),setTimeout(t,300)},i=ed[n.icon]||be;return e.jsx("div",{className:`fixed top-4 right-4 z-50 transition-all duration-300 ${s?"translate-x-0 opacity-100":"translate-x-full opacity-0"}`,children:e.jsx(I,{className:"w-80 border-2 border-yellow-400 bg-gradient-to-r from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20",children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-500 text-white rounded-full",children:e.jsx(i,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:"🎉 Новое достижение!"}),e.jsxs(L,{variant:"secondary",className:"text-xs",children:["+",n.points," баллов"]})]}),e.jsx("h4",{className:"font-medium text-lg mb-1",children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description})]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:a,className:"h-8 w-8 p-0",children:e.jsx(Ke,{className:"h-4 w-4"})})]})})})})}function sd(){const[n,t]=y.useState([]);y.useEffect(()=>{const r=a=>{try{const{achievement:i}=a.detail;if(!i||typeof i!="object"){console.warn("Invalid achievement data received");return}const o=`${i.id}_${Date.now()}`;t(l=>[...l,{id:o,achievement:i}].slice(-3))}catch(i){console.error("Error handling achievement notification:",i)}};return window.addEventListener("achievementEarned",r),()=>{window.removeEventListener("achievementEarned",r)}},[]);const s=r=>{t(a=>a.filter(i=>i.id!==r))};return e.jsx(e.Fragment,{children:n.map(r=>e.jsx(td,{achievement:r.achievement,onClose:()=>s(r.id)},r.id))})}function rd(){const{user:n}=je();return y.useEffect(()=>{if(n?.role)try{if(!localStorage.getItem("adminNotifications")&&n.role==="admin"){const s=[{id:"demo-1",title:"Добро пожаловать в систему уведомлений!",message:"Теперь вы можете создавать и управлять уведомлениями для всех пользователей портала. Эта система позволяет отправлять различные типы сообщений.",type:"info",targetUsers:"all",createdAt:new Date().toISOString(),createdBy:"admin",isActive:!0},{id:"demo-2",title:"Система уведомлений активна",message:"Студенты и преподаватели теперь могут получать важные сообщения через новую систему уведомлений.",type:"success",targetUsers:"all",createdAt:new Date(Date.now()-3e5).toISOString(),createdBy:"admin",isActive:!0},{id:"demo-3",title:"Важная информация для студентов",message:"Проверьте расписание экзаменов на следующей неделе. Возможны изменения.",type:"warning",targetUsers:"students",createdAt:new Date(Date.now()-18e5).toISOString(),createdBy:"admin",isActive:!0}];localStorage.setItem("adminNotifications",JSON.stringify(s)),console.log("Демонстрационные уведомления созданы")}}catch(t){console.error("Error creating demo notifications:",t)}},[n?.role]),null}function nd(){if(!localStorage.getItem("achievements")){const t=[{id:"welcome",title:"Добро пожаловать!",description:"Первый вход в образовательный портал",icon:"Star",color:"primary",course:"all",dateCreated:"2024-01-01T00:00:00.000Z",criteria:"Зарегистрироваться и войти в систему",points:5,isActive:!0}];localStorage.setItem("achievements",JSON.stringify(t))}}class ad extends y.Component{state={hasError:!1};static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("Uncaught error:",t,s)}handleReload=()=>{window.location.reload()};handleReset=()=>{this.setState({hasError:!1,error:void 0})};render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(I,{className:"max-w-md w-full",children:[e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100 dark:bg-red-900",children:e.jsx(Hs,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsx($,{children:"Произошла ошибка"}),e.jsx(de,{children:"Что-то пошло не так. Попробуйте перезагрузить страницу."})]}),e.jsxs(T,{className:"space-y-4",children:[this.state.error&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-md",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 font-mono",children:this.state.error.message})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(k,{onClick:this.handleReload,className:"w-full",children:[e.jsx(Ws,{className:"mr-2 h-4 w-4"}),"Перезагрузить страницу"]}),e.jsx(k,{variant:"outline",onClick:this.handleReset,className:"w-full",children:"Попробовать снова"})]})]})]})}):this.props.children}}function id(){const[n,t]=y.useState("main"),[s,r]=y.useState(!1),[a,i]=y.useState(!1),[o,l]=y.useState(null),[c,d]=y.useState(!1),{user:u,logout:m}=je();y.useEffect(()=>{(async()=>{try{nd()}catch(x){console.warn("Failed to initialize achievements:",x)}})()},[]),y.useEffect(()=>{u&&Qt.trackPageVisit(n)},[n,u]),y.useEffect(()=>(c?document.body.classList.add("admin-edit-mode"):document.body.classList.remove("admin-edit-mode"),()=>{document.body.classList.remove("admin-edit-mode")}),[c]);const g=()=>{if(o)return e.jsx(Yc,{file:o,onBack:()=>l(null)});if(!u&&a)return e.jsx(bl,{onBack:()=>i(!1)});if(!u&&s)return e.jsx(wl,{onBack:()=>r(!1)});switch(n){case"main":return u?e.jsx(Bt,{onSectionChange:t}):e.jsx(Bt,{onLogin:()=>r(!0),onRegister:()=>i(!0),onSectionChange:t});case"campuses":return e.jsx(Fl,{});case"faq":return e.jsx(Ec,{});case"benefits":return e.jsx(Ac,{});case"journal":return u?e.jsx(Uc,{}):e.jsx(_s,{onLogin:()=>r(!0),onRegister:()=>i(!0),sectionName:"Журнал оценок"});case"course":return u&&u.role==="student"?e.jsx(Dc,{onViewFile:l}):e.jsx(_s,{onLogin:()=>r(!0),onRegister:()=>i(!0),sectionName:"Материалы курса"});case"profile":return u?e.jsx(Vc,{}):e.jsx(_s,{onLogin:()=>r(!0),onRegister:()=>i(!0),sectionName:"Профиль"});default:return u?e.jsx(Bt,{onSectionChange:t}):e.jsx(Bt,{onLogin:()=>r(!0),onRegister:()=>i(!0),onSectionChange:t})}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[u&&e.jsx(Gc,{}),e.jsx(rd,{}),!o&&e.jsx(Tl,{currentSection:n,onSectionChange:t,user:u,onLogout:m}),e.jsx("main",{className:o?"":"container mx-auto px-4 py-8 max-w-7xl",children:g()}),u?.role==="admin"&&e.jsx(Xc,{isActive:c,onToggle:()=>d(!c)}),e.jsx(Qc,{}),u?.role==="student"&&e.jsx(sd,{})]})}function _s({onLogin:n,onRegister:t,sectionName:s}){return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs(I,{className:"max-w-md w-full mx-4",children:[e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800",children:e.jsx(lt,{className:"h-6 w-6 text-gray-600 dark:text-gray-400"})}),e.jsx($,{children:"Вход в систему требуется"}),e.jsxs(de,{children:['Для доступа к разделу "',s,'" необходимо войти в систему']})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-center text-gray-600 dark:text-gray-400",children:"Войдите в свой аккаунт или зарегистрируйтесь, чтобы получить доступ ко всем функциям портала"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(k,{onClick:n,className:"w-full",children:[e.jsx(on,{className:"mr-2 h-4 w-4"}),"Войти в систему"]}),e.jsxs(k,{variant:"outline",onClick:t,className:"w-full",children:[e.jsx(Ht,{className:"mr-2 h-4 w-4"}),"Создать аккаунт"]})]})]})]})})}function od(){return e.jsx(ad,{children:e.jsx(vl,{children:e.jsx(ml,{children:e.jsx(id,{})})})})}const ja=document.getElementById("root");if(!ja)throw new Error("Root element not found");mn(ja).render(e.jsx(y.StrictMode,{children:e.jsx(od,{})}));
//# sourceMappingURL=index-DSjXOUke.js.map
